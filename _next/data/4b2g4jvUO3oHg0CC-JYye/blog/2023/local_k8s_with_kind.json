{"pageProps":{"postData":{"id":["2023","local_k8s_with_kind"],"path":"2023/local_k8s_with_kind","contentHtml":"<p>Previously I <a href=\"/blog/2022/local_kubeadm_cluster\">showed</a> how to run kubernetes\nlocally with <code>kubeadm</code> and VMs but sometimes that is overkill so I wanted to\nshow how to run <a href=\"https://kind.sigs.k8s.io/\">kind</a> which is \"kuberetes in\ndocker\".</p>\n<h1>Creating your first cluster</h1>\n<p>kind is a very flexible way to run kubernetes locally and allows you to run\nsingle node or multinode clusters while having the flexibility to use all\nthe features of kubernetes success as ingress.</p>\n<p>To create your first cluster it is as simple as running:</p>\n<div data-rehype-pretty-code-fragment=\"\"><pre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"><code data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color: #F69D50\">‚ùØ</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">kind</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">create</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">cluster</span><span style=\"color: #ADBAC7\">  </span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color: #F69D50\">Creating</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">cluster</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">\"kind\"</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">...</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\"> </span><span style=\"color: #F69D50\">‚úì</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">Ensuring</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">node</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">image</span><span style=\"color: #ADBAC7\"> (kindest/node:v1.27.3) üñº </span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\"> </span><span style=\"color: #F69D50\">‚úì</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">Preparing</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">nodes</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">üì¶</span><span style=\"color: #ADBAC7\">  </span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\"> </span><span style=\"color: #F69D50\">‚úì</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">Writing</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">configuration</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">üìú</span><span style=\"color: #ADBAC7\"> </span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\"> </span><span style=\"color: #F69D50\">‚úì</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">Starting</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">control-plane</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">üïπÔ∏è</span><span style=\"color: #ADBAC7\"> </span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\"> </span><span style=\"color: #F69D50\">‚úì</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">Installing</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">CNI</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">üîå</span><span style=\"color: #ADBAC7\"> </span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\"> </span><span style=\"color: #F69D50\">‚úì</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">Installing</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">StorageClass</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">üíæ</span><span style=\"color: #ADBAC7\"> </span></span>\n<span data-line=\"\"><span style=\"color: #F69D50\">Set</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">kubectl</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">context</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">to</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">\"kind-kind\"</span></span>\n<span data-line=\"\"><span style=\"color: #F69D50\">You</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">can</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">now</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">use</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">your</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">cluster</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">with:</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color: #F69D50\">kubectl</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">cluster-info</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #6CB6FF\">--context</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">kind-kind</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color: #F69D50\">Have</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">a</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">question,</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">bug,</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">or</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">feature</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">request?</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">Let</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">us</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">know!</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">https://kind.sigs.k8s.io/#community</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">üôÇ</span></span></code></pre></div>\n<p>You now have a functioning kubernetes cluster and you\ncan view what it created:</p>\n<div data-rehype-pretty-code-fragment=\"\"><pre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"><code data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color: #F69D50\">‚ùØ</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">k</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">get</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">node</span></span>\n<span data-line=\"\"><span style=\"color: #F69D50\">NAME</span><span style=\"color: #ADBAC7\">                 </span><span style=\"color: #96D0FF\">STATUS</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #96D0FF\">ROLES</span><span style=\"color: #ADBAC7\">           </span><span style=\"color: #96D0FF\">AGE</span><span style=\"color: #ADBAC7\">     </span><span style=\"color: #96D0FF\">VERSION</span></span>\n<span data-line=\"\"><span style=\"color: #F69D50\">kind-control-plane</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #96D0FF\">Ready</span><span style=\"color: #ADBAC7\">    </span><span style=\"color: #96D0FF\">control-plane</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #6CB6FF\">4</span><span style=\"color: #96D0FF\">m26s</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #96D0FF\">v1.27.3</span></span></code></pre></div>\n<p>You can also verify that it is running inside docker:</p>\n<div data-rehype-pretty-code-fragment=\"\"><pre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"><code data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color: #F69D50\">‚ùØ</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">docker</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">ps</span></span>\n<span data-line=\"\"><span style=\"color: #F69D50\">CONTAINER</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">ID</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #96D0FF\">IMAGE</span><span style=\"color: #ADBAC7\">                  </span><span style=\"color: #96D0FF\">COMMAND</span><span style=\"color: #ADBAC7\">                  </span><span style=\"color: #96D0FF\">CREATED</span><span style=\"color: #ADBAC7\">         </span><span style=\"color: #96D0FF\">STATUS</span><span style=\"color: #ADBAC7\">         </span><span style=\"color: #96D0FF\">PORTS</span><span style=\"color: #ADBAC7\">                       </span><span style=\"color: #96D0FF\">NAMES</span></span>\n<span data-line=\"\"><span style=\"color: #F69D50\">1c3ba74dc29b</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #96D0FF\">kindest/node:v1.27.3</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #96D0FF\">\"/usr/local/bin/entr‚Ä¶\"</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #6CB6FF\">3</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">minutes</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">ago</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #96D0FF\">Up</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #6CB6FF\">3</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">minutes</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #6CB6FF\">127.0</span><span style=\"color: #96D0FF\">.0.1:59327</span><span style=\"color: #ADBAC7\">-</span><span style=\"color: #F47067\">></span><span style=\"color: #96D0FF\">6443/tcp</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #96D0FF\">kind-control-plane</span></span></code></pre></div>\n<h1>Making the cluster useful</h1>\n<p>There are a few things you'll notice with the command we ran originally:</p>\n<ul>\n<li>It grabbed the latest kubernetes version available</li>\n<li>It is running a single node cluster</li>\n<li>No ingress available</li>\n</ul>\n<p>Luckily kind makes it really easy to customize your local cluster to be what\nyou want it to be by using a <code>YAML</code> configuration.</p>\n<p>Create the configuration:</p>\n<div data-rehype-pretty-code-fragment=\"\"><pre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"yaml\" data-theme=\"default\"><code data-language=\"yaml\" data-theme=\"default\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color: #8DDB8C\">kind</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #96D0FF\">Cluster</span></span>\n<span data-line=\"\"><span style=\"color: #8DDB8C\">apiVersion</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #96D0FF\">kind.x-k8s.io/v1alpha4</span></span>\n<span data-line=\"\"><span style=\"color: #8DDB8C\">nodes</span><span style=\"color: #ADBAC7\">:</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">- </span><span style=\"color: #8DDB8C\">role</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #96D0FF\">control-plane</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">  </span><span style=\"color: #8DDB8C\">kubeadmConfigPatches</span><span style=\"color: #ADBAC7\">:</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">  - </span><span style=\"color: #F47067\">|</span></span>\n<span data-line=\"\"><span style=\"color: #96D0FF\">    kind: InitConfiguration</span></span>\n<span data-line=\"\"><span style=\"color: #96D0FF\">    nodeRegistration:</span></span>\n<span data-line=\"\"><span style=\"color: #96D0FF\">      kubeletExtraArgs:</span></span>\n<span data-line=\"\"><span style=\"color: #96D0FF\">        node-labels: \"ingress-ready=true\"</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">  </span><span style=\"color: #8DDB8C\">extraPortMappings</span><span style=\"color: #ADBAC7\">:</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">  - </span><span style=\"color: #8DDB8C\">containerPort</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #6CB6FF\">80</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">    </span><span style=\"color: #8DDB8C\">hostPort</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #6CB6FF\">80</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">    </span><span style=\"color: #8DDB8C\">protocol</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #96D0FF\">TCP</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">  - </span><span style=\"color: #8DDB8C\">containerPort</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #6CB6FF\">443</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">    </span><span style=\"color: #8DDB8C\">hostPort</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #6CB6FF\">443</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">    </span><span style=\"color: #8DDB8C\">protocol</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #96D0FF\">TCP</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">- </span><span style=\"color: #8DDB8C\">role</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #96D0FF\">worker</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">- </span><span style=\"color: #8DDB8C\">role</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #96D0FF\">worker</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">- </span><span style=\"color: #8DDB8C\">role</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #96D0FF\">worker</span></span></code></pre></div>\n<p>With this we've now generated a 4 node cluster where we have a single\ncontrol-plane and three workers.  Then we defined some extra configuration on\nthe control-plane:</p>\n<ul>\n<li><strong>kubeadmConfigPatches</strong>: We want to change the default configuration the\ncluster uses so it'll tag the nodes with the <code>ingress-ready</code> label so the\ncontroller will use them.</li>\n<li><strong>extraPortMappings</strong>: allow the local host to make requests to the Ingress controller over ports 80/443</li>\n<li><strong>node-labels</strong>: only allow the ingress controller to run on specific node(s) matching the label selector</li>\n</ul>\n<p>So now we can create the new cluster with the configuration. Save that config\nas <code>kind_config.yml</code> and then run:</p>\n<div data-rehype-pretty-code-fragment=\"\"><pre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"><code data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color: #F69D50\">‚ùØ</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">kind</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">create</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">cluster</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #6CB6FF\">--image</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">kindest/node:v1.25.11</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #6CB6FF\">--config</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">kind_config.yml</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #6CB6FF\">--name</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">kind-multinode</span></span></code></pre></div>\n<p>This time I've added a few additional flags on the commandline. <code>--image</code>\nallows us to use a different version of kubernetes and <code>--name</code> allows us to\nmake more than one cluster. So if you didn't destroy the first cluster you'll\nsee we have two of them now:</p>\n<div data-rehype-pretty-code-fragment=\"\"><pre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"><code data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color: #F69D50\">‚ùØ</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">kind</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">get</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">clusters</span></span>\n<span data-line=\"\"><span style=\"color: #F69D50\">kind</span></span>\n<span data-line=\"\"><span style=\"color: #F69D50\">kind-multinode</span></span></code></pre></div>\n<p>but <code>kind</code> will swap the to the newest cluster by default:</p>\n<div data-rehype-pretty-code-fragment=\"\"><pre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"><code data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color: #F69D50\">‚ùØ</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">kubectl</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">config</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">current-context</span></span>\n<span data-line=\"\"><span style=\"color: #F69D50\">kind-kind-multinode</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color: #F69D50\">‚ùØ</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">kubectl</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">get</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">node</span></span>\n<span data-line=\"\"><span style=\"color: #F69D50\">NAME</span><span style=\"color: #ADBAC7\">                           </span><span style=\"color: #96D0FF\">STATUS</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #96D0FF\">ROLES</span><span style=\"color: #ADBAC7\">           </span><span style=\"color: #96D0FF\">AGE</span><span style=\"color: #ADBAC7\">    </span><span style=\"color: #96D0FF\">VERSION</span></span>\n<span data-line=\"\"><span style=\"color: #F69D50\">kind-multinode-control-plane</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #96D0FF\">Ready</span><span style=\"color: #ADBAC7\">    </span><span style=\"color: #96D0FF\">control-plane</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #6CB6FF\">107</span><span style=\"color: #96D0FF\">s</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #96D0FF\">v1.25.11</span></span>\n<span data-line=\"\"><span style=\"color: #F69D50\">kind-multinode-worker</span><span style=\"color: #ADBAC7\">          </span><span style=\"color: #96D0FF\">Ready</span><span style=\"color: #ADBAC7\">    </span><span style=\"color: #F47067\">&#x3C;</span><span style=\"color: #96D0FF\">non</span><span style=\"color: #ADBAC7\">e</span><span style=\"color: #F47067\">></span><span style=\"color: #ADBAC7\">          </span><span style=\"color: #6CB6FF\">88</span><span style=\"color: #96D0FF\">s</span><span style=\"color: #ADBAC7\">    </span><span style=\"color: #96D0FF\">v1.25.11</span></span>\n<span data-line=\"\"><span style=\"color: #F69D50\">kind-multinode-worker2</span><span style=\"color: #ADBAC7\">         </span><span style=\"color: #96D0FF\">Ready</span><span style=\"color: #ADBAC7\">    </span><span style=\"color: #F47067\">&#x3C;</span><span style=\"color: #96D0FF\">non</span><span style=\"color: #ADBAC7\">e</span><span style=\"color: #F47067\">></span><span style=\"color: #ADBAC7\">          </span><span style=\"color: #6CB6FF\">88</span><span style=\"color: #96D0FF\">s</span><span style=\"color: #ADBAC7\">    </span><span style=\"color: #96D0FF\">v1.25.11</span></span>\n<span data-line=\"\"><span style=\"color: #F69D50\">kind-multinode-worker3</span><span style=\"color: #ADBAC7\">         </span><span style=\"color: #96D0FF\">Ready</span><span style=\"color: #ADBAC7\">    </span><span style=\"color: #F47067\">&#x3C;</span><span style=\"color: #96D0FF\">non</span><span style=\"color: #ADBAC7\">e</span><span style=\"color: #F47067\">></span><span style=\"color: #ADBAC7\">          </span><span style=\"color: #6CB6FF\">88</span><span style=\"color: #96D0FF\">s</span><span style=\"color: #ADBAC7\">    </span><span style=\"color: #96D0FF\">v1.25.11</span></span></code></pre></div>\n<p>Now we need to get the <code>ingress-nginx</code> controller installed so we can start\nusing our cluster with ingress:</p>\n<div data-rehype-pretty-code-fragment=\"\"><pre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"><code data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color: #F69D50\">‚ùØ</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">kubectl</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">apply</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #6CB6FF\">-f</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/deploy/static/provider/kind/deploy.yaml</span></span></code></pre></div>\n<p>The manifests contains <code>kind</code> specific patches to forward the hostPorts to the ingress controller, set taint tolerations and schedule it to the custom labelled node.</p>\n<p>This will take a little bit of time to get up and running, you can monitor it\nby running:</p>\n<div data-rehype-pretty-code-fragment=\"\"><pre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"><code data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color: #F69D50\">kubectl</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">wait</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #6CB6FF\">--namespace</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">ingress-nginx</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #F47067\">\\</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">  </span><span style=\"color: #6CB6FF\">--for=condition=ready</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">pod</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #F47067\">\\</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">  </span><span style=\"color: #6CB6FF\">--selector=app.kubernetes.io/component=controller</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #F47067\">\\</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">  </span><span style=\"color: #6CB6FF\">--timeout=90s</span></span></code></pre></div>\n<p>or just manually check the status:</p>\n<div data-rehype-pretty-code-fragment=\"\"><pre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"><code data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color: #F69D50\">‚ùØ</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">kubectl</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">get</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">all</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #6CB6FF\">-n</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">ingress-nginx</span></span>\n<span data-line=\"\"><span style=\"color: #F69D50\">NAME</span><span style=\"color: #ADBAC7\">                                            </span><span style=\"color: #96D0FF\">READY</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #96D0FF\">STATUS</span><span style=\"color: #ADBAC7\">              </span><span style=\"color: #96D0FF\">RESTARTS</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #96D0FF\">AGE</span></span>\n<span data-line=\"\"><span style=\"color: #F69D50\">pod/ingress-nginx-admission-create-bbmlc</span><span style=\"color: #ADBAC7\">        </span><span style=\"color: #6CB6FF\">0</span><span style=\"color: #96D0FF\">/1</span><span style=\"color: #ADBAC7\">     </span><span style=\"color: #96D0FF\">Completed</span><span style=\"color: #ADBAC7\">           </span><span style=\"color: #6CB6FF\">0</span><span style=\"color: #ADBAC7\">          </span><span style=\"color: #6CB6FF\">68</span><span style=\"color: #96D0FF\">s</span></span>\n<span data-line=\"\"><span style=\"color: #F69D50\">pod/ingress-nginx-admission-patch-qlnr8</span><span style=\"color: #ADBAC7\">         </span><span style=\"color: #6CB6FF\">0</span><span style=\"color: #96D0FF\">/1</span><span style=\"color: #ADBAC7\">     </span><span style=\"color: #96D0FF\">Completed</span><span style=\"color: #ADBAC7\">           </span><span style=\"color: #6CB6FF\">2</span><span style=\"color: #ADBAC7\">          </span><span style=\"color: #6CB6FF\">68</span><span style=\"color: #96D0FF\">s</span></span>\n<span data-line=\"\"><span style=\"color: #F69D50\">pod/ingress-nginx-controller-5f748f78c8-6tc6b</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #6CB6FF\">0</span><span style=\"color: #96D0FF\">/1</span><span style=\"color: #ADBAC7\">     </span><span style=\"color: #96D0FF\">ContainerCreating</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #6CB6FF\">0</span><span style=\"color: #ADBAC7\">          </span><span style=\"color: #6CB6FF\">68</span><span style=\"color: #96D0FF\">s</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color: #F69D50\">NAME</span><span style=\"color: #ADBAC7\">                                         </span><span style=\"color: #96D0FF\">TYPE</span><span style=\"color: #ADBAC7\">        </span><span style=\"color: #96D0FF\">CLUSTER-IP</span><span style=\"color: #ADBAC7\">      </span><span style=\"color: #96D0FF\">EXTERNAL-IP</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #96D0FF\">PORT</span><span style=\"color: #ADBAC7\">(</span><span style=\"color: #F69D50\">S</span><span style=\"color: #ADBAC7\">)                      </span><span style=\"color: #96D0FF\">AGE</span></span>\n<span data-line=\"\"><span style=\"color: #F69D50\">service/ingress-nginx-controller</span><span style=\"color: #ADBAC7\">             </span><span style=\"color: #96D0FF\">NodePort</span><span style=\"color: #ADBAC7\">    </span><span style=\"color: #6CB6FF\">10.96</span><span style=\"color: #96D0FF\">.228.248</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #F47067\">&#x3C;</span><span style=\"color: #96D0FF\">non</span><span style=\"color: #ADBAC7\">e</span><span style=\"color: #F47067\">></span><span style=\"color: #ADBAC7\">        </span><span style=\"color: #6CB6FF\">80</span><span style=\"color: #96D0FF\">:31771/TCP,443:31759/TCP</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #6CB6FF\">68</span><span style=\"color: #96D0FF\">s</span></span>\n<span data-line=\"\"><span style=\"color: #F69D50\">service/ingress-nginx-controller-admission</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #96D0FF\">ClusterIP</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #6CB6FF\">10.96</span><span style=\"color: #96D0FF\">.180.126</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #F47067\">&#x3C;</span><span style=\"color: #96D0FF\">non</span><span style=\"color: #ADBAC7\">e</span><span style=\"color: #F47067\">></span><span style=\"color: #ADBAC7\">        </span><span style=\"color: #6CB6FF\">443</span><span style=\"color: #96D0FF\">/TCP</span><span style=\"color: #ADBAC7\">                      </span><span style=\"color: #6CB6FF\">68</span><span style=\"color: #96D0FF\">s</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color: #F69D50\">NAME</span><span style=\"color: #ADBAC7\">                                       </span><span style=\"color: #96D0FF\">READY</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #96D0FF\">UP-TO-DATE</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #96D0FF\">AVAILABLE</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #96D0FF\">AGE</span></span>\n<span data-line=\"\"><span style=\"color: #F69D50\">deployment.apps/ingress-nginx-controller</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #6CB6FF\">0</span><span style=\"color: #96D0FF\">/1</span><span style=\"color: #ADBAC7\">     </span><span style=\"color: #6CB6FF\">1</span><span style=\"color: #ADBAC7\">            </span><span style=\"color: #6CB6FF\">0</span><span style=\"color: #ADBAC7\">           </span><span style=\"color: #6CB6FF\">68</span><span style=\"color: #96D0FF\">s</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color: #F69D50\">NAME</span><span style=\"color: #ADBAC7\">                                                  </span><span style=\"color: #96D0FF\">DESIRED</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #96D0FF\">CURRENT</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #96D0FF\">READY</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #96D0FF\">AGE</span></span>\n<span data-line=\"\"><span style=\"color: #F69D50\">replicaset.apps/ingress-nginx-controller-5f748f78c8</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #6CB6FF\">1</span><span style=\"color: #ADBAC7\">         </span><span style=\"color: #6CB6FF\">1</span><span style=\"color: #ADBAC7\">         </span><span style=\"color: #6CB6FF\">0</span><span style=\"color: #ADBAC7\">       </span><span style=\"color: #6CB6FF\">68</span><span style=\"color: #96D0FF\">s</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color: #F69D50\">NAME</span><span style=\"color: #ADBAC7\">                                       </span><span style=\"color: #96D0FF\">COMPLETIONS</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #96D0FF\">DURATION</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #96D0FF\">AGE</span></span>\n<span data-line=\"\"><span style=\"color: #F69D50\">job.batch/ingress-nginx-admission-create</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #6CB6FF\">1</span><span style=\"color: #96D0FF\">/1</span><span style=\"color: #ADBAC7\">           </span><span style=\"color: #6CB6FF\">22</span><span style=\"color: #96D0FF\">s</span><span style=\"color: #ADBAC7\">        </span><span style=\"color: #6CB6FF\">68</span><span style=\"color: #96D0FF\">s</span></span>\n<span data-line=\"\"><span style=\"color: #F69D50\">job.batch/ingress-nginx-admission-patch</span><span style=\"color: #ADBAC7\">    </span><span style=\"color: #6CB6FF\">1</span><span style=\"color: #96D0FF\">/1</span><span style=\"color: #ADBAC7\">           </span><span style=\"color: #6CB6FF\">35</span><span style=\"color: #96D0FF\">s</span><span style=\"color: #ADBAC7\">        </span><span style=\"color: #6CB6FF\">68</span><span style=\"color: #96D0FF\">s</span></span></code></pre></div>\n<p>Once <code>ingress-nginx-controller</code> is in <code>Running</code> state you are read to go!</p>\n<h1>Deploying your first app</h1>\n<p>To prove that the cluster is working correctly we will deploy\n<a href=\"https://github.com/Kong/httpbin\">httpbin</a> which is a nice little API server\nso we can prove everything is working.</p>\n<p>Create a <code>httbin.yml</code> file and paste this into it:</p>\n<div data-rehype-pretty-code-fragment=\"\"><pre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"yaml\" data-theme=\"default\"><code data-language=\"yaml\" data-theme=\"default\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color: #6CB6FF\">---</span></span>\n<span data-line=\"\"><span style=\"color: #8DDB8C\">apiVersion</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #96D0FF\">v1</span></span>\n<span data-line=\"\"><span style=\"color: #8DDB8C\">kind</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #96D0FF\">Service</span></span>\n<span data-line=\"\"><span style=\"color: #8DDB8C\">metadata</span><span style=\"color: #ADBAC7\">:</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">  </span><span style=\"color: #8DDB8C\">name</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #96D0FF\">httpbin</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">  </span><span style=\"color: #8DDB8C\">labels</span><span style=\"color: #ADBAC7\">:</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">    </span><span style=\"color: #8DDB8C\">app</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #96D0FF\">httpbin</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">    </span><span style=\"color: #8DDB8C\">service</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #96D0FF\">httpbin</span></span>\n<span data-line=\"\"><span style=\"color: #8DDB8C\">spec</span><span style=\"color: #ADBAC7\">:</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">  </span><span style=\"color: #8DDB8C\">ports</span><span style=\"color: #ADBAC7\">:</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">  - </span><span style=\"color: #8DDB8C\">name</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #96D0FF\">http</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">    </span><span style=\"color: #8DDB8C\">port</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #6CB6FF\">8000</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">    </span><span style=\"color: #8DDB8C\">targetPort</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #6CB6FF\">8080</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">  </span><span style=\"color: #8DDB8C\">selector</span><span style=\"color: #ADBAC7\">:</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">    </span><span style=\"color: #8DDB8C\">app</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #96D0FF\">httpbin</span></span>\n<span data-line=\"\"><span style=\"color: #6CB6FF\">---</span></span>\n<span data-line=\"\"><span style=\"color: #8DDB8C\">apiVersion</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #96D0FF\">apps/v1</span></span>\n<span data-line=\"\"><span style=\"color: #8DDB8C\">kind</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #96D0FF\">Deployment</span></span>\n<span data-line=\"\"><span style=\"color: #8DDB8C\">metadata</span><span style=\"color: #ADBAC7\">:</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">  </span><span style=\"color: #8DDB8C\">name</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #96D0FF\">httpbin</span></span>\n<span data-line=\"\"><span style=\"color: #8DDB8C\">spec</span><span style=\"color: #ADBAC7\">:</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">  </span><span style=\"color: #8DDB8C\">replicas</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #6CB6FF\">2</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">  </span><span style=\"color: #8DDB8C\">selector</span><span style=\"color: #ADBAC7\">:</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">    </span><span style=\"color: #8DDB8C\">matchLabels</span><span style=\"color: #ADBAC7\">:</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">      </span><span style=\"color: #8DDB8C\">app</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #96D0FF\">httpbin</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">      </span><span style=\"color: #8DDB8C\">version</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #96D0FF\">v1</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">  </span><span style=\"color: #8DDB8C\">template</span><span style=\"color: #ADBAC7\">:</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">    </span><span style=\"color: #8DDB8C\">metadata</span><span style=\"color: #ADBAC7\">:</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">      </span><span style=\"color: #8DDB8C\">labels</span><span style=\"color: #ADBAC7\">:</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">        </span><span style=\"color: #8DDB8C\">app</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #96D0FF\">httpbin</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">        </span><span style=\"color: #8DDB8C\">version</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #96D0FF\">v1</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">    </span><span style=\"color: #8DDB8C\">spec</span><span style=\"color: #ADBAC7\">:</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">      </span><span style=\"color: #8DDB8C\">containers</span><span style=\"color: #ADBAC7\">:</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">      - </span><span style=\"color: #8DDB8C\">image</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #96D0FF\">docker.io/mccutchen/go-httpbin</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">        </span><span style=\"color: #8DDB8C\">imagePullPolicy</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #96D0FF\">IfNotPresent</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">        </span><span style=\"color: #8DDB8C\">name</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #96D0FF\">httpbin</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">        </span><span style=\"color: #8DDB8C\">ports</span><span style=\"color: #ADBAC7\">:</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">        - </span><span style=\"color: #8DDB8C\">containerPort</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #6CB6FF\">8080</span></span></code></pre></div>\n<p>This is creating a couple of Kubernetes resources:</p>\n<ul>\n<li><code>Service</code>: This is exposing the port to the ingress</li>\n<li><code>Deployment</code>: This is actually launching the service</li>\n</ul>\n<p>So we are not using the ingress yet but we can prove that we can launch the\nservice at least.  So apply those manifests:</p>\n<div data-rehype-pretty-code-fragment=\"\"><pre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"><code data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color: #F69D50\">‚ùØ</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">kubectl</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">apply</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #6CB6FF\">-f</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">httpbin.yml</span><span style=\"color: #ADBAC7\"> </span></span>\n<span data-line=\"\"><span style=\"color: #F69D50\">service/httpbin</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">created</span></span>\n<span data-line=\"\"><span style=\"color: #F69D50\">deployment.apps/httpbin</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">created</span></span></code></pre></div>\n<p>You should see two pods come up.  You should wait for them to get into the\n<code>Running</code> status:</p>\n<div data-rehype-pretty-code-fragment=\"\"><pre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"><code data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color: #F69D50\">‚ùØ</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">kubectl</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">get</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">pod</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #6CB6FF\">-o</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">wide</span></span>\n<span data-line=\"\"><span style=\"color: #F69D50\">NAME</span><span style=\"color: #ADBAC7\">                      </span><span style=\"color: #96D0FF\">READY</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #96D0FF\">STATUS</span><span style=\"color: #ADBAC7\">    </span><span style=\"color: #96D0FF\">RESTARTS</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #96D0FF\">AGE</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #96D0FF\">IP</span><span style=\"color: #ADBAC7\">           </span><span style=\"color: #96D0FF\">NODE</span><span style=\"color: #ADBAC7\">                     </span><span style=\"color: #96D0FF\">NOMINATED</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">NODE</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #96D0FF\">READINESS</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">GATES</span></span>\n<span data-line=\"\"><span style=\"color: #F69D50\">httpbin-5c5494967-2z5wz</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #6CB6FF\">1</span><span style=\"color: #96D0FF\">/1</span><span style=\"color: #ADBAC7\">     </span><span style=\"color: #96D0FF\">Running</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #6CB6FF\">0</span><span style=\"color: #ADBAC7\">          </span><span style=\"color: #6CB6FF\">48</span><span style=\"color: #96D0FF\">s</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #6CB6FF\">10.244</span><span style=\"color: #96D0FF\">.3.3</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #96D0FF\">kind-multinode-worker3</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #F47067\">&#x3C;</span><span style=\"color: #96D0FF\">non</span><span style=\"color: #ADBAC7\">e</span><span style=\"color: #F47067\">></span><span style=\"color: #ADBAC7\">           </span><span style=\"color: #F47067\">&#x3C;</span><span style=\"color: #96D0FF\">non</span><span style=\"color: #ADBAC7\">e</span><span style=\"color: #F47067\">></span></span>\n<span data-line=\"\"><span style=\"color: #F69D50\">httpbin-5c5494967-9lf47</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #6CB6FF\">1</span><span style=\"color: #96D0FF\">/1</span><span style=\"color: #ADBAC7\">     </span><span style=\"color: #96D0FF\">Running</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #6CB6FF\">0</span><span style=\"color: #ADBAC7\">          </span><span style=\"color: #6CB6FF\">72</span><span style=\"color: #96D0FF\">s</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #6CB6FF\">10.244</span><span style=\"color: #96D0FF\">.1.2</span><span style=\"color: #ADBAC7\">   </span><span style=\"color: #96D0FF\">kind-multinode-worker</span><span style=\"color: #ADBAC7\">    </span><span style=\"color: #F47067\">&#x3C;</span><span style=\"color: #96D0FF\">non</span><span style=\"color: #ADBAC7\">e</span><span style=\"color: #F47067\">></span><span style=\"color: #ADBAC7\">           </span><span style=\"color: #F47067\">&#x3C;</span><span style=\"color: #96D0FF\">non</span><span style=\"color: #ADBAC7\">e</span><span style=\"color: #F47067\">></span></span></code></pre></div>\n<p>We can now use port forwarding to access it. <code>httpbin</code> is exposed on <code>8000</code> so\nlets create port <code>9000</code> on our host that forwards to it:</p>\n<div data-rehype-pretty-code-fragment=\"\"><pre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"><code data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color: #F69D50\">‚ùØ</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">kubectl</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">port-forward</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">service/httpbin</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #6CB6FF\">9000</span><span style=\"color: #96D0FF\">:8000</span></span>\n<span data-line=\"\"><span style=\"color: #F69D50\">Forwarding</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">from</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #6CB6FF\">127.0</span><span style=\"color: #96D0FF\">.0.1:9000</span><span style=\"color: #ADBAC7\"> -</span><span style=\"color: #F47067\">></span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #6CB6FF\">80</span></span>\n<span data-line=\"\"><span style=\"color: #F69D50\">Forwarding</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">from</span><span style=\"color: #ADBAC7\"> [::1]:9000 -</span><span style=\"color: #F47067\">></span><span style=\"color: #ADBAC7\"> 80</span></span></code></pre></div>\n<p>You can access it via:</p>\n<div data-rehype-pretty-code-fragment=\"\"><pre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"><code data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color: #F69D50\">‚ùØ</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">curl</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">localhost:9000/get</span><span style=\"color: #ADBAC7\"> </span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">{</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">  </span><span style=\"color: #F69D50\">\"args\"</span><span style=\"color: #6CB6FF\">:</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">{},</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">  </span><span style=\"color: #F69D50\">\"headers\"</span><span style=\"color: #6CB6FF\">:</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">{</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">    </span><span style=\"color: #F69D50\">\"Accept\"</span><span style=\"color: #6CB6FF\">:</span><span style=\"color: #ADBAC7\"> [</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">      </span><span style=\"color: #F69D50\">\"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8\"</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">    ],</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">}</span></span></code></pre></div>\n<h1>Using Ingress</h1>\n<p>Now to use the ingress rather than port forwarding we create one additional\nresource, the <code>Ingress</code>:</p>\n<div data-rehype-pretty-code-fragment=\"\"><pre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"yaml\" data-theme=\"default\"><code data-language=\"yaml\" data-theme=\"default\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color: #8DDB8C\">apiVersion</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #96D0FF\">networking.k8s.io/v1</span></span>\n<span data-line=\"\"><span style=\"color: #8DDB8C\">kind</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #96D0FF\">Ingress</span></span>\n<span data-line=\"\"><span style=\"color: #8DDB8C\">metadata</span><span style=\"color: #ADBAC7\">:</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">  </span><span style=\"color: #8DDB8C\">name</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #96D0FF\">httpbin-ingress</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">  </span><span style=\"color: #8DDB8C\">annotations</span><span style=\"color: #ADBAC7\">:</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">    </span><span style=\"color: #8DDB8C\">nginx.ingress.kubernetes.io/rewrite-target</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #96D0FF\">/$2</span></span>\n<span data-line=\"\"><span style=\"color: #8DDB8C\">spec</span><span style=\"color: #ADBAC7\">:</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">  </span><span style=\"color: #8DDB8C\">ingressClassName</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #96D0FF\">nginx</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">  </span><span style=\"color: #8DDB8C\">rules</span><span style=\"color: #ADBAC7\">:</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">  - </span><span style=\"color: #8DDB8C\">http</span><span style=\"color: #ADBAC7\">:</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">      </span><span style=\"color: #8DDB8C\">paths</span><span style=\"color: #ADBAC7\">:</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">      - </span><span style=\"color: #8DDB8C\">path</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #96D0FF\">/httpbin(/|$)(.*)</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">        </span><span style=\"color: #8DDB8C\">pathType</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #96D0FF\">ImplementationSpecific</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">        </span><span style=\"color: #8DDB8C\">backend</span><span style=\"color: #ADBAC7\">:</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">          </span><span style=\"color: #8DDB8C\">service</span><span style=\"color: #ADBAC7\">:</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">            </span><span style=\"color: #8DDB8C\">name</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #96D0FF\">httpbin</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">            </span><span style=\"color: #8DDB8C\">port</span><span style=\"color: #ADBAC7\">:</span></span>\n<span data-line=\"\"><span style=\"color: #ADBAC7\">              </span><span style=\"color: #8DDB8C\">number</span><span style=\"color: #ADBAC7\">: </span><span style=\"color: #6CB6FF\">8000</span></span></code></pre></div>\n<p>There are a few critical options here.  The first is the annotation to rewrite\nthe path so it doesn't include <code>/httpbin/</code> when it sends the request to the\nservice and then the <code>path</code> and <code>pathType</code> so it knows which paths to send to\nwhich service.</p>\n<p>Now you should be able to hit your local host and get routed to your\nkubernetes service:</p>\n<div data-rehype-pretty-code-fragment=\"\"><pre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"><code data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color: #F69D50\">‚ùØ</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">curl</span><span style=\"color: #ADBAC7\"> </span><span style=\"color: #96D0FF\">localhost/httpbin/get</span></span></code></pre></div>\n<p>Success!  Now you have a multinode kubernetes cluster that has an ingress\ncontroller!</p>\n<h1>Next Steps</h1>\n<p>The cluster can be used like a production cluster now for local\ndevelopment!  You could setup Grafana, ArgoCD, etc. to run\ninside the cluster.</p>","category":"Kubernetes","date":"2023-07-21T00:00:00Z","tags":["Linux","Kubernetes","DevOps","SRE"],"title":"Running a kubernetes cluster locally with kind"}},"__N_SSG":true}