<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="alternate" type="application/rss+xml" title="sontek&#x27;s Engineering Blog" href="/rss.xml"/><title>Running a kubernetes cluster locally with kubeadm</title><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/c9439d4f00292099.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c9439d4f00292099.css" data-n-g=""/><link rel="preload" href="/_next/static/css/e64130af1ba1a327.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e64130af1ba1a327.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-69bfa6990bb9e155.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-2a9c662ddd7329fb.js" defer=""></script><script src="/_next/static/chunks/pages/_app-e535547a4fdaa691.js" defer=""></script><script src="/_next/static/chunks/996-9e3c12b77542c098.js" defer=""></script><script src="/_next/static/chunks/790-a3aa35eb62ec874e.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...id%5D-c6e585d86e012327.js" defer=""></script><script src="/_next/static/92NZrJxfbghuXpSStEquK/_buildManifest.js" defer=""></script><script src="/_next/static/92NZrJxfbghuXpSStEquK/_ssgManifest.js" defer=""></script><script src="/_next/static/92NZrJxfbghuXpSStEquK/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><div><div class="grid"><div class="col"><header id="banner" class="body"><h1><a href="/">sontek.net</a></h1></header></div><div class="col menu"><nav><ul><li><a href="/">Home</a></li><li><a href="/blog">Blog</a></li><li><a href="/resume">Resume</a></li><li><a href="/about">About</a></li></ul></nav></div></div><div class="container"><article class="blog_article__NoEy4"><h1 class="util_headingXl__knZ_h">Running a kubernetes cluster locally with kubeadm</h1><div class="util_lightText__xcqUE"><time dateTime="2022-04-16T20:00:00-04:00">April 16, 2022</time></div><div><p>I’m going to show you how to get a real kubernetes cluster setup locally on top of virtual
machines!  I’ll be using multipass but feel free to use virtualbox, proxmox, or whatever your
favorite cloud provider is.</p>
<p>kubeadm a production ready kubernetes install tool and I prefer to use it over minikube, kind,
etc. because it gives you a more real world experience for <em>managing</em> the kubernetes cluster.
This isn’t important if you are a user of the cluster but if you have to run your own this is
a great way to gain some daily experience.</p>
<p>The kubernetes documentation on kubeadm is great and you can find it <a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/">here</a>.</p>
<p>The differences between this blog and the kubernetes docs is that they leave a lot of decisions
up to the reader such as:</p>
<ul>
<li>choosing a container runtime</li>
<li>Selecting and installing a CNI (container network interface)</li>
</ul>
<p>I’m going to be opinionated and make specific technology decisions such as using containerd and
cilium so that you don't have to think about those decisions.</p>
<h2>Getting your Virtual Machines setup!</h2>
<p>The minimum requirements for a control plane node in kubernetes is 2gb of RAM and 2 CPUs.  Since
we actually want to be able to schedule workloads on the workers afterwards we are going to setup
a cluster that looks like this:</p>
<ul>
<li>Control Plane: 2gb RAM, 2 CPU</li>
<li>Worker: 4gb RAM, 2 CPU</li>
</ul>
<p>Since we’ll be using multipass to launch the nodes, we can do that now:</p>
<div data-rehype-pretty-code-fragment=""><pre class="github-dark-dimmed" style="background-color: #22272e" tabindex="0" data-language="bash" data-theme="default"><code data-language="bash" data-theme="default" style="display: grid;"><span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">multipass</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">launch</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-c</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">2</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-m</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">4</span><span style="color: #96D0FF">G</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-d</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">10</span><span style="color: #96D0FF">G</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-n</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">controlplane</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">22.04</span></span>
<span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">multipass</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">launch</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-c</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">2</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-m</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">4</span><span style="color: #96D0FF">G</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-d</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">10</span><span style="color: #96D0FF">G</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-n</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">worker</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">22.04</span></span>
<span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">multipass</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">list</span></span>
<span data-line=""><span style="color: #F69D50">Name</span><span style="color: #ADBAC7">                    </span><span style="color: #96D0FF">State</span><span style="color: #ADBAC7">             </span><span style="color: #96D0FF">IPv4</span><span style="color: #ADBAC7">             </span><span style="color: #96D0FF">Image</span></span>
<span data-line=""><span style="color: #F69D50">controlplane</span><span style="color: #ADBAC7">            </span><span style="color: #96D0FF">Running</span><span style="color: #ADBAC7">           </span><span style="color: #6CB6FF">192.168</span><span style="color: #96D0FF">.64.7</span><span style="color: #ADBAC7">     </span><span style="color: #96D0FF">Ubuntu</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">22.04</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">LTS</span></span>
<span data-line=""><span style="color: #F69D50">worker</span><span style="color: #ADBAC7">                  </span><span style="color: #96D0FF">Running</span><span style="color: #ADBAC7">           </span><span style="color: #6CB6FF">192.168</span><span style="color: #96D0FF">.64.8</span><span style="color: #ADBAC7">     </span><span style="color: #96D0FF">Ubuntu</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">22.04</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">LTS</span></span></code></pre></div>
<p>Now we can start working on our controlplane first, lets shell in:</p>
<div data-rehype-pretty-code-fragment=""><pre class="github-dark-dimmed" style="background-color: #22272e" tabindex="0" data-language="bash" data-theme="default"><code data-language="bash" data-theme="default" style="display: grid;"><span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">multipass</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">shell</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">controlplane</span></span></code></pre></div>
<p>Lets first add the kubernetes repo to the system so we have access to all the kubernetes tools:</p>
<div data-rehype-pretty-code-fragment=""><pre class="github-dark-dimmed" style="background-color: #22272e" tabindex="0" data-language="bash" data-theme="default"><code data-language="bash" data-theme="default" style="display: grid;"><span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">echo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">"deb  http://apt.kubernetes.io/  kubernetes-xenial  main"</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">|</span><span style="color: #ADBAC7"> </span><span style="color: #F69D50">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">tee</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">/etc/apt/sources.list.d/kubernetes.list</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">curl</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-fsSL</span><span style="color: #ADBAC7">  </span><span style="color: #96D0FF">https://packages.cloud.google.com/apt/doc/apt-key.gpg</span><span style="color: #F47067">|</span><span style="color: #F69D50">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">gpg</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">--dearmor</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-o</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">/etc/apt/trusted.gpg.d/k8s.gpg</span></span>
<span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">apt-get</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">update</span><span style="color: #ADBAC7"> &#x26;&#x26; </span><span style="color: #F69D50">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">apt-get</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">upgrade</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-y</span></span></code></pre></div>
<p>Now that our system is setup, we can move on to getting a container runtime.</p>
<h2>Getting your Container Runtime!</h2>
<p>Before we start pulling in kubernetes components we need to get a container runtime setup on the
machine.   We we are going to use containerd for this purpose.  You can view the docs of for it
<a href="https://github.com/containerd/containerd/blob/main/docs/getting-started.md">here</a>.</p>
<p>Which will download the latest binary and set it up.   I’m going to walk you through how to do it
using the version packaged with Ubuntu which could be older than the latest release.</p>
<p>First thing we want to do is configure the networking to allow iptables to manage:</p>
<div data-rehype-pretty-code-fragment=""><pre class="github-dark-dimmed" style="background-color: #22272e" tabindex="0" data-language="bash" data-theme="default"><code data-language="bash" data-theme="default" style="display: grid;"><span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">cat</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">&#x3C;&#x3C;</span><span style="color: #ADBAC7">EOF</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">|</span><span style="color: #ADBAC7"> sudo tee /etc/modules-load.d/k8s.conf</span></span>
<span data-line=""><span style="color: #96D0FF">overlay</span></span>
<span data-line=""><span style="color: #96D0FF">br_netfilter</span></span>
<span data-line=""><span style="color: #ADBAC7">EOF</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">cat</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">&#x3C;&#x3C;</span><span style="color: #ADBAC7">EOF</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">|</span><span style="color: #ADBAC7"> sudo tee /etc/sysctl.d/k8s.conf</span></span>
<span data-line=""><span style="color: #96D0FF">net.bridge.bridge-nf-call-ip6tables = 1</span></span>
<span data-line=""><span style="color: #96D0FF">net.bridge.bridge-nf-call-iptables  = 1</span></span>
<span data-line=""><span style="color: #96D0FF">net.ipv4.ip_forward                 = 1</span></span>
<span data-line=""><span style="color: #ADBAC7">EOF</span></span>
<span data-line=""> </span></code></pre></div>
<p>We also need to disable some default systemd settings for <code>rp_filter</code>  because
they are not compatible with cilium. See the bug report
<a href="https://github.com/cilium/cilium/commit/cabc6581b8128681f4ed23f8d6dc463180eea61e">here</a></p>
<div data-rehype-pretty-code-fragment=""><pre class="github-dark-dimmed" style="background-color: #22272e" tabindex="0" data-language="bash" data-theme="default"><code data-language="bash" data-theme="default" style="display: grid;"><span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sed</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-i</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-e</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">'/net.ipv4.conf.*.rp_filter/d'</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">$(</span><span style="color: #F69D50">grep</span><span style="color: #96D0FF"> </span><span style="color: #6CB6FF">-ril</span><span style="color: #96D0FF"> '\.rp_filter' /etc/sysctl.d/ /usr/lib/sysctl.d/)</span></span>
<span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sysctl</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-a</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">|</span><span style="color: #ADBAC7"> </span><span style="color: #F69D50">grep</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">'\.rp_filter'</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">|</span><span style="color: #ADBAC7"> </span><span style="color: #F69D50">awk</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">'{print $1" = 0"}'</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">|</span><span style="color: #ADBAC7"> </span><span style="color: #F69D50">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">tee</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-a</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">/etc/sysctl.d/1000-cilium.conf</span></span></code></pre></div>
<p>Then we need to refresh sysctl so those settings are applied:</p>
<div data-rehype-pretty-code-fragment=""><pre class="github-dark-dimmed" style="background-color: #22272e" tabindex="0" data-language="bash" data-theme="default"><code data-language="bash" data-theme="default" style="display: grid;"><span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">systemctl</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">restart</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">systemd-modules-load</span></span>
<span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sysctl</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">--system</span></span></code></pre></div>
<p>You should see it applying all the changes:</p>
<div data-rehype-pretty-code-fragment=""><pre class="github-dark-dimmed" style="background-color: #22272e" tabindex="0" data-language="" data-theme="default"><code data-language="" data-theme="default" style="display: grid;"><span data-line=""><span style="color: #adbac7">* Applying /etc/sysctl.d/k8s.conf ...</span></span>
<span data-line=""><span style="color: #adbac7">net.bridge.bridge-nf-call-ip6tables = 1</span></span>
<span data-line=""><span style="color: #adbac7">net.bridge.bridge-nf-call-iptables = 1</span></span>
<span data-line=""><span style="color: #adbac7">net.ipv4.ip_forward = 1</span></span></code></pre></div>
<p>If you do not, the netfilter module may not have loaded properly:</p>
<div data-rehype-pretty-code-fragment=""><pre class="github-dark-dimmed" style="background-color: #22272e" tabindex="0" data-language="bash" data-theme="default"><code data-language="bash" data-theme="default" style="display: grid;"><span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">lsmod</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">|</span><span style="color: #F69D50">grep</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">br_netfilter</span></span>
<span data-line=""><span style="color: #F69D50">br_netfilter</span><span style="color: #ADBAC7">           </span><span style="color: #6CB6FF">28672</span><span style="color: #ADBAC7">  </span><span style="color: #6CB6FF">0</span></span>
<span data-line=""><span style="color: #F69D50">bridge</span><span style="color: #ADBAC7">                </span><span style="color: #6CB6FF">176128</span><span style="color: #ADBAC7">  </span><span style="color: #6CB6FF">1</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">br_netfilter</span></span></code></pre></div>
<p>You want to make sure <code>rp_filter</code> is <code>0</code> everywhere as well for cilium:</p>
<div data-rehype-pretty-code-fragment=""><pre class="github-dark-dimmed" style="background-color: #22272e" tabindex="0" data-language="" data-theme="default"><code data-language="" data-theme="default" style="display: grid;"><span data-line=""><span style="color: #adbac7">❯ sudo sysctl -a | grep '\.rp_filter'</span></span>
<span data-line=""><span style="color: #adbac7">net.ipv4.conf.all.rp_filter = 0</span></span>
<span data-line=""><span style="color: #adbac7">net.ipv4.conf.cilium_host.rp_filter = 0</span></span>
<span data-line=""><span style="color: #adbac7">net.ipv4.conf.cilium_net.rp_filter = 0</span></span>
<span data-line=""><span style="color: #adbac7">net.ipv4.conf.cilium_vxlan.rp_filter = 0</span></span>
<span data-line=""><span style="color: #adbac7">net.ipv4.conf.default.rp_filter = 0</span></span>
<span data-line=""><span style="color: #adbac7">net.ipv4.conf.enp0s1.rp_filter = 0</span></span>
<span data-line=""><span style="color: #adbac7">net.ipv4.conf.lo.rp_filter = 0</span></span>
<span data-line=""><span style="color: #adbac7">net.ipv4.conf.lxc0965b7b545f7.rp_filter = 0</span></span>
<span data-line=""><span style="color: #adbac7">net.ipv4.conf.lxcb05ffd84ab74.rp_filter = 0</span></span></code></pre></div>
<p>Now lets pull down the container runtime we’ll be using which is containerd.</p>
<p>Ubuntu ships with a very old version of containerd so you need to upgrade to
the version shipped from the docker repos:
You can find which versions are available by running:</p>
<div data-rehype-pretty-code-fragment=""><pre class="github-dark-dimmed" style="background-color: #22272e" tabindex="0" data-language="bash" data-theme="default"><code data-language="bash" data-theme="default" style="display: grid;"><span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">curl</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-fsSL</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">https://download.docker.com/linux/ubuntu/gpg</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">|</span><span style="color: #ADBAC7"> </span><span style="color: #F69D50">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">gpg</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">--dearmor</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-o</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">/etc/apt/trusted.gpg.d/docker.gpg</span></span>
<span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">echo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">"deb https://download.docker.com/linux/ubuntu $(</span><span style="color: #F69D50">lsb_release</span><span style="color: #96D0FF"> </span><span style="color: #6CB6FF">-cs</span><span style="color: #96D0FF">) stable"</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">|</span><span style="color: #ADBAC7"> </span><span style="color: #F69D50">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">tee</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">/etc/apt/sources.list.d/docker.list</span></span>
<span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">apt-get</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">update</span></span></code></pre></div>
<div data-rehype-pretty-code-fragment=""><pre class="github-dark-dimmed" style="background-color: #22272e" tabindex="0" data-language="bash" data-theme="default"><code data-language="bash" data-theme="default" style="display: grid;"><span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">apt-cache</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">madison</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">containerd.io</span></span>
<span data-line=""><span style="color: #F69D50">containerd.io</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">|</span><span style="color: #ADBAC7">    </span><span style="color: #F69D50">1.6.8-1</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">|</span><span style="color: #ADBAC7"> </span><span style="color: #F69D50">https://download.docker.com/linux/ubuntu</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">jammy/stable</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">arm64</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">Packages</span></span>
<span data-line=""><span style="color: #F69D50">containerd.io</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">|</span><span style="color: #ADBAC7">    </span><span style="color: #F69D50">1.6.7-1</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">|</span><span style="color: #ADBAC7"> </span><span style="color: #F69D50">https://download.docker.com/linux/ubuntu</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">jammy/stable</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">arm64</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">Packages</span></span>
<span data-line=""><span style="color: #F69D50">containerd.io</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">|</span><span style="color: #ADBAC7">    </span><span style="color: #F69D50">1.6.6-1</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">|</span><span style="color: #ADBAC7"> </span><span style="color: #F69D50">https://download.docker.com/linux/ubuntu</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">jammy/stable</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">arm64</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">Packages</span></span>
<span data-line=""><span style="color: #F69D50">containerd.io</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">|</span><span style="color: #ADBAC7">    </span><span style="color: #F69D50">1.6.4-1</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">|</span><span style="color: #ADBAC7"> </span><span style="color: #F69D50">https://download.docker.com/linux/ubuntu</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">jammy/stable</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">arm64</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">Packages</span></span>
<span data-line=""><span style="color: #F69D50">containerd.io</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">|</span><span style="color: #ADBAC7">   </span><span style="color: #F69D50">1.5.11-1</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">|</span><span style="color: #ADBAC7"> </span><span style="color: #F69D50">https://download.docker.com/linux/ubuntu</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">jammy/stable</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">arm64</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">Packages</span></span>
<span data-line=""><span style="color: #F69D50">containerd.io</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">|</span><span style="color: #ADBAC7">   </span><span style="color: #F69D50">1.5.10-1</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">|</span><span style="color: #ADBAC7"> </span><span style="color: #F69D50">https://download.docker.com/linux/ubuntu</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">jammy/stable</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">arm64</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">Packages</span></span></code></pre></div>
<p>We are going to use the latest version available which was 1.6.8-1</p>
<div data-rehype-pretty-code-fragment=""><pre class="github-dark-dimmed" style="background-color: #22272e" tabindex="0" data-language="bash" data-theme="default"><code data-language="bash" data-theme="default" style="display: grid;"><span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">apt-get</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">install</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">containerd.io=</span><span style="color: #6CB6FF">1.6</span><span style="color: #96D0FF">.8-1</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-y</span></span></code></pre></div>
<p>Then we'll setup a configuration that enables containerd to use the systemd
cgroup.  We are hard coding this config instead of using <code>containerd config default</code>
because that currently has had a <a href="https://github.com/containerd/containerd/issues/4574">bug</a>
for many years that generates an invalid config.</p>
<div data-rehype-pretty-code-fragment=""><pre class="github-dark-dimmed" style="background-color: #22272e" tabindex="0" data-language="bash" data-theme="default"><code data-language="bash" data-theme="default" style="display: grid;"><span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">cat</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">&#x3C;&#x3C;</span><span style="color: #ADBAC7">EOF</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">|</span><span style="color: #ADBAC7"> sudo tee /etc/containerd/config.toml</span></span>
<span data-line=""><span style="color: #96D0FF">version = 2</span></span>
<span data-line=""><span style="color: #96D0FF">[plugins]</span></span>
<span data-line=""><span style="color: #96D0FF">  [plugins."io.containerd.grpc.v1.cri"]</span></span>
<span data-line=""><span style="color: #96D0FF">   [plugins."io.containerd.grpc.v1.cri".containerd]</span></span>
<span data-line=""><span style="color: #96D0FF">      [plugins."io.containerd.grpc.v1.cri".containerd.runtimes]</span></span>
<span data-line=""><span style="color: #96D0FF">        [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]</span></span>
<span data-line=""><span style="color: #96D0FF">          runtime_type = "io.containerd.runc.v2"</span></span>
<span data-line=""><span style="color: #96D0FF">          [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc.options]</span></span>
<span data-line=""><span style="color: #96D0FF">            SystemdCgroup = true</span></span>
<span data-line=""><span style="color: #ADBAC7">EOF</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">systemctl</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">restart</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">containerd.service</span></span></code></pre></div>
<p>You can verify its running with ctr:</p>
<div data-rehype-pretty-code-fragment=""><pre class="github-dark-dimmed" style="background-color: #22272e" tabindex="0" data-language="bash" data-theme="default"><code data-language="bash" data-theme="default" style="display: grid;"><span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">ctr</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">--address</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">/var/run/containerd/containerd.sock</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">containers</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">list</span></span>
<span data-line=""><span style="color: #F69D50">CONTAINER</span><span style="color: #ADBAC7">    </span><span style="color: #96D0FF">IMAGE</span><span style="color: #ADBAC7">    </span><span style="color: #96D0FF">RUNTIME</span></span></code></pre></div>
<p>Now that this is working we can move on to getting kubernetes installed!</p>
<h2>Using kubeadm!</h2>
<p>Now we need to get the kubernetes tools installed onto the system.  I’m going to be using 1.23
but to find the latest version you can run:</p>
<div data-rehype-pretty-code-fragment=""><pre class="github-dark-dimmed" style="background-color: #22272e" tabindex="0" data-language="bash" data-theme="default"><code data-language="bash" data-theme="default" style="display: grid;"><span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">apt-cache</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">madison</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">kubeadm</span><span style="color: #F47067">|</span><span style="color: #F69D50">head</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-n2</span></span>
<span data-line=""><span style="color: #ADBAC7">   </span><span style="color: #F69D50">kubeadm</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">|</span><span style="color: #ADBAC7">  </span><span style="color: #F69D50">1.23.5-00</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">|</span><span style="color: #ADBAC7"> </span><span style="color: #F69D50">http://apt.kubernetes.io</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">kubernetes-xenial/main</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">amd64</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">Packages</span></span>
<span data-line=""><span style="color: #ADBAC7">   </span><span style="color: #F69D50">kubeadm</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">|</span><span style="color: #ADBAC7">  </span><span style="color: #F69D50">1.23.4-00</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">|</span><span style="color: #ADBAC7"> </span><span style="color: #F69D50">http://apt.kubernetes.io</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">kubernetes-xenial/main</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">amd64</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">Packages</span></span></code></pre></div>
<p>Then install the version you want, we install kubelet and kubeadm here to make
sure the versions align:</p>
<div data-rehype-pretty-code-fragment=""><pre class="github-dark-dimmed" style="background-color: #22272e" tabindex="0" data-language="bash" data-theme="default"><code data-language="bash" data-theme="default" style="display: grid;"><span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">apt-get</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">install</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">kubeadm=</span><span style="color: #6CB6FF">1.23</span><span style="color: #96D0FF">.5-00</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">kubelet=</span><span style="color: #6CB6FF">1.23</span><span style="color: #96D0FF">.5-00</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">kubectl=</span><span style="color: #6CB6FF">1.23</span><span style="color: #96D0FF">.5-00</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-y</span></span></code></pre></div>
<p>This will pull in a few tools, including an alternative to <code>ctr</code> that we used earlier called
<code>crictl</code>.  You can check that it is available to you doing this:</p>
<div data-rehype-pretty-code-fragment=""><pre class="github-dark-dimmed" style="background-color: #22272e" tabindex="0" data-language="bash" data-theme="default"><code data-language="bash" data-theme="default" style="display: grid;"><span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">crictl</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">--runtime-endpoint=unix:///var/run/containerd/containerd.sock</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">ps</span></span></code></pre></div>
<p>We can finally init our cluster:</p>
<div data-rehype-pretty-code-fragment=""><pre class="github-dark-dimmed" style="background-color: #22272e" tabindex="0" data-language="bash" data-theme="default"><code data-language="bash" data-theme="default" style="display: grid;"><span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">kubeadm</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">init</span></span></code></pre></div>
<p>Once that finishes running it should give you some tips setup your configuration, it should look like this:</p>
<div data-rehype-pretty-code-fragment=""><pre class="github-dark-dimmed" style="background-color: #22272e" tabindex="0" data-language="bash" data-theme="default"><code data-language="bash" data-theme="default" style="display: grid;"><span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">mkdir</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-p</span><span style="color: #ADBAC7"> $HOME</span><span style="color: #96D0FF">/.kube</span></span>
<span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">cp</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-i</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">/etc/kubernetes/admin.conf</span><span style="color: #ADBAC7"> $HOME</span><span style="color: #96D0FF">/.kube/config</span></span>
<span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">chown</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">$(</span><span style="color: #F69D50">id</span><span style="color: #96D0FF"> </span><span style="color: #6CB6FF">-u</span><span style="color: #96D0FF">):$(</span><span style="color: #F69D50">id</span><span style="color: #96D0FF"> </span><span style="color: #6CB6FF">-g</span><span style="color: #96D0FF">)</span><span style="color: #ADBAC7"> $HOME</span><span style="color: #96D0FF">/.kube/config</span></span></code></pre></div>
<p>You can run those on the master node for now, but later I'll show you how to move
the config to your host computer.</p>
<p>Now you should be able to check that your node is not ready yet:</p>
<div data-rehype-pretty-code-fragment=""><pre class="github-dark-dimmed" style="background-color: #22272e" tabindex="0" data-language="bash" data-theme="default"><code data-language="bash" data-theme="default" style="display: grid;"><span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">kubectl</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">get</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">nodes</span></span>
<span data-line=""><span style="color: #F69D50">NAME</span><span style="color: #ADBAC7">           </span><span style="color: #96D0FF">STATUS</span><span style="color: #ADBAC7">     </span><span style="color: #96D0FF">ROLES</span><span style="color: #ADBAC7">                  </span><span style="color: #96D0FF">AGE</span><span style="color: #ADBAC7">     </span><span style="color: #96D0FF">VERSION</span></span>
<span data-line=""><span style="color: #F69D50">controlplane</span><span style="color: #ADBAC7">   </span><span style="color: #96D0FF">NotReady</span><span style="color: #ADBAC7">   </span><span style="color: #96D0FF">control-plane,master</span><span style="color: #ADBAC7">   </span><span style="color: #6CB6FF">4</span><span style="color: #96D0FF">m16s</span><span style="color: #ADBAC7">   </span><span style="color: #96D0FF">v1.23.5</span></span></code></pre></div>
<p><em>Note</em>: If you recieve "The connecto to the server was refused" error,
The cluster starting up and getting all the dependencies running could take
a bit of time.  So if you aren't able to communicate right away you can check
which pods are up and running with <code>crictl</code>.  You'll need <code>kube-apiserver</code> up
and running.  If it isn't you can check:</p>
<div data-rehype-pretty-code-fragment=""><pre class="github-dark-dimmed" style="background-color: #22272e" tabindex="0" data-language="bash" data-theme="default"><code data-language="bash" data-theme="default" style="display: grid;"><span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">crictl</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">--runtime-endpoint=unix:///var/run/containerd/containerd.sock</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">ps</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-a</span></span>
<span data-line=""><span style="color: #F69D50">CONTAINER</span><span style="color: #ADBAC7">           </span><span style="color: #96D0FF">IMAGE</span><span style="color: #ADBAC7">               </span><span style="color: #96D0FF">CREATED</span><span style="color: #ADBAC7">             </span><span style="color: #96D0FF">STATE</span><span style="color: #ADBAC7">               </span><span style="color: #96D0FF">NAME</span><span style="color: #ADBAC7">                      </span><span style="color: #96D0FF">ATTEMPT</span><span style="color: #ADBAC7">             </span><span style="color: #96D0FF">POD</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">ID</span><span style="color: #ADBAC7">              </span><span style="color: #96D0FF">POD</span></span>
<span data-line=""><span style="color: #F69D50">8322192c4605c</span><span style="color: #ADBAC7">       </span><span style="color: #96D0FF">bd8cc6d582470</span><span style="color: #ADBAC7">       </span><span style="color: #6CB6FF">36</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">seconds</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">ago</span><span style="color: #ADBAC7">      </span><span style="color: #96D0FF">Running</span><span style="color: #ADBAC7">             </span><span style="color: #96D0FF">kube-proxy</span><span style="color: #ADBAC7">                </span><span style="color: #6CB6FF">4</span><span style="color: #ADBAC7">                   </span><span style="color: #6CB6FF">344</span><span style="color: #96D0FF">c4f7fffbe8</span><span style="color: #ADBAC7">       </span><span style="color: #96D0FF">kube-proxy-drm46</span></span>
<span data-line=""><span style="color: #F69D50">30ce27c40adb2</span><span style="color: #ADBAC7">       </span><span style="color: #6CB6FF">81</span><span style="color: #96D0FF">a4a8a4ac639</span><span style="color: #ADBAC7">       </span><span style="color: #6CB6FF">2</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">minutes</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">ago</span><span style="color: #ADBAC7">       </span><span style="color: #96D0FF">Exited</span><span style="color: #ADBAC7">              </span><span style="color: #96D0FF">kube-controller-manager</span><span style="color: #ADBAC7">   </span><span style="color: #6CB6FF">4</span><span style="color: #ADBAC7">                   </span><span style="color: #6CB6FF">3</span><span style="color: #96D0FF">a819c3a864b2</span><span style="color: #ADBAC7">       </span><span style="color: #96D0FF">kube-controller-manager-controlplane</span></span>
<span data-line=""><span style="color: #F69D50">7709fd5e92898</span><span style="color: #ADBAC7">       </span><span style="color: #96D0FF">bd8cc6d582470</span><span style="color: #ADBAC7">       </span><span style="color: #6CB6FF">2</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">minutes</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">ago</span><span style="color: #ADBAC7">       </span><span style="color: #96D0FF">Exited</span><span style="color: #ADBAC7">              </span><span style="color: #96D0FF">kube-proxy</span><span style="color: #ADBAC7">                </span><span style="color: #6CB6FF">3</span><span style="color: #ADBAC7">                   </span><span style="color: #6CB6FF">7</span><span style="color: #96D0FF">cc6922c82015</span><span style="color: #ADBAC7">       </span><span style="color: #96D0FF">kube-proxy-drm46</span></span>
<span data-line=""><span style="color: #F69D50">10432b81d7c61</span><span style="color: #ADBAC7">       </span><span style="color: #6CB6FF">3767741</span><span style="color: #96D0FF">e7fba7</span><span style="color: #ADBAC7">       </span><span style="color: #6CB6FF">2</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">minutes</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">ago</span><span style="color: #ADBAC7">       </span><span style="color: #96D0FF">Exited</span><span style="color: #ADBAC7">              </span><span style="color: #96D0FF">kube-apiserver</span><span style="color: #ADBAC7">            </span><span style="color: #6CB6FF">4</span><span style="color: #ADBAC7">                   </span><span style="color: #96D0FF">e64ddf3679d98</span><span style="color: #ADBAC7">       </span><span style="color: #96D0FF">kube-apiserver-controlplane</span></span></code></pre></div>
<p>which will show you pods that have exited. You can grab the container ID for
kube-apiserver and read its logs:</p>
<div data-rehype-pretty-code-fragment=""><pre class="github-dark-dimmed" style="background-color: #22272e" tabindex="0" data-language="bash" data-theme="default"><code data-language="bash" data-theme="default" style="display: grid;"><span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">crictl</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">--runtime-endpoint=unix:///var/run/containerd/containerd.sock</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">logs</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">10432</span><span style="color: #96D0FF">b81d7c61</span></span></code></pre></div>
<p>There are a few ways to figure out why the node isn’t ready yet.  Usually I would check the
<code>kubelet</code> logs first:</p>
<div data-rehype-pretty-code-fragment=""><pre class="github-dark-dimmed" style="background-color: #22272e" tabindex="0" data-language="bash" data-theme="default"><code data-language="bash" data-theme="default" style="display: grid;"><span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">journalctl</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-flu</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">kubelet</span></span>
<span data-line=""><span style="color: #F69D50">--</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">Logs</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">begin</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">at</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">Sun</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">2022</span><span style="color: #96D0FF">-04-17</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">19</span><span style="color: #96D0FF">:22:19</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">AST.</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">--</span></span>
<span data-line=""><span style="color: #F69D50">Apr</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">17</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">20</span><span style="color: #96D0FF">:53:15</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">controlplane</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">kubelet[</span><span style="color: #6CB6FF">19727</span><span style="color: #96D0FF">]:</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">E0417</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">20</span><span style="color: #96D0FF">:53:15.951350</span><span style="color: #ADBAC7">   </span><span style="color: #6CB6FF">19727</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">kubelet.go:2347]</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">"Container runtime network not ready"</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">networkReady="NetworkReady=false reason:NetworkPluginNotReady message:Network plugin returns error: cni plugin not initialized"</span></span>
<span data-line=""><span style="color: #F69D50">Apr</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">17</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">20</span><span style="color: #96D0FF">:53:20</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">controlplane</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">kubelet[</span><span style="color: #6CB6FF">19727</span><span style="color: #96D0FF">]:</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">E0417</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">20</span><span style="color: #96D0FF">:53:20.952148</span><span style="color: #ADBAC7">   </span><span style="color: #6CB6FF">19727</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">kubelet.go:2347]</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">"Container runtime network not ready"</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">networkReady="NetworkReady=false reason:NetworkPluginNotReady message:Network plugin returns error: cni plugin not initialized"</span></span></code></pre></div>
<p>It is clear the problem is that we are missing the CNI.  The other way you can find out what is
going on is describing the node:</p>
<div data-rehype-pretty-code-fragment=""><pre class="github-dark-dimmed" style="background-color: #22272e" tabindex="0" data-language="bash" data-theme="default"><code data-language="bash" data-theme="default" style="display: grid;"><span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">kubectl</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">describe</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">node</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">controlplane</span></span></code></pre></div>
<p>This will have a lot of information but if you scroll through there looking at <code>Reason</code> you
might see something useful.  In this case under <code>Lease</code> you would see:</p>
<div data-rehype-pretty-code-fragment=""><pre class="github-dark-dimmed" style="background-color: #22272e" tabindex="0" data-language="bash" data-theme="default"><code data-language="bash" data-theme="default" style="display: grid;"><span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">kubectl</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">describe</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">node</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">controlplane</span><span style="color: #F47067">|</span><span style="color: #F69D50">grep</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">NotReady</span></span>
<span data-line=""><span style="color: #F69D50">Ready</span><span style="color: #ADBAC7">            </span><span style="color: #96D0FF">False</span><span style="color: #ADBAC7">   </span><span style="color: #96D0FF">Sun,</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">17</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">Apr</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">2022</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">20</span><span style="color: #96D0FF">:53:37</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-0400</span><span style="color: #ADBAC7">   </span><span style="color: #96D0FF">Sun,</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">17</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">Apr</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">2022</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">20</span><span style="color: #96D0FF">:43:07</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-0400</span><span style="color: #ADBAC7">   </span><span style="color: #96D0FF">KubeletNotReady</span><span style="color: #ADBAC7">              </span><span style="color: #96D0FF">container</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">runtime</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">network</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">not</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">ready:</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">NetworkReady=</span><span style="color: #6CB6FF">false</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">reason:NetworkPluginNotReady</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">message:Network</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">plugin</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">returns</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">error:</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">cni</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">plugin</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">not</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">initialize</span></span></code></pre></div>
<p>Lets get our CNI installed, we’ll be using cilium!</p>
<h2>Setting up your CNI!</h2>
<p>Cilium has great documentation over <a href="https://docs.cilium.io/en/v1.9/gettingstarted/k8s-install-kubeadm/">here</a>,
but I’ll walk you through it anyways.  I do recommend checking out their documentation so you
are familiar with it.   We will use <code>helm</code> to pull down the version of cilium we want:</p>
<div data-rehype-pretty-code-fragment=""><pre class="github-dark-dimmed" style="background-color: #22272e" tabindex="0" data-language="bash" data-theme="default"><code data-language="bash" data-theme="default" style="display: grid;"><span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">curl</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-fsSL</span><span style="color: #ADBAC7">  </span><span style="color: #96D0FF">https://baltocdn.com/helm/signing.asc</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">|</span><span style="color: #ADBAC7"> </span><span style="color: #F69D50">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">gpg</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">--dearmor</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-o</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">/etc/apt/trusted.gpg.d/helm.gpg</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">apt-get</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">install</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">apt-transport-https</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">--yes</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">echo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">"deb https://baltocdn.com/helm/stable/debian/ all main"</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">|</span><span style="color: #ADBAC7"> </span><span style="color: #F69D50">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">tee</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">/etc/apt/sources.list.d/helm-stable-debian.list</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">apt-get</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">update</span></span>
<span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">apt-get</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">install</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">helm</span></span></code></pre></div>
<p>Now we can install cilium!  It is <em>very</em> important that you pay attention to the
compatibility of cilium with the version of kubernetes you are intstalling. Check
the compatibility list <a href="https://docs.cilium.io/en/v1.12/concepts/kubernetes/compatibility/">here</a>.</p>
<div data-rehype-pretty-code-fragment=""><pre class="github-dark-dimmed" style="background-color: #22272e" tabindex="0" data-language="bash" data-theme="default"><code data-language="bash" data-theme="default" style="display: grid;"><span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">helm</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">repo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">add</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">cilium</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">https://helm.cilium.io/</span></span>
<span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">helm</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">repo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">update</span></span></code></pre></div>
<p>Once the repo is added you can list the versions available:</p>
<div data-rehype-pretty-code-fragment=""><pre class="github-dark-dimmed" style="background-color: #22272e" tabindex="0" data-language="bash" data-theme="default"><code data-language="bash" data-theme="default" style="display: grid;"><span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">helm</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">search</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">repo</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-l</span><span style="color: #F47067">|</span><span style="color: #F69D50">head</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-n8</span></span>
<span data-line=""><span style="color: #F69D50">NAME</span><span style="color: #ADBAC7">           	</span><span style="color: #96D0FF">CHART</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">VERSION</span><span style="color: #ADBAC7">	</span><span style="color: #96D0FF">APP</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">VERSION</span><span style="color: #ADBAC7">	</span><span style="color: #96D0FF">DESCRIPTION</span></span>
<span data-line=""><span style="color: #F69D50">cilium/cilium</span><span style="color: #ADBAC7">  	</span><span style="color: #6CB6FF">1.12</span><span style="color: #96D0FF">.1</span><span style="color: #ADBAC7">       	</span><span style="color: #6CB6FF">1.12</span><span style="color: #96D0FF">.1</span><span style="color: #ADBAC7">     	</span><span style="color: #96D0FF">eBPF-based</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">Networking,</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">Security,</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">and</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">Observability</span></span>
<span data-line=""><span style="color: #F69D50">cilium/cilium</span><span style="color: #ADBAC7">  	</span><span style="color: #6CB6FF">1.12</span><span style="color: #96D0FF">.0</span><span style="color: #ADBAC7">       	</span><span style="color: #6CB6FF">1.12</span><span style="color: #96D0FF">.0</span><span style="color: #ADBAC7">     	</span><span style="color: #96D0FF">eBPF-based</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">Networking,</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">Security,</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">and</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">Observability</span></span>
<span data-line=""><span style="color: #F69D50">cilium/cilium</span><span style="color: #ADBAC7">  	</span><span style="color: #6CB6FF">1.11</span><span style="color: #96D0FF">.8</span><span style="color: #ADBAC7">       	</span><span style="color: #6CB6FF">1.11</span><span style="color: #96D0FF">.8</span><span style="color: #ADBAC7">     	</span><span style="color: #96D0FF">eBPF-based</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">Networking,</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">Security,</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">and</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">Observability</span></span>
<span data-line=""><span style="color: #F69D50">cilium/cilium</span><span style="color: #ADBAC7">  	</span><span style="color: #6CB6FF">1.11</span><span style="color: #96D0FF">.7</span><span style="color: #ADBAC7">       	</span><span style="color: #6CB6FF">1.11</span><span style="color: #96D0FF">.7</span><span style="color: #ADBAC7">     	</span><span style="color: #96D0FF">eBPF-based</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">Networking,</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">Security,</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">and</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">Observability</span></span>
<span data-line=""><span style="color: #F69D50">cilium/cilium</span><span style="color: #ADBAC7">  	</span><span style="color: #6CB6FF">1.11</span><span style="color: #96D0FF">.6</span><span style="color: #ADBAC7">       	</span><span style="color: #6CB6FF">1.11</span><span style="color: #96D0FF">.6</span><span style="color: #ADBAC7">     	</span><span style="color: #96D0FF">eBPF-based</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">Networking,</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">Security,</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">and</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">Observability</span></span>
<span data-line=""><span style="color: #F69D50">cilium/cilium</span><span style="color: #ADBAC7">  	</span><span style="color: #6CB6FF">1.11</span><span style="color: #96D0FF">.5</span><span style="color: #ADBAC7">       	</span><span style="color: #6CB6FF">1.11</span><span style="color: #96D0FF">.5</span><span style="color: #ADBAC7">     	</span><span style="color: #96D0FF">eBPF-based</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">Networking,</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">Security,</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">and</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">Observability</span></span>
<span data-line=""><span style="color: #F69D50">cilium/cilium</span><span style="color: #ADBAC7">  	</span><span style="color: #6CB6FF">1.11</span><span style="color: #96D0FF">.4</span><span style="color: #ADBAC7">       	</span><span style="color: #6CB6FF">1.11</span><span style="color: #96D0FF">.4</span><span style="color: #ADBAC7">     	</span><span style="color: #96D0FF">eBPF-based</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">Networking,</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">Security,</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">and</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">Observability</span></span></code></pre></div>
<p>So we want <code>1.11.4</code>:</p>
<div data-rehype-pretty-code-fragment=""><pre class="github-dark-dimmed" style="background-color: #22272e" tabindex="0" data-language="bash" data-theme="default"><code data-language="bash" data-theme="default" style="display: grid;"><span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">helm</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">install</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">cilium</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">cilium/cilium</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">--namespace</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">kube-system</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">--version</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">1.11</span><span style="color: #96D0FF">.4</span></span></code></pre></div>
<p>Now our node should be ready!</p>
<div data-rehype-pretty-code-fragment=""><pre class="github-dark-dimmed" style="background-color: #22272e" tabindex="0" data-language="bash" data-theme="default"><code data-language="bash" data-theme="default" style="display: grid;"><span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">kubectl</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">get</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">node</span></span>
<span data-line=""><span style="color: #F69D50">NAME</span><span style="color: #ADBAC7">           </span><span style="color: #96D0FF">STATUS</span><span style="color: #ADBAC7">   </span><span style="color: #96D0FF">ROLES</span><span style="color: #ADBAC7">                  </span><span style="color: #96D0FF">AGE</span><span style="color: #ADBAC7">   </span><span style="color: #96D0FF">VERSION</span></span>
<span data-line=""><span style="color: #F69D50">controlplane</span><span style="color: #ADBAC7">   </span><span style="color: #96D0FF">Ready</span><span style="color: #ADBAC7">    </span><span style="color: #96D0FF">control-plane,master</span><span style="color: #ADBAC7">   </span><span style="color: #6CB6FF">24</span><span style="color: #96D0FF">m</span><span style="color: #ADBAC7">   </span><span style="color: #96D0FF">v1.23.5</span></span></code></pre></div>
<p>Time to join our worker to the cluster!</p>
<h2>Joining a worker to the cluster!</h2>
<p>We have to go through the same steps as the controlplane to get the point that we have a
container runtime and <code>kubeadm</code>.   I’m not going to talk about the commands a second time but
I’ll re-iterate them here for ease of following along.</p>
<p>First open up another shell and connect to the worker:</p>
<div data-rehype-pretty-code-fragment=""><pre class="github-dark-dimmed" style="background-color: #22272e" tabindex="0" data-language="bash" data-theme="default"><code data-language="bash" data-theme="default" style="display: grid;"><span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">multipass</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">shell</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">worker</span></span></code></pre></div>
<p>Now run the following commands:</p>
<div data-rehype-pretty-code-fragment=""><pre class="github-dark-dimmed" style="background-color: #22272e" tabindex="0" data-language="bash" data-theme="default"><code data-language="bash" data-theme="default" style="display: grid;"><span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">echo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">"deb  http://apt.kubernetes.io/  kubernetes-xenial  main"</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">|</span><span style="color: #ADBAC7"> </span><span style="color: #F69D50">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">tee</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">/etc/apt/sources.list.d/kubernetes.list</span></span>
<span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">curl</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-fsSL</span><span style="color: #ADBAC7">  </span><span style="color: #96D0FF">https://packages.cloud.google.com/apt/doc/apt-key.gpg</span><span style="color: #F47067">|</span><span style="color: #F69D50">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">gpg</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">--dearmor</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-o</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">/etc/apt/trusted.gpg.d/k8s.gpg</span></span>
<span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">curl</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-fsSL</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">https://download.docker.com/linux/ubuntu/gpg</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">|</span><span style="color: #ADBAC7"> </span><span style="color: #F69D50">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">gpg</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">--dearmor</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-o</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">/etc/apt/trusted.gpg.d/docker.gpg</span></span>
<span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">echo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">"deb https://download.docker.com/linux/ubuntu $(</span><span style="color: #F69D50">lsb_release</span><span style="color: #96D0FF"> </span><span style="color: #6CB6FF">-cs</span><span style="color: #96D0FF">) stable"</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">|</span><span style="color: #ADBAC7"> </span><span style="color: #F69D50">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">tee</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">/etc/apt/sources.list.d/docker.list</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">cat</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">&#x3C;&#x3C;</span><span style="color: #ADBAC7">EOF</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">|</span><span style="color: #ADBAC7"> sudo tee /etc/modules-load.d/k8s.conf</span></span>
<span data-line=""><span style="color: #96D0FF">overlay</span></span>
<span data-line=""><span style="color: #96D0FF">br_netfilter</span></span>
<span data-line=""><span style="color: #ADBAC7">EOF</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sed</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-i</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-e</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">'/net.ipv4.conf.*.rp_filter/d'</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">$(</span><span style="color: #F69D50">grep</span><span style="color: #96D0FF"> </span><span style="color: #6CB6FF">-ril</span><span style="color: #96D0FF"> '\.rp_filter' /etc/sysctl.d/ /usr/lib/sysctl.d/)</span></span>
<span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sysctl</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-a</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">|</span><span style="color: #ADBAC7"> </span><span style="color: #F69D50">grep</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">'\.rp_filter'</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">|</span><span style="color: #ADBAC7"> </span><span style="color: #F69D50">awk</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">'{print $1" = 0"}'</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">|</span><span style="color: #ADBAC7"> </span><span style="color: #F69D50">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">tee</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-a</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">/etc/sysctl.d/1000-cilium.conf</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">cat</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">&#x3C;&#x3C;</span><span style="color: #ADBAC7">EOF</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">|</span><span style="color: #ADBAC7"> sudo tee /etc/sysctl.d/k8s.conf</span></span>
<span data-line=""><span style="color: #96D0FF">net.bridge.bridge-nf-call-ip6tables = 1</span></span>
<span data-line=""><span style="color: #96D0FF">net.bridge.bridge-nf-call-iptables  = 1</span></span>
<span data-line=""><span style="color: #96D0FF">net.ipv4.ip_forward                 = 1</span></span>
<span data-line=""><span style="color: #ADBAC7">EOF</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">systemctl</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">restart</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">systemd-modules-load</span></span>
<span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sysctl</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">--system</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">apt-get</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">update</span><span style="color: #ADBAC7"> &#x26;&#x26; </span><span style="color: #F69D50">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">apt-get</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">upgrade</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-y</span></span>
<span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">apt-get</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">install</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">containerd.io=</span><span style="color: #6CB6FF">1.6</span><span style="color: #96D0FF">.8-1</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-y</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">cat</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">&#x3C;&#x3C;</span><span style="color: #ADBAC7">EOF</span><span style="color: #ADBAC7"> </span><span style="color: #F47067">|</span><span style="color: #ADBAC7"> sudo tee /etc/containerd/config.toml</span></span>
<span data-line=""><span style="color: #96D0FF">version = 2</span></span>
<span data-line=""><span style="color: #96D0FF">[plugins]</span></span>
<span data-line=""><span style="color: #96D0FF">  [plugins."io.containerd.grpc.v1.cri"]</span></span>
<span data-line=""><span style="color: #96D0FF">   [plugins."io.containerd.grpc.v1.cri".containerd]</span></span>
<span data-line=""><span style="color: #96D0FF">      [plugins."io.containerd.grpc.v1.cri".containerd.runtimes]</span></span>
<span data-line=""><span style="color: #96D0FF">        [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]</span></span>
<span data-line=""><span style="color: #96D0FF">          runtime_type = "io.containerd.runc.v2"</span></span>
<span data-line=""><span style="color: #96D0FF">          [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc.options]</span></span>
<span data-line=""><span style="color: #96D0FF">            SystemdCgroup = true</span></span>
<span data-line=""><span style="color: #ADBAC7">EOF</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">systemctl</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">restart</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">containerd.service</span></span>
<span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">apt-get</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">install</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">kubeadm=</span><span style="color: #6CB6FF">1.23</span><span style="color: #96D0FF">.5-00</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">kubelet=</span><span style="color: #6CB6FF">1.23</span><span style="color: #96D0FF">.5-00</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">kubectl=</span><span style="color: #6CB6FF">1.23</span><span style="color: #96D0FF">.5-00</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">-y</span></span>
<span data-line=""> </span></code></pre></div>
<p>From there we should be ready to join the cluster.   When we ran <code>kubeadm init</code> previously it
printed a join command out that we could use but I’m going to show you how to do it if you
were coming back later and no longer had that token.</p>
<p>Back on the <em>controplane</em> node run:</p>
<div data-rehype-pretty-code-fragment=""><pre class="github-dark-dimmed" style="background-color: #22272e" tabindex="0" data-language="bash" data-theme="default"><code data-language="bash" data-theme="default" style="display: grid;"><span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">kubeadm</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">token</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">create</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">--print-join-command</span></span>
<span data-line=""><span style="color: #F69D50">kubeadm</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">join</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">192.168</span><span style="color: #96D0FF">.64.7:6443</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">--token</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">wxs197.cco6mjj9ricvu8ov</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">--discovery-token-ca-cert-hash</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sha256:bd01c065240fa76f30a02ecb70a8cea6e329c9678994d4da1f6ccac7694b97fb</span></span></code></pre></div>
<p>Now copy that command and run it with <code>sudo</code> on the worker:</p>
<div data-rehype-pretty-code-fragment=""><pre class="github-dark-dimmed" style="background-color: #22272e" tabindex="0" data-language="bash" data-theme="default"><code data-language="bash" data-theme="default" style="display: grid;"><span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sudo</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">kubeadm</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">join</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">192.168</span><span style="color: #96D0FF">.64.7:6443</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">--token</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">wxs197.cco6mjj9ricvu8ov</span><span style="color: #ADBAC7"> </span><span style="color: #6CB6FF">--discovery-token-ca-cert-hash</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">sha256:bd01c065240fa76f30a02ecb70a8cea6e329c9678994d4da1f6ccac7694b97fb</span></span></code></pre></div>
<p>After this completes it’ll take a minute or two for everything to be synced up but if you go
back to the master node you should have 2 ready nodes now:</p>
<div data-rehype-pretty-code-fragment=""><pre class="github-dark-dimmed" style="background-color: #22272e" tabindex="0" data-language="bash" data-theme="default"><code data-language="bash" data-theme="default" style="display: grid;"><span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">kubectl</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">get</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">nodes</span></span>
<span data-line=""><span style="color: #F69D50">NAME</span><span style="color: #ADBAC7">           </span><span style="color: #96D0FF">STATUS</span><span style="color: #ADBAC7">   </span><span style="color: #96D0FF">ROLES</span><span style="color: #ADBAC7">                  </span><span style="color: #96D0FF">AGE</span><span style="color: #ADBAC7">   </span><span style="color: #96D0FF">VERSION</span></span>
<span data-line=""><span style="color: #F69D50">controlplane</span><span style="color: #ADBAC7">   </span><span style="color: #96D0FF">Ready</span><span style="color: #ADBAC7">    </span><span style="color: #96D0FF">control-plane,master</span><span style="color: #ADBAC7">   </span><span style="color: #6CB6FF">46</span><span style="color: #96D0FF">m</span><span style="color: #ADBAC7">   </span><span style="color: #96D0FF">v1.23.5</span></span>
<span data-line=""><span style="color: #F69D50">worker</span><span style="color: #ADBAC7">         </span><span style="color: #96D0FF">Ready</span><span style="color: #ADBAC7">    </span><span style="color: #F47067">&#x3C;</span><span style="color: #96D0FF">non</span><span style="color: #ADBAC7">e</span><span style="color: #F47067">></span><span style="color: #ADBAC7">                 </span><span style="color: #6CB6FF">79</span><span style="color: #96D0FF">s</span><span style="color: #ADBAC7">   </span><span style="color: #96D0FF">v1.23.5</span></span></code></pre></div>
<h2>Accessing the cluster outside of the VMs!</h2>
<p>Now the final part is to get the <code>admin.conf</code> as a kubeconfig on your machine so you can control
it from outside of the cluster.   To do this we can use scp</p>
<div data-rehype-pretty-code-fragment=""><pre class="github-dark-dimmed" style="background-color: #22272e" tabindex="0" data-language="bash" data-theme="default"><code data-language="bash" data-theme="default" style="display: grid;"><span data-line=""><span style="color: #F69D50">multipass</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">transfer</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">controlplane:/home/ubuntu/.kube/config</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">local.config</span></span></code></pre></div>
<p>Normally kubernetes configuration is in ~/.kube/config but I like to maint a separate file for
each cluster and then I set the <code>KUBECONFIG</code> env var to access it.</p>
<div data-rehype-pretty-code-fragment=""><pre class="github-dark-dimmed" style="background-color: #22272e" tabindex="0" data-language="bash" data-theme="default"><code data-language="bash" data-theme="default" style="display: grid;"><span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">export</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">KUBECONFIG=local.config</span></span>
<span data-line=""><span style="color: #F69D50">❯</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">kubectl</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">get</span><span style="color: #ADBAC7"> </span><span style="color: #96D0FF">nodes</span></span>
<span data-line=""><span style="color: #F69D50">NAME</span><span style="color: #ADBAC7">           </span><span style="color: #96D0FF">STATUS</span><span style="color: #ADBAC7">   </span><span style="color: #96D0FF">ROLES</span><span style="color: #ADBAC7">                  </span><span style="color: #96D0FF">AGE</span><span style="color: #ADBAC7">   </span><span style="color: #96D0FF">VERSION</span></span>
<span data-line=""><span style="color: #F69D50">controlplane</span><span style="color: #ADBAC7">   </span><span style="color: #96D0FF">Ready</span><span style="color: #ADBAC7">    </span><span style="color: #96D0FF">control-plane,master</span><span style="color: #ADBAC7">   </span><span style="color: #6CB6FF">56</span><span style="color: #96D0FF">m</span><span style="color: #ADBAC7">   </span><span style="color: #96D0FF">v1.23.5</span></span>
<span data-line=""><span style="color: #F69D50">worker</span><span style="color: #ADBAC7">         </span><span style="color: #96D0FF">Ready</span><span style="color: #ADBAC7">    </span><span style="color: #F47067">&#x3C;</span><span style="color: #96D0FF">non</span><span style="color: #ADBAC7">e</span><span style="color: #F47067">></span><span style="color: #ADBAC7">                 </span><span style="color: #6CB6FF">11</span><span style="color: #96D0FF">m</span><span style="color: #ADBAC7">   </span><span style="color: #96D0FF">v1.23.5</span></span></code></pre></div></div></article></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":["2022","local_kubeadm_cluster"],"path":"2022/local_kubeadm_cluster","contentHtml":"\u003cp\u003eI’m going to show you how to get a real kubernetes cluster setup locally on top of virtual\nmachines!  I’ll be using multipass but feel free to use virtualbox, proxmox, or whatever your\nfavorite cloud provider is.\u003c/p\u003e\n\u003cp\u003ekubeadm a production ready kubernetes install tool and I prefer to use it over minikube, kind,\netc. because it gives you a more real world experience for \u003cem\u003emanaging\u003c/em\u003e the kubernetes cluster.\nThis isn’t important if you are a user of the cluster but if you have to run your own this is\na great way to gain some daily experience.\u003c/p\u003e\n\u003cp\u003eThe kubernetes documentation on kubeadm is great and you can find it \u003ca href=\"https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/\"\u003ehere\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eThe differences between this blog and the kubernetes docs is that they leave a lot of decisions\nup to the reader such as:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003echoosing a container runtime\u003c/li\u003e\n\u003cli\u003eSelecting and installing a CNI (container network interface)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eI’m going to be opinionated and make specific technology decisions such as using containerd and\ncilium so that you don't have to think about those decisions.\u003c/p\u003e\n\u003ch2\u003eGetting your Virtual Machines setup!\u003c/h2\u003e\n\u003cp\u003eThe minimum requirements for a control plane node in kubernetes is 2gb of RAM and 2 CPUs.  Since\nwe actually want to be able to schedule workloads on the workers afterwards we are going to setup\na cluster that looks like this:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eControl Plane: 2gb RAM, 2 CPU\u003c/li\u003e\n\u003cli\u003eWorker: 4gb RAM, 2 CPU\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eSince we’ll be using multipass to launch the nodes, we can do that now:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"\u003e\u003ccode data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003emultipass\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003elaunch\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-c\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e2\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-m\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e4\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eG\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-d\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e10\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eG\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-n\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003econtrolplane\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e22.04\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003emultipass\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003elaunch\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-c\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e2\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-m\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e4\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eG\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-d\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e10\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eG\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-n\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eworker\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e22.04\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003emultipass\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003elist\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003eName\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e                    \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eState\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e             \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eIPv4\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e             \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eImage\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003econtrolplane\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e            \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eRunning\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e           \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e192.168\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e.64.7\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e     \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eUbuntu\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e22.04\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eLTS\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003eworker\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e                  \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eRunning\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e           \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e192.168\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e.64.8\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e     \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eUbuntu\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e22.04\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eLTS\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eNow we can start working on our controlplane first, lets shell in:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"\u003e\u003ccode data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003emultipass\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eshell\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003econtrolplane\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eLets first add the kubernetes repo to the system so we have access to all the kubernetes tools:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"\u003e\u003ccode data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eecho\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e\"deb  http://apt.kubernetes.io/  kubernetes-xenial  main\"\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003etee\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e/etc/apt/sources.list.d/kubernetes.list\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ecurl\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-fsSL\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ehttps://packages.cloud.google.com/apt/doc/apt-key.gpg\u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003egpg\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e--dearmor\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-o\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e/etc/apt/trusted.gpg.d/k8s.gpg\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eapt-get\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eupdate\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u0026#x26;\u0026#x26; \u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eapt-get\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eupgrade\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-y\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eNow that our system is setup, we can move on to getting a container runtime.\u003c/p\u003e\n\u003ch2\u003eGetting your Container Runtime!\u003c/h2\u003e\n\u003cp\u003eBefore we start pulling in kubernetes components we need to get a container runtime setup on the\nmachine.   We we are going to use containerd for this purpose.  You can view the docs of for it\n\u003ca href=\"https://github.com/containerd/containerd/blob/main/docs/getting-started.md\"\u003ehere\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eWhich will download the latest binary and set it up.   I’m going to walk you through how to do it\nusing the version packaged with Ubuntu which could be older than the latest release.\u003c/p\u003e\n\u003cp\u003eFirst thing we want to do is configure the networking to allow iptables to manage:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"\u003e\u003ccode data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ecat\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e\u0026#x3C;\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003eEOF\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e sudo tee /etc/modules-load.d/k8s.conf\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #96D0FF\"\u003eoverlay\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #96D0FF\"\u003ebr_netfilter\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #ADBAC7\"\u003eEOF\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ecat\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e\u0026#x3C;\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003eEOF\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e sudo tee /etc/sysctl.d/k8s.conf\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #96D0FF\"\u003enet.bridge.bridge-nf-call-ip6tables = 1\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #96D0FF\"\u003enet.bridge.bridge-nf-call-iptables  = 1\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #96D0FF\"\u003enet.ipv4.ip_forward                 = 1\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #ADBAC7\"\u003eEOF\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWe also need to disable some default systemd settings for \u003ccode\u003erp_filter\u003c/code\u003e  because\nthey are not compatible with cilium. See the bug report\n\u003ca href=\"https://github.com/cilium/cilium/commit/cabc6581b8128681f4ed23f8d6dc463180eea61e\"\u003ehere\u003c/a\u003e\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"\u003e\u003ccode data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esed\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-i\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-e\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e'/net.ipv4.conf.*.rp_filter/d'\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e$(\u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003egrep\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-ril\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e '\\.rp_filter' /etc/sysctl.d/ /usr/lib/sysctl.d/)\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esysctl\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-a\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003egrep\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e'\\.rp_filter'\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003eawk\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e'{print $1\" = 0\"}'\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003etee\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-a\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e/etc/sysctl.d/1000-cilium.conf\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThen we need to refresh sysctl so those settings are applied:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"\u003e\u003ccode data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esystemctl\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003erestart\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esystemd-modules-load\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esysctl\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e--system\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eYou should see it applying all the changes:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"\" data-theme=\"default\"\u003e\u003ccode data-language=\"\" data-theme=\"default\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #adbac7\"\u003e* Applying /etc/sysctl.d/k8s.conf ...\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #adbac7\"\u003enet.bridge.bridge-nf-call-ip6tables = 1\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #adbac7\"\u003enet.bridge.bridge-nf-call-iptables = 1\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #adbac7\"\u003enet.ipv4.ip_forward = 1\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIf you do not, the netfilter module may not have loaded properly:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"\u003e\u003ccode data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003elsmod\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003egrep\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ebr_netfilter\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003ebr_netfilter\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e           \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e28672\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e0\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003ebridge\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e                \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e176128\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e1\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ebr_netfilter\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eYou want to make sure \u003ccode\u003erp_filter\u003c/code\u003e is \u003ccode\u003e0\u003c/code\u003e everywhere as well for cilium:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"\" data-theme=\"default\"\u003e\u003ccode data-language=\"\" data-theme=\"default\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #adbac7\"\u003e❯ sudo sysctl -a | grep '\\.rp_filter'\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #adbac7\"\u003enet.ipv4.conf.all.rp_filter = 0\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #adbac7\"\u003enet.ipv4.conf.cilium_host.rp_filter = 0\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #adbac7\"\u003enet.ipv4.conf.cilium_net.rp_filter = 0\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #adbac7\"\u003enet.ipv4.conf.cilium_vxlan.rp_filter = 0\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #adbac7\"\u003enet.ipv4.conf.default.rp_filter = 0\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #adbac7\"\u003enet.ipv4.conf.enp0s1.rp_filter = 0\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #adbac7\"\u003enet.ipv4.conf.lo.rp_filter = 0\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #adbac7\"\u003enet.ipv4.conf.lxc0965b7b545f7.rp_filter = 0\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #adbac7\"\u003enet.ipv4.conf.lxcb05ffd84ab74.rp_filter = 0\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eNow lets pull down the container runtime we’ll be using which is containerd.\u003c/p\u003e\n\u003cp\u003eUbuntu ships with a very old version of containerd so you need to upgrade to\nthe version shipped from the docker repos:\nYou can find which versions are available by running:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"\u003e\u003ccode data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ecurl\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-fsSL\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ehttps://download.docker.com/linux/ubuntu/gpg\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003egpg\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e--dearmor\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-o\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e/etc/apt/trusted.gpg.d/docker.gpg\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eecho\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e\"deb https://download.docker.com/linux/ubuntu $(\u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003elsb_release\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-cs\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e) stable\"\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003etee\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e/etc/apt/sources.list.d/docker.list\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eapt-get\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eupdate\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"\u003e\u003ccode data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eapt-cache\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003emadison\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003econtainerd.io\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003econtainerd.io\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003e1.6.8-1\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003ehttps://download.docker.com/linux/ubuntu\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ejammy/stable\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003earm64\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ePackages\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003econtainerd.io\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003e1.6.7-1\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003ehttps://download.docker.com/linux/ubuntu\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ejammy/stable\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003earm64\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ePackages\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003econtainerd.io\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003e1.6.6-1\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003ehttps://download.docker.com/linux/ubuntu\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ejammy/stable\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003earm64\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ePackages\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003econtainerd.io\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003e1.6.4-1\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003ehttps://download.docker.com/linux/ubuntu\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ejammy/stable\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003earm64\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ePackages\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003econtainerd.io\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e   \u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003e1.5.11-1\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003ehttps://download.docker.com/linux/ubuntu\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ejammy/stable\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003earm64\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ePackages\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003econtainerd.io\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e   \u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003e1.5.10-1\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003ehttps://download.docker.com/linux/ubuntu\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ejammy/stable\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003earm64\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ePackages\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWe are going to use the latest version available which was 1.6.8-1\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"\u003e\u003ccode data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eapt-get\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003einstall\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003econtainerd.io=\u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e1.6\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e.8-1\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-y\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThen we'll setup a configuration that enables containerd to use the systemd\ncgroup.  We are hard coding this config instead of using \u003ccode\u003econtainerd config default\u003c/code\u003e\nbecause that currently has had a \u003ca href=\"https://github.com/containerd/containerd/issues/4574\"\u003ebug\u003c/a\u003e\nfor many years that generates an invalid config.\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"\u003e\u003ccode data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ecat\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e\u0026#x3C;\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003eEOF\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e sudo tee /etc/containerd/config.toml\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #96D0FF\"\u003eversion = 2\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #96D0FF\"\u003e[plugins]\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #96D0FF\"\u003e  [plugins.\"io.containerd.grpc.v1.cri\"]\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #96D0FF\"\u003e   [plugins.\"io.containerd.grpc.v1.cri\".containerd]\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #96D0FF\"\u003e      [plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes]\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #96D0FF\"\u003e        [plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes.runc]\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #96D0FF\"\u003e          runtime_type = \"io.containerd.runc.v2\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #96D0FF\"\u003e          [plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes.runc.options]\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #96D0FF\"\u003e            SystemdCgroup = true\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #ADBAC7\"\u003eEOF\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esystemctl\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003erestart\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003econtainerd.service\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eYou can verify its running with ctr:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"\u003e\u003ccode data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ectr\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e--address\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e/var/run/containerd/containerd.sock\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003econtainers\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003elist\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003eCONTAINER\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eIMAGE\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eRUNTIME\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eNow that this is working we can move on to getting kubernetes installed!\u003c/p\u003e\n\u003ch2\u003eUsing kubeadm!\u003c/h2\u003e\n\u003cp\u003eNow we need to get the kubernetes tools installed onto the system.  I’m going to be using 1.23\nbut to find the latest version you can run:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"\u003e\u003ccode data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eapt-cache\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003emadison\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ekubeadm\u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003ehead\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-n2\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #ADBAC7\"\u003e   \u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003ekubeadm\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003e1.23.5-00\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003ehttp://apt.kubernetes.io\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ekubernetes-xenial/main\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eamd64\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ePackages\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #ADBAC7\"\u003e   \u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003ekubeadm\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003e1.23.4-00\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003ehttp://apt.kubernetes.io\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ekubernetes-xenial/main\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eamd64\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ePackages\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThen install the version you want, we install kubelet and kubeadm here to make\nsure the versions align:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"\u003e\u003ccode data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eapt-get\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003einstall\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ekubeadm=\u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e1.23\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e.5-00\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ekubelet=\u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e1.23\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e.5-00\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ekubectl=\u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e1.23\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e.5-00\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-y\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis will pull in a few tools, including an alternative to \u003ccode\u003ectr\u003c/code\u003e that we used earlier called\n\u003ccode\u003ecrictl\u003c/code\u003e.  You can check that it is available to you doing this:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"\u003e\u003ccode data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ecrictl\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e--runtime-endpoint=unix:///var/run/containerd/containerd.sock\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eps\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWe can finally init our cluster:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"\u003e\u003ccode data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ekubeadm\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003einit\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eOnce that finishes running it should give you some tips setup your configuration, it should look like this:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"\u003e\u003ccode data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003emkdir\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-p\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e $HOME\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e/.kube\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ecp\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-i\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e/etc/kubernetes/admin.conf\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e $HOME\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e/.kube/config\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003echown\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e$(\u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003eid\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-u\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e):$(\u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003eid\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-g\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e)\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e $HOME\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e/.kube/config\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eYou can run those on the master node for now, but later I'll show you how to move\nthe config to your host computer.\u003c/p\u003e\n\u003cp\u003eNow you should be able to check that your node is not ready yet:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"\u003e\u003ccode data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ekubectl\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eget\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003enodes\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003eNAME\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e           \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eSTATUS\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e     \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eROLES\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e                  \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eAGE\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e     \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eVERSION\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003econtrolplane\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e   \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eNotReady\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e   \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003econtrol-plane,master\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e   \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e4\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003em16s\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e   \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ev1.23.5\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003cem\u003eNote\u003c/em\u003e: If you recieve \"The connecto to the server was refused\" error,\nThe cluster starting up and getting all the dependencies running could take\na bit of time.  So if you aren't able to communicate right away you can check\nwhich pods are up and running with \u003ccode\u003ecrictl\u003c/code\u003e.  You'll need \u003ccode\u003ekube-apiserver\u003c/code\u003e up\nand running.  If it isn't you can check:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"\u003e\u003ccode data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ecrictl\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e--runtime-endpoint=unix:///var/run/containerd/containerd.sock\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eps\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-a\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003eCONTAINER\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e           \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eIMAGE\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e               \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eCREATED\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e             \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eSTATE\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e               \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eNAME\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e                      \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eATTEMPT\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e             \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ePOD\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eID\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e              \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ePOD\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e8322192c4605c\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e       \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ebd8cc6d582470\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e       \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e36\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eseconds\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eago\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eRunning\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e             \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ekube-proxy\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e                \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e4\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e                   \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e344\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ec4f7fffbe8\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e       \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ekube-proxy-drm46\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e30ce27c40adb2\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e       \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e81\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ea4a8a4ac639\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e       \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e2\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eminutes\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eago\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e       \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eExited\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e              \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ekube-controller-manager\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e   \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e4\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e                   \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e3\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ea819c3a864b2\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e       \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ekube-controller-manager-controlplane\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e7709fd5e92898\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e       \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ebd8cc6d582470\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e       \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e2\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eminutes\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eago\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e       \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eExited\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e              \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ekube-proxy\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e                \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e3\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e                   \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e7\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ecc6922c82015\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e       \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ekube-proxy-drm46\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e10432b81d7c61\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e       \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e3767741\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ee7fba7\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e       \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e2\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eminutes\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eago\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e       \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eExited\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e              \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ekube-apiserver\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e            \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e4\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e                   \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ee64ddf3679d98\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e       \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ekube-apiserver-controlplane\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003ewhich will show you pods that have exited. You can grab the container ID for\nkube-apiserver and read its logs:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"\u003e\u003ccode data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ecrictl\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e--runtime-endpoint=unix:///var/run/containerd/containerd.sock\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003elogs\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e10432\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eb81d7c61\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThere are a few ways to figure out why the node isn’t ready yet.  Usually I would check the\n\u003ccode\u003ekubelet\u003c/code\u003e logs first:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"\u003e\u003ccode data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ejournalctl\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-flu\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ekubelet\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eLogs\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ebegin\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eat\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eSun\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e2022\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e-04-17\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e19\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e:22:19\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eAST.\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e--\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003eApr\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e17\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e20\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e:53:15\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003econtrolplane\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ekubelet[\u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e19727\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e]:\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eE0417\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e20\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e:53:15.951350\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e   \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e19727\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ekubelet.go:2347]\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e\"Container runtime network not ready\"\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003enetworkReady=\"NetworkReady=false reason:NetworkPluginNotReady message:Network plugin returns error: cni plugin not initialized\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003eApr\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e17\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e20\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e:53:20\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003econtrolplane\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ekubelet[\u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e19727\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e]:\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eE0417\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e20\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e:53:20.952148\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e   \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e19727\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ekubelet.go:2347]\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e\"Container runtime network not ready\"\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003enetworkReady=\"NetworkReady=false reason:NetworkPluginNotReady message:Network plugin returns error: cni plugin not initialized\"\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIt is clear the problem is that we are missing the CNI.  The other way you can find out what is\ngoing on is describing the node:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"\u003e\u003ccode data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ekubectl\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003edescribe\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003enode\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003econtrolplane\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis will have a lot of information but if you scroll through there looking at \u003ccode\u003eReason\u003c/code\u003e you\nmight see something useful.  In this case under \u003ccode\u003eLease\u003c/code\u003e you would see:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"\u003e\u003ccode data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ekubectl\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003edescribe\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003enode\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003econtrolplane\u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003egrep\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eNotReady\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003eReady\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e            \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eFalse\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e   \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eSun,\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e17\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eApr\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e2022\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e20\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e:53:37\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-0400\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e   \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eSun,\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e17\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eApr\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e2022\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e20\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e:43:07\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-0400\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e   \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eKubeletNotReady\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e              \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003econtainer\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eruntime\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003enetwork\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003enot\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eready:\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eNetworkReady=\u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003efalse\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ereason:NetworkPluginNotReady\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003emessage:Network\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eplugin\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ereturns\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eerror:\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ecni\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eplugin\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003enot\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003einitialize\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eLets get our CNI installed, we’ll be using cilium!\u003c/p\u003e\n\u003ch2\u003eSetting up your CNI!\u003c/h2\u003e\n\u003cp\u003eCilium has great documentation over \u003ca href=\"https://docs.cilium.io/en/v1.9/gettingstarted/k8s-install-kubeadm/\"\u003ehere\u003c/a\u003e,\nbut I’ll walk you through it anyways.  I do recommend checking out their documentation so you\nare familiar with it.   We will use \u003ccode\u003ehelm\u003c/code\u003e to pull down the version of cilium we want:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"\u003e\u003ccode data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ecurl\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-fsSL\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ehttps://baltocdn.com/helm/signing.asc\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003egpg\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e--dearmor\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-o\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e/etc/apt/trusted.gpg.d/helm.gpg\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eapt-get\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003einstall\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eapt-transport-https\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e--yes\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eecho\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e\"deb https://baltocdn.com/helm/stable/debian/ all main\"\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003etee\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e/etc/apt/sources.list.d/helm-stable-debian.list\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eapt-get\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eupdate\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eapt-get\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003einstall\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ehelm\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eNow we can install cilium!  It is \u003cem\u003every\u003c/em\u003e important that you pay attention to the\ncompatibility of cilium with the version of kubernetes you are intstalling. Check\nthe compatibility list \u003ca href=\"https://docs.cilium.io/en/v1.12/concepts/kubernetes/compatibility/\"\u003ehere\u003c/a\u003e.\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"\u003e\u003ccode data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ehelm\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003erepo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eadd\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ecilium\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ehttps://helm.cilium.io/\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ehelm\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003erepo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eupdate\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eOnce the repo is added you can list the versions available:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"\u003e\u003ccode data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ehelm\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esearch\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003erepo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-l\u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003ehead\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-n8\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003eNAME\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e           \t\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eCHART\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eVERSION\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e\t\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eAPP\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eVERSION\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e\t\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eDESCRIPTION\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003ecilium/cilium\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e  \t\u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e1.12\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e.1\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e       \t\u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e1.12\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e.1\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e     \t\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eeBPF-based\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eNetworking,\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eSecurity,\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eand\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eObservability\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003ecilium/cilium\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e  \t\u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e1.12\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e.0\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e       \t\u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e1.12\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e.0\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e     \t\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eeBPF-based\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eNetworking,\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eSecurity,\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eand\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eObservability\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003ecilium/cilium\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e  \t\u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e1.11\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e.8\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e       \t\u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e1.11\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e.8\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e     \t\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eeBPF-based\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eNetworking,\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eSecurity,\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eand\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eObservability\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003ecilium/cilium\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e  \t\u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e1.11\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e.7\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e       \t\u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e1.11\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e.7\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e     \t\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eeBPF-based\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eNetworking,\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eSecurity,\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eand\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eObservability\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003ecilium/cilium\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e  \t\u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e1.11\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e.6\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e       \t\u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e1.11\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e.6\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e     \t\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eeBPF-based\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eNetworking,\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eSecurity,\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eand\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eObservability\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003ecilium/cilium\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e  \t\u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e1.11\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e.5\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e       \t\u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e1.11\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e.5\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e     \t\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eeBPF-based\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eNetworking,\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eSecurity,\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eand\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eObservability\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003ecilium/cilium\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e  \t\u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e1.11\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e.4\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e       \t\u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e1.11\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e.4\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e     \t\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eeBPF-based\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eNetworking,\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eSecurity,\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eand\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eObservability\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eSo we want \u003ccode\u003e1.11.4\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"\u003e\u003ccode data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ehelm\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003einstall\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ecilium\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ecilium/cilium\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e--namespace\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ekube-system\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e--version\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e1.11\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e.4\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eNow our node should be ready!\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"\u003e\u003ccode data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ekubectl\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eget\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003enode\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003eNAME\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e           \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eSTATUS\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e   \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eROLES\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e                  \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eAGE\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e   \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eVERSION\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003econtrolplane\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e   \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eReady\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003econtrol-plane,master\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e   \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e24\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003em\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e   \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ev1.23.5\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eTime to join our worker to the cluster!\u003c/p\u003e\n\u003ch2\u003eJoining a worker to the cluster!\u003c/h2\u003e\n\u003cp\u003eWe have to go through the same steps as the controlplane to get the point that we have a\ncontainer runtime and \u003ccode\u003ekubeadm\u003c/code\u003e.   I’m not going to talk about the commands a second time but\nI’ll re-iterate them here for ease of following along.\u003c/p\u003e\n\u003cp\u003eFirst open up another shell and connect to the worker:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"\u003e\u003ccode data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003emultipass\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eshell\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eworker\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eNow run the following commands:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"\u003e\u003ccode data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eecho\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e\"deb  http://apt.kubernetes.io/  kubernetes-xenial  main\"\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003etee\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e/etc/apt/sources.list.d/kubernetes.list\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ecurl\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-fsSL\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ehttps://packages.cloud.google.com/apt/doc/apt-key.gpg\u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003egpg\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e--dearmor\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-o\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e/etc/apt/trusted.gpg.d/k8s.gpg\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ecurl\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-fsSL\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ehttps://download.docker.com/linux/ubuntu/gpg\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003egpg\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e--dearmor\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-o\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e/etc/apt/trusted.gpg.d/docker.gpg\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eecho\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e\"deb https://download.docker.com/linux/ubuntu $(\u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003elsb_release\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-cs\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e) stable\"\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003etee\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e/etc/apt/sources.list.d/docker.list\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ecat\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e\u0026#x3C;\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003eEOF\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e sudo tee /etc/modules-load.d/k8s.conf\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #96D0FF\"\u003eoverlay\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #96D0FF\"\u003ebr_netfilter\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #ADBAC7\"\u003eEOF\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esed\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-i\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-e\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e'/net.ipv4.conf.*.rp_filter/d'\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e$(\u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003egrep\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-ril\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e '\\.rp_filter' /etc/sysctl.d/ /usr/lib/sysctl.d/)\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esysctl\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-a\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003egrep\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e'\\.rp_filter'\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003eawk\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e'{print $1\" = 0\"}'\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003etee\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-a\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e/etc/sysctl.d/1000-cilium.conf\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ecat\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e\u0026#x3C;\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003eEOF\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e sudo tee /etc/sysctl.d/k8s.conf\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #96D0FF\"\u003enet.bridge.bridge-nf-call-ip6tables = 1\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #96D0FF\"\u003enet.bridge.bridge-nf-call-iptables  = 1\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #96D0FF\"\u003enet.ipv4.ip_forward                 = 1\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #ADBAC7\"\u003eEOF\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esystemctl\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003erestart\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esystemd-modules-load\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esysctl\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e--system\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eapt-get\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eupdate\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u0026#x26;\u0026#x26; \u003c/span\u003e\u003cspan style=\"color: #F69D50\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eapt-get\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eupgrade\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-y\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eapt-get\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003einstall\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003econtainerd.io=\u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e1.6\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e.8-1\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-y\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ecat\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e\u0026#x3C;\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003eEOF\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e sudo tee /etc/containerd/config.toml\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #96D0FF\"\u003eversion = 2\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #96D0FF\"\u003e[plugins]\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #96D0FF\"\u003e  [plugins.\"io.containerd.grpc.v1.cri\"]\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #96D0FF\"\u003e   [plugins.\"io.containerd.grpc.v1.cri\".containerd]\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #96D0FF\"\u003e      [plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes]\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #96D0FF\"\u003e        [plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes.runc]\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #96D0FF\"\u003e          runtime_type = \"io.containerd.runc.v2\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #96D0FF\"\u003e          [plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes.runc.options]\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #96D0FF\"\u003e            SystemdCgroup = true\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #ADBAC7\"\u003eEOF\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esystemctl\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003erestart\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003econtainerd.service\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eapt-get\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003einstall\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ekubeadm=\u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e1.23\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e.5-00\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ekubelet=\u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e1.23\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e.5-00\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ekubectl=\u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e1.23\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e.5-00\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e-y\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eFrom there we should be ready to join the cluster.   When we ran \u003ccode\u003ekubeadm init\u003c/code\u003e previously it\nprinted a join command out that we could use but I’m going to show you how to do it if you\nwere coming back later and no longer had that token.\u003c/p\u003e\n\u003cp\u003eBack on the \u003cem\u003econtroplane\u003c/em\u003e node run:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"\u003e\u003ccode data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ekubeadm\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003etoken\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ecreate\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e--print-join-command\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003ekubeadm\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ejoin\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e192.168\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e.64.7:6443\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e--token\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ewxs197.cco6mjj9ricvu8ov\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e--discovery-token-ca-cert-hash\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esha256:bd01c065240fa76f30a02ecb70a8cea6e329c9678994d4da1f6ccac7694b97fb\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eNow copy that command and run it with \u003ccode\u003esudo\u003c/code\u003e on the worker:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"\u003e\u003ccode data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esudo\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ekubeadm\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ejoin\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e192.168\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003e.64.7:6443\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e--token\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ewxs197.cco6mjj9ricvu8ov\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e--discovery-token-ca-cert-hash\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003esha256:bd01c065240fa76f30a02ecb70a8cea6e329c9678994d4da1f6ccac7694b97fb\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAfter this completes it’ll take a minute or two for everything to be synced up but if you go\nback to the master node you should have 2 ready nodes now:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"\u003e\u003ccode data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ekubectl\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eget\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003enodes\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003eNAME\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e           \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eSTATUS\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e   \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eROLES\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e                  \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eAGE\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e   \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eVERSION\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003econtrolplane\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e   \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eReady\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003econtrol-plane,master\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e   \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e46\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003em\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e   \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ev1.23.5\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003eworker\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e         \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eReady\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003enon\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003ee\u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e                 \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e79\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003es\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e   \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ev1.23.5\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2\u003eAccessing the cluster outside of the VMs!\u003c/h2\u003e\n\u003cp\u003eNow the final part is to get the \u003ccode\u003eadmin.conf\u003c/code\u003e as a kubeconfig on your machine so you can control\nit from outside of the cluster.   To do this we can use scp\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"\u003e\u003ccode data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003emultipass\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003etransfer\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003econtrolplane:/home/ubuntu/.kube/config\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003elocal.config\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eNormally kubernetes configuration is in ~/.kube/config but I like to maint a separate file for\neach cluster and then I set the \u003ccode\u003eKUBECONFIG\u003c/code\u003e env var to access it.\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre class=\"github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\" data-language=\"bash\" data-theme=\"default\"\u003e\u003ccode data-language=\"bash\" data-theme=\"default\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eexport\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eKUBECONFIG=local.config\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003e❯\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ekubectl\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eget\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003enodes\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003eNAME\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e           \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eSTATUS\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e   \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eROLES\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e                  \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eAGE\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e   \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eVERSION\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003econtrolplane\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e   \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eReady\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003econtrol-plane,master\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e   \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e56\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003em\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e   \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ev1.23.5\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color: #F69D50\"\u003eworker\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e         \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003eReady\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003enon\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003ee\u003c/span\u003e\u003cspan style=\"color: #F47067\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e                 \u003c/span\u003e\u003cspan style=\"color: #6CB6FF\"\u003e11\u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003em\u003c/span\u003e\u003cspan style=\"color: #ADBAC7\"\u003e   \u003c/span\u003e\u003cspan style=\"color: #96D0FF\"\u003ev1.23.5\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","category":"Kubernetes","date":"2022-04-16T20:00:00-04:00","tags":["Linux","Kubernetes","DevOps","SRE"],"title":"Running a kubernetes cluster locally with kubeadm"}},"__N_SSG":true},"page":"/blog/[...id]","query":{"id":["2022","local_kubeadm_cluster"]},"buildId":"92NZrJxfbghuXpSStEquK","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>