<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>sontek.net - Blog index!</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/6060a664e90c5fb4.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6060a664e90c5fb4.css" data-n-g=""/><link rel="preload" href="/_next/static/css/891a0f8b1d99c373.css" as="style"/><link rel="stylesheet" href="/_next/static/css/891a0f8b1d99c373.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-d7b038a63b619762.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-7d0be5702b1cad24.js" defer=""></script><script src="/_next/static/chunks/pages/_app-db340e45743e5304.js" defer=""></script><script src="/_next/static/chunks/395-021075f5bc54064e.js" defer=""></script><script src="/_next/static/chunks/pages/blog-526f701211ef0898.js" defer=""></script><script src="/_next/static/kSpxIp8h4g7-IyAuHX8Pd/_buildManifest.js" defer=""></script><script src="/_next/static/kSpxIp8h4g7-IyAuHX8Pd/_ssgManifest.js" defer=""></script><script src="/_next/static/kSpxIp8h4g7-IyAuHX8Pd/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div><div class="grid"><div class="col"><header id="banner" class="body"><h1><a href="/">sontek.net</a></h1></header></div><div class="col menu"><nav><ul><li><a href="/">Home</a></li><li><a href="/blog">Blog</a></li><li><a href="/resume">Resume</a></li><li><a href="/about">About</a></li></ul></nav></div></div><div class="container"><section class="util_headingMd__greUy util_padding1px__npvdE"><h2 class="util_headingLg__0ZfQv">All Articles</h2><ul class="util_list__JYQhB"><li><article class="blog_hentry__PXeF7"><header><h3 class="entry-title"><a href="/posts/2022/intro_to_just">Automate project workflows with the command runner Just!</a></h3></header><br/><small class="util_lightText__xcqUE"><time dateTime="2022-02-25T20:00:00-04:00">February 25, 2022</time></small><div><p>I believe every project should have a CLI built around the standard workflows of developing
on the project.  Things like:</p>
<ul>
<li>Install dependencies</li>
<li>Run tests</li>
<li>Run linter an...</div></article></li><li><article class="blog_hentry__PXeF7"><header><h3 class="entry-title"><a href="/posts/2022/intro_to_asdf">Use asdf to manage Python, NodeJS, GoLang and more!</a></h3></header><br/><small class="util_lightText__xcqUE"><time dateTime="2022-02-17T20:00:00-04:00">February 17, 2022</time></small><div><p><a href="https://asdf-vm.com/">asdf</a> is a general purpose version manager that
can manage versions of most programming language runtimes through a set
of plugins.</p>
<p>With micro-services bein...</div></article></li><li><article class="blog_hentry__PXeF7"><header><h3 class="entry-title"><a href="/posts/old/preparing_cloud_images_with_libvirt">Preparing custom images for OpenStack</a></h3></header><br/><small class="util_lightText__xcqUE"><time dateTime="2014-08-02T20:00:00-04:00">August 2, 2014</time></small><div><p>This article will show you how to use libvirt to create base images that
can be uploaded to OpenStack.</p>
<h1>Why would you want to do this?</h1>
<p>Linux distributions like Fedora and Ubuntu alre...</div></article></li><li><article class="blog_hentry__PXeF7"><header><h3 class="entry-title"><a href="/posts/old/writing_tests_for_pyramid_and_sqlalchemy">Writing tests for Pyramid and SQLAlchemy</a></h3></header><br/><small class="util_lightText__xcqUE"><time dateTime="2011-11-30T20:00:00-04:00">November 30, 2011</time></small><div><p>TL;DR: Putting it all together, the full code can be found here:
<a href="https://gist.github.com/1420255">https://gist.github.com/1420255</a></p>
<h1>Intro</h1>
<p>Pyramid's documentation doesn't ...</div></article></li><li><article class="blog_hentry__PXeF7"><header><h3 class="entry-title"><a href="/posts/old/turning_vim_into_a_modern_python_ide">Turning Vim into a modern Python IDE</a></h3></header><br/><small class="util_lightText__xcqUE"><time dateTime="2011-05-06T20:00:00-04:00">May 6, 2011</time></small><div><p>::: {.contents}
:::</p>
<p>TL;DR:</p>
<pre><code class="hljs language-shell"><span class="hljs-meta">$ </span><span class="bash">git <span class="hljs-built_in">clone</span> https://github.com/sont...</div></article></li><li><article class="blog_hentry__PXeF7"><header><h3 class="entry-title"><a href="/posts/old/tips_and_tricks_for_the_python_interpreter">Tips and Tricks for the Python Interpreter</a></h3></header><br/><small class="util_lightText__xcqUE"><time dateTime="2010-12-27T20:00:00-04:00">December 27, 2010</time></small><div><p>I have seen a lot of people switch over to using ipython, bpython, etc
to get auto-complete support without realizing that the standard
interpreter does have this functionality.</p>
<p>To enable au...</div></article></li><li><article class="blog_hentry__PXeF7"><header><h3 class="entry-title"><a href="/posts/old/caesar_cipher_in_python">Caesar Cipher in Python</a></h3></header><br/><small class="util_lightText__xcqUE"><time dateTime="2010-11-14T20:00:00-04:00">November 14, 2010</time></small><div><p>I'm currently teaching my wife to code and one of the problems that we
worked on to teach her some fundamental programming concepts was
re-implementing the caesar cipher in python. It was fun not o...</div></article></li><li><article class="blog_hentry__PXeF7"><header><h3 class="entry-title"><a href="/posts/old/convert_a_string_to_an_integer_in_python">Convert a string to an integer in Python</a></h3></header><br/><small class="util_lightText__xcqUE"><time dateTime="2010-10-27T20:00:00-04:00">October 27, 2010</time></small><div><p>A fun interview question some developers like to ask is to have you
convert ascii characters to an integer without using built in methods
like string.atoi or int().</p>
<p>So using python the obvio...</div></article></li></ul></section></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"allPostsData":[{"id":["2022","intro_to_just"],"path":"2022/intro_to_just","contentHtml":"\u003cp\u003eI believe every project should have a CLI built around the standard workflows of developing\non the project.  Things like:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eInstall dependencies\u003c/li\u003e\n\u003cli\u003eRun tests\u003c/li\u003e\n\u003cli\u003eRun linter and formatters\u003c/li\u003e\n\u003cli\u003eBuild project\u003c/li\u003e\n\u003cli\u003eStart / Stop the docker environment\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThe reason I think this is important is because it makes a nice consistent and discoverable\nentrypoint for understanding how you should work in the project.   If you only provide the\ninstructions in the \u003ccode\u003eREADME\u003c/code\u003e then you have to remember to update those docs every time you\nadd a new command.  Those docs aren't easily testable either.\u003c/p\u003e\n\u003cp\u003eMost of my career the command runner of choice for my projects as been \u003ccode\u003eGNU Make\u003c/code\u003e but it was\ndefinitely the wrong tool for the job.  It is a build tool that I bent into shape to work\nas a command runner for me.   These days I use the tool \u003ca href=\"https://github.com/casey/just\"\u003ejust\u003c/a\u003e.\u003c/p\u003e\n\u003ch2\u003eIntro to just\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/casey/just\"\u003eJust\u003c/a\u003e is a modern command runner with a similar syntax to \u003ccode\u003emake\u003c/code\u003e\nthat provides a nice way for building out your project CLI!  You create a file named \u003ccode\u003ejustfile\u003c/code\u003e\nat the root of your project and then the basic syntax is:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-make\"\u003e\u003cspan class=\"hljs-section\"\u003ehelp:\u003c/span\u003e\n  @just --list\n\n\u003cspan class=\"hljs-comment\"\u003e# My first command\u003c/span\u003e\n\u003cspan class=\"hljs-section\"\u003efirst:\u003c/span\u003e\n  echo \u003cspan class=\"hljs-string\"\u003e\"Any commands you want to run go here!\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe first \u003ccode\u003ehelp\u003c/code\u003e line defines a command \"help\" for your CLI and it lists out all the other available\ncommans.  I always put this line first because \u003ccode\u003ejust\u003c/code\u003e runs the first command in the file if a specific\ncommand isn't requested.  The output of this file looks like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e❯ just\nAvailable recipes:\n    first \u003cspan class=\"hljs-comment\"\u003e# My first command\u003c/span\u003e\n    \u003cspan class=\"hljs-built_in\"\u003ehelp\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eHaving help automatically generated is fantastic!  Its also really helpful that it adds the comment\nto the command so that each command is self-documenting.  If you run the \u003ccode\u003efirst\u003c/code\u003e command you'll notice\nit also has a feature where it prints out the commands being ran so the user knows exactly what is\nhappening:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e❯ just first\n\u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"Any commands you want to run go here!\"\u003c/span\u003e\nAny commands you want to run go here!\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis doesn't always make sense though, so you can quickly remove that behavior by putting an \u003ccode\u003e@\u003c/code\u003e in front\nof any of the commands, like I did for the \u003ccode\u003ehelp\u003c/code\u003e command above.  You can also declare dependencies if\nyou have re-usable parts of your workflow that many of your commands need.\u003c/p\u003e\n\u003cp\u003eFor example, you might want to check versions of things like \u003ccode\u003enode\u003c/code\u003e and \u003ccode\u003epython\u003c/code\u003e before running the install\nof their dependencies. So you could do something like:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-make\"\u003e\u003cspan class=\"hljs-section\"\u003ehelp:\u003c/span\u003e\n  @just --list\n\nnode_version := \u003cspan class=\"hljs-string\"\u003e\"v17.6.0\"\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e# Verify system dependencies\u003c/span\u003e\n\u003cspan class=\"hljs-section\"\u003echeck-dependencies:\u003c/span\u003e\n  @if [ ! \u003cspan class=\"hljs-string\"\u003e\"$(node --version)\"\u003c/span\u003e = {{ node_version }} ]; \\\n  then \\\n    echo \u003cspan class=\"hljs-string\"\u003e\"Missing node version: {{ node_version }}\"\u003c/span\u003e; \\\n    exit 1; \\\n  fi\n\n\u003cspan class=\"hljs-comment\"\u003e# Install frontend\u003c/span\u003e\n\u003cspan class=\"hljs-section\"\u003einstall: check-dependencies\u003c/span\u003e\n  @echo \u003cspan class=\"hljs-string\"\u003e\"yarn install\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ewhich ends up with a CLI that looks like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e❯ just\nAvailable recipes:\n    check-dependencies \u003cspan class=\"hljs-comment\"\u003e# Verify system dependencies\u003c/span\u003e\n    \u003cspan class=\"hljs-built_in\"\u003ehelp\u003c/span\u003e\n    install            \u003cspan class=\"hljs-comment\"\u003e# Install frontend\u003c/span\u003e\n\n❯ just install\nMissing node version: v17.6.0\nerror: Recipe `check-dependencies` failed on line 12 with \u003cspan class=\"hljs-built_in\"\u003eexit\u003c/span\u003e code 1\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis opens up a lot of possibilities! In the above \u003ccode\u003ejustfile\u003c/code\u003e you'll notice I'm using a multi-line\ncommand but I have \u003ccode\u003e\\\u003c/code\u003e at the end of each line.  This is because \u003ccode\u003ejust\u003c/code\u003e by default is going to run\neach new line in their own shell.   So this just makes all those lines run in the same shell.\u003c/p\u003e\n\u003cp\u003eYou do not have to use this syntax though.  Just is \u003ccode\u003epolyglot\u003c/code\u003e and can run commands from any language\nyou would like.\u003c/p\u003e\n\u003ch3\u003ePolyglot\u003c/h3\u003e\n\u003cp\u003eIf you want to use a bash script as one of your commands, you can do so by adding a shebang at the top:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-make\"\u003e\u003cspan class=\"hljs-section\"\u003echeck-dependencies:\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e#!/usr/bin/env bash\u003c/span\u003e\n  set -euxo pipefail\n  if [ ! \u003cspan class=\"hljs-string\"\u003e\"$(node --version)\"\u003c/span\u003e = {{ node_version }} ];\n  then\n    echo \u003cspan class=\"hljs-string\"\u003e\"Missing node version: {{ node_version }}\"\u003c/span\u003e\n    exit 1\n  fi\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNow the entire command is using a bash script to execute! This gets really interesting if you want to start\nusing things like python, so if you'd like to change the dependency checker above to python:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003echeck-dependencies:\n  \u003cspan class=\"hljs-comment\"\u003e#!/usr/bin/env python3\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e subprocess\n  result = subprocess.run(\n    [\u003cspan class=\"hljs-string\"\u003e'node'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'--version'\u003c/span\u003e],\n    stdout=subprocess.PIPE\n  )\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e result != \u003cspan class=\"hljs-string\"\u003e\"{{ node_version }}\"\u003c/span\u003e:\n    \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003ef\"Missing node version: {{ node_version }}\"\u003c/span\u003e)\n    exit(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eYou can even tell \u003ccode\u003ejust\u003c/code\u003e that you want to use a specific language for all commands!\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-arduino\"\u003eset shell := [\u003cspan class=\"hljs-string\"\u003e\"python3\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"-c\"\u003c/span\u003e]\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis not only affects the commands you have in your recipe but also anything inside\nbackticks!  So something like:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-make\"\u003e`print(\u003cspan class=\"hljs-string\"\u003e\"Rust is the best programming language\"\u003c/span\u003e)`\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIt would run through python instead of the shell.\u003c/p\u003e\n\u003ch3\u003eEnviornment Files\u003c/h3\u003e\n\u003cp\u003eOne of the other modern things \u003ccode\u003ejust\u003c/code\u003e adds to your workflow is the ability to utilize dotenv\nfiles.  So for example if you want to define which port you launch your http server on, you can\ncreate a file called \u003ccode\u003e.env\u003c/code\u003e:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eWEBSERVER_PORT=9000\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eand then utilize it in your \u003ccode\u003ejustfile\u003c/code\u003e:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-make\"\u003eset dotenv-load\n\n\u003cspan class=\"hljs-section\"\u003ehttp:\u003c/span\u003e\n  @echo \u003cspan class=\"hljs-string\"\u003e\"Starting webserver in current directory\"\u003c/span\u003e\n  python3 -m http.server $WEBSERVER_PORT\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWhen you run \u003ccode\u003ejust http\u003c/code\u003e it'll launch the http server on port 9000.  One important line\nin this file is \u003ccode\u003eset dotenv-load\u003c/code\u003e, it will not load the \u003ccode\u003e.env\u003c/code\u003e file without you telling it to.\u003c/p\u003e\n\u003ch2\u003eDon't use language specific scripts!\u003c/h2\u003e\n\u003cp\u003eI'n not a fan of language specific command runners like \u003ccode\u003epackage.json\u003c/code\u003e in the node community.\u003c/p\u003e\n\u003cp\u003eIt always frustrates me when I start working on a project that heavily uses \u003ccode\u003escripts\u003c/code\u003e in their\npackage.json instead of using a real command runner. \u003ccode\u003ejson\u003c/code\u003e is not a great format for writing\ndiscoverable CLI commands. For example if you wanted to write a \u003ccode\u003enext.js\u003c/code\u003e build script:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-json\"\u003e    \u003cspan class=\"hljs-attr\"\u003e\"scripts\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003e\"predeploy\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"yarn build \u0026#x26;\u0026#x26; yarn export \u0026#x26;\u0026#x26; touch dist/.nojekyll \u0026#x26;\u0026#x26; echo sontek.net \u003e dist/CNAME\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003e\"deploy\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"gh-pages -d dist -t true\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003e\"build\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"next build\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003e\"export\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"next export -o dist/\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eCombining all those commands is really messy and not easily understandable through \u003ccode\u003eyarn run\u003c/code\u003e:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e❯ yarn run\nyarn run v1.22.17\ninfo Commands available from binary scripts: autoprefixer, browserslist, css-blank-pseudo, css-has-pseudo, css-prefers-color-scheme, cssesc, esparse, esvalidate, extract-zip, gh-pages, gh-pages-clean, js-yaml, loose-envify, nanoid, next, prettier, resolve, rimraf, semver, svgo, uvu\ninfo Project commands\n   - build\n      next build\n   - deploy\n      gh-pages -d dist -t \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n   - \u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e\n      next \u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e -o dist/\n   - predeploy\n      yarn build \u0026#x26;\u0026#x26; yarn \u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e \u0026#x26;\u0026#x26; \u003cspan class=\"hljs-built_in\"\u003etouch\u003c/span\u003e dist/.nojekyll \u0026#x26;\u0026#x26; \u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e sontek.net \u003e dist/CNAME\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eI'd much rather have this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e❯ just\nAvailable recipes:\n    build       \u003cspan class=\"hljs-comment\"\u003e# Build frontend assets\u003c/span\u003e\n    deploy      \u003cspan class=\"hljs-comment\"\u003e# Deploy assets to cloudfront\u003c/span\u003e\n    \u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e      \u003cspan class=\"hljs-comment\"\u003e# Export to static assets (no SSR)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eConclusion\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/casey/just\"\u003eJust\u003c/a\u003e is a wonderful tool for building project specific CLIs without much effort. It is\na great replacement for \u003ccode\u003eMake\u003c/code\u003e if you are using it as a command runner and it has most of the features you'd need.\u003c/p\u003e\n\u003cp\u003eI recommend adding a \u003ccode\u003ejustfile\u003c/code\u003e to your projects today!   I use one to even maintain my \u003ca href=\"https://github.com/sontek/homies/blob/master/justfile\"\u003ehome directory\u003c/a\u003e!\u003c/p\u003e","category":"development\n","date":"2022-02-25T20:00:00-04:00","tags":"linux\n","title":"Automate project workflows with the command runner Just!"},{"id":["2022","intro_to_asdf"],"path":"2022/intro_to_asdf","contentHtml":"\u003cp\u003e\u003ca href=\"https://asdf-vm.com/\"\u003easdf\u003c/a\u003e is a general purpose version manager that\ncan manage versions of most programming language runtimes through a set\nof plugins.\u003c/p\u003e\n\u003cp\u003eWith micro-services being all the rage and the ever changing landscape\nof the development world, it is rare to utilize a single version of\nlanguage runtime. Even when you want to upgrade from one to the other\nyou'll need both usable on your system at the same time.\u003c/p\u003e\n\u003cp\u003eI've used tools like \u003ccode\u003epyenv\u003c/code\u003e and \u003ccode\u003envm\u003c/code\u003e in the past when I needed to change\nversions depending on which project I'm contributing to. But with \u003ccode\u003easdf\u003c/code\u003e\nyou have one tool to rule them all!\u003c/p\u003e\n\u003ch2\u003eGetting Started\u003c/h2\u003e\n\u003cp\u003eThe first thing you need to do when working with \u003ccode\u003easdf\u003c/code\u003e is grab the\nplugins for the languages you are interested in working with. You can list\nwhat plugins are available:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003e asdf plugin list all\ngolang                       *https://github.com/kennyp/asdf-golang.git\ngolangci-lint                 https://github.com/hypnoglow/asdf-golangci-lint.git\nnodejs                       *https://github.com/asdf-vm/asdf-nodejs.git\npoetry                       *https://github.com/asdf-community/asdf-poetry.git\npython                       *https://github.com/danhper/asdf-python.git\nyarn                         *https://github.com/twuni/asdf-yarn.git\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eOn the left will be the name of the plugin and on the right will be the repository\nwhere it lives.  It'll me marked with an asterisk if you already have it installed.\u003c/p\u003e\n\u003cp\u003eTo install a plugin you say \u003ccode\u003easdf plugin add \u0026#x3C;plugin\u003e\u003c/code\u003e to get it installed.  You can\nalso provide the repository where you want it pulled from, for example:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003e asdf plugin add nodejs https://github.com/asdf-vm/asdf-nodejs.git\n\u003e asdf plugin add python https://github.com/danhper/asdf-python.git\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis will not give you any version of those languages, it is only installing the\nplugin that knows how to work with those languages.   You are ready to pull down\nany versions you want at that point:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003e asdf install nodejs 14.19.0\n\u003e asdf install python 3.9.10\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eOnce you have the versions installed you will be able to view them like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003e asdf list\ngolang\n  1.17.7\nnodejs\n  --\u003cspan class=\"hljs-built_in\"\u003ehelp\u003c/span\u003e\n  12.22.10\n  14.19.0\n  16.14.0\n  17.5.0\npoetry\n  1.1.13\npython\n  3.9.10\nyarn\n  1.22.17\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eUsing the installed languages\u003c/h2\u003e\n\u003cp\u003eTo activate a specific version of a language you have you have three options:\u003c/p\u003e\n\u003ch3\u003eMake it global\u003c/h3\u003e\n\u003cp\u003eYou can make it global, meaning when you run the tool like \u003ccode\u003epython\u003c/code\u003e it'll use\nthis version for the system:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003e asdf global python 3.9.10\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eMake it local\u003c/h3\u003e\n\u003cp\u003eYou can make it local, which means it will generate a file in the current\ndirectory named \u003ccode\u003e.tool-versions\u003c/code\u003e and so whenever you change into a directory\nit will activate the versions defined in there.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003e asdf \u003cspan class=\"hljs-built_in\"\u003elocal\u003c/span\u003e nodejs 12.22.10\n\u003e \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e .tool-versions \nnodejs 12.22.10\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe great thing about this is you can commit that file to git and then anyone\nwho checks out the project and uses \u003ccode\u003easdf\u003c/code\u003e will have the same versions activated!\u003c/p\u003e\n\u003ch3\u003eTemporary\u003c/h3\u003e\n\u003cp\u003eIf you want to activate a version of a language temporarily you can swap to it\nfor the current shell:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003e asdf shell golang 1.17.7\n\u003e \u003cspan class=\"hljs-built_in\"\u003eenv\u003c/span\u003e|grep -i ASDF\nASDF_GOLANG_VERSION=1.17.7\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIt sets an environment variable that will have preference over the file. If you\never wonder what versions a directory is using you can run:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003e asdf current\ngolang          ______          No version \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e. Run \u003cspan class=\"hljs-string\"\u003e\"asdf \u0026#x3C;global|shell|local\u003e golang \u0026#x3C;version\u003e\"\u003c/span\u003e\nnodejs          12.22.10        .tool-versions\npoetry          ______          No version \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e. Run \u003cspan class=\"hljs-string\"\u003e\"asdf \u0026#x3C;global|shell|local\u003e poetry \u0026#x3C;version\u003e\"\u003c/span\u003e\npython          3.9.10          .tool-versions\nyarn            1.22.17         .tool-versions\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eConclusion\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://asdf-vm.com/\"\u003easdf\u003c/a\u003e  is an AWESOME tool to utilize if you find yourself using many\ndifferent languages or many different versions of the same language. You should check it out\nand see if it can improve your workflow.\u003c/p\u003e","category":"programming\n","date":"2022-02-17T20:00:00-04:00","tags":"python,nodejs,golang,linux\n","title":"Use asdf to manage Python, NodeJS, GoLang and more!"},{"id":["old","preparing_cloud_images_with_libvirt"],"path":"old/preparing_cloud_images_with_libvirt","contentHtml":"\u003cp\u003eThis article will show you how to use libvirt to create base images that\ncan be uploaded to OpenStack.\u003c/p\u003e\n\u003ch1\u003eWhy would you want to do this?\u003c/h1\u003e\n\u003cp\u003eLinux distributions like Fedora and Ubuntu already ship \"cloud\" images\nand most providers also have their own custom images for you to use, but\nI find it much more comforting to have full control of the software that\nis installed and I like the ability to easily apply new security patches\nto base images.\u003c/p\u003e\n\u003cp\u003eI wouldn't use images to replace config management (CM) with something\nlike \u003ca href=\"http://www.saltstack.com/\"\u003eSalt\u003c/a\u003e or\n\u003ca href=\"http://www.ansible.com/\"\u003eAnsible\u003c/a\u003e but they are nice to give sane system\ndefaults in things like \u003ccode\u003egrub.conf\u003c/code\u003e, \u003ccode\u003esysctl.conf\u003c/code\u003e, and shipping a Chef\nor Salt agent so that your CM engine can communicate with your server\nright away.\u003c/p\u003e\n\u003ch1\u003eSetting up your environment\u003c/h1\u003e\n\u003cp\u003eThe first thing you need to do is get a minimal install disk for the\nLinux distribution you want to use. I prefer using Fedora netinst disks\nbut another popular option is Ubuntu Server.\u003c/p\u003e\n\u003cp\u003eTo get the latest Fedora here, you can choose \"netinst\" under Direct\nDownloads: \u003ca href=\"http://fedoraproject.org/en/get-fedora-all\"\u003ehttp://fedoraproject.org/en/get-fedora-all\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eTo get the latest Ubuntu you can go here:\n\u003ca href=\"http://www.ubuntu.com/download/server\"\u003ehttp://www.ubuntu.com/download/server\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eOnce you have acquired your distribution of choice you just need to\nverify that you have \u003ccode\u003evirt-install\u003c/code\u003e and \u003ccode\u003evirt-viewer\u003c/code\u003e installed:\u003c/p\u003e\n\u003cp\u003eFedora:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eyum install virt-install virt-viewer\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eUbuntu:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eapt-get install virtinst virt-viewer\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIf you prefer a graphical user interface, you may use \u003ccode\u003evirt-manager\u003c/code\u003e\ninstead, but I try to keep everything in the CLI; that way it can be\nrepeated easily.\u003c/p\u003e\n\u003ch1\u003ePreparing your disk\u003c/h1\u003e\n\u003cp\u003eNow that you have a base ISO and the tools necessary, let's get started\nby creating a disk to install the virtual server into. Resizing an image\nisn't an impossible task but it is much easier to choose a reasonably\nsized disk for the purpose it will be used for.\u003c/p\u003e\n\u003cp\u003eI primarily use 8 GB disks -- that way we can fit all the system\ncomponents required as well as our own web applications. Any large files\nshould be placed in a SAN or something like Dreamhost's dreamobjects.\u003c/p\u003e\n\u003cp\u003eThe other big decision you must make upfront is what disk format you\nwant to use -- the trade-off is disk space vs performance. The two\nprimary formats are qcow2 (QEMU Copy on Write) and Raw. qcow2 is great\nif you have limited disk space and don't want to allocate the full 8 GB\nup front. Raw is preferred if you want the best performance.\u003c/p\u003e\n\u003cp\u003eIf you choose qcow2, you'll also need to make sure you have \u003ccode\u003eqemu-img\u003c/code\u003e:\u003c/p\u003e\n\u003cp\u003eFedora:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eyum install qemu-img\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eUbuntu:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eapt-get install qemu-utils\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eCreate a raw disk:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003efallocate -l 8192M server.img\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eCreate a qcow2 disk:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eqemu-img create -f qcow2 server.qcow2 8G\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1\u003eInstalling your distribution onto the disk\u003c/h1\u003e\n\u003cp\u003eWe will use the \u003ccode\u003evirt-install\u003c/code\u003e command to get the distribution installed\nonto the disk image.\u003c/p\u003e\n\u003cp\u003eTo install Fedora on a qcow2 disk image:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003evirt-install --name base_server --ram 1024 --cdrom=./Fedora-20-x86_64-netinst.iso \\\n--disk path=./server.qcow2,format=qcow2\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eTo install Ubuntu Server on a raw disk image:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003evirt-install --name base_server --ram 1024 --cdrom=./ubuntu-12.04.4-server-amd64.iso \\\n--disk path=./server.img,format=raw\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eYou should follow the standard install steps that you normally would\nwhen setting up your distribution. But here are some tips for each:\u003c/p\u003e\n\u003cp\u003eFedora:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eChoose minimal install -- by default it selects \"GNOME\".\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eUbuntu:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eBe sure to select OpenSSH server -- it won't install it by\ndefault.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eOn Ubuntu 12.04, there is a bug that makes it hang after running\n\u003ccode\u003efsck\u003c/code\u003e. You will need to edit grub to get it to boot, hit _\u003ca href=\"\"\u003ee\u003c/a\u003e at\nthe boot prompt and add \"nomodeset\" on the linux line. You will\nknow that you need to do this if your boot hangs on fsck:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003efsck from util-linux 2.20.1\n/dev/mapper/ubuntu--vg-root: clean, 57106/441504 files, 286779/1764352 blocks\n/dev/sda1: clean, 230/62248 files, 39833/248832 blocks\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1\u003ePreparing image for openstack\u003c/h1\u003e\n\u003cp\u003eTo prepare a virtual machine for the cloud, you will need to install the\n\u003ccode\u003ecloud-init\u003c/code\u003e package, which allows the cloud providers to inject certain\nsystem settings when creating servers based on the image. These are\nthings like hostname and ssh keys.\u003c/p\u003e\n\u003cp\u003eOn Fedora:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eyum install cloud-init\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eOn Ubuntu:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eapt-get install cloud-init\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThen you need to just configure \u003ccode\u003ecloud-init\u003c/code\u003e by editing\n\u003ccode\u003e/etc/cloud/cloud.cfg\u003c/code\u003e and update the \u003ccode\u003edatasources_list\u003c/code\u003e section to\ninclude EC2. OpenStack uses EC2 metadata for \u003ccode\u003ecloud-init\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eYou should also verify the user setting in this same config and define\nthe user you plan to use, it will be where the \u003ccode\u003eauthorized_keys\u003c/code\u003e file is\nsetup for when the cloud provider injects your SSH key into the server.\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ecloud-init\u003c/code\u003e will not create the user for you, it will just assign the\nSSH keypair and reset the password. So make sure the user defined in\n\u003ccode\u003ecloud.cfg\u003c/code\u003e is also created on the system.\u003c/p\u003e\n\u003cp\u003eOnce you have your \u003ccode\u003ecloud-init\u003c/code\u003e settings the way you want them, just\nshutdown and run the \u003ccode\u003evirt-sysprep\u003c/code\u003e command.\u003c/p\u003e\n\u003cp\u003eOn the guest machine:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eshutdown -h now\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eOn the host machine:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003evirt-sysprep -d base_server\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1\u003eUploading your image to OpenStack\u003c/h1\u003e\n\u003cp\u003eUsing the glance API it is very straightforward to upload the image to\nOpenStack. Just run the following command:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eglance image-create --name base_server --disk-format=qcow2 \\\n--container-format=bare --is-public=True --file server.qcow2 --progress\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eOnce the image upload completes you will be able to use it immediately\nwithin nova. You can reference it by name or by the id from [glance\nimage-list]{.title-ref}.\u003c/p\u003e\n\u003cp\u003eTo create your first instance from the image:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003enova boot --flavor m1.tiny --image base_server --key-name devops \\\n--security-groups free_for_all test_server\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eObviously the security groups, key name, and flavors are based on your\ninstallation of OpenStack but can all easily be queried from the nova\nAPI:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003enova flavor-list\nnova secgroup-list\nnova keypair-list\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAnd you are done! You'll be able to re-use your new image as a base for\nall new instances you spin up in openstack!\u003c/p\u003e","category":"devops\n","date":"2014-08-02T20:00:00-04:00","tags":"linux, openstack, libvirt\n","title":"Preparing custom images for OpenStack"},{"id":["old","writing_tests_for_pyramid_and_sqlalchemy"],"path":"old/writing_tests_for_pyramid_and_sqlalchemy","contentHtml":"\u003cp\u003eTL;DR: Putting it all together, the full code can be found here:\n\u003ca href=\"https://gist.github.com/1420255\"\u003ehttps://gist.github.com/1420255\u003c/a\u003e\u003c/p\u003e\n\u003ch1\u003eIntro\u003c/h1\u003e\n\u003cp\u003ePyramid's documentation doesn't cover the preferred way to test with\nSQLAlchemy, because Pyramid tries to stay out of your way and allow you\nto make your own decisions. However, I feel i'ts necessary to document\nwhat I think is the best way to test.\u003c/p\u003e\n\u003cp\u003eWhen I first started writing tests with SQLAlchemy I found plenty of\nexamples of how to to get started by doing something like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e db \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e session \u003cspan class=\"hljs-comment\"\u003e# probably a contextbound sessionmaker\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e db \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e model\n\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e sqlalchemy \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e create_engine\n\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title hljs-function\"\u003esetup\u003c/span\u003e():\n    engine = create_engine(\u003cspan class=\"hljs-string\"\u003e'sqlite:///test.db'\u003c/span\u003e)\n    session.configure(bind=engine)\n    model.metadata.create_all(engine)\n\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title hljs-function\"\u003eteardown\u003c/span\u003e():\n    model.metadata.drop_all(engine)\n\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title hljs-function\"\u003etest_something\u003c/span\u003e():\n    \u003cspan class=\"hljs-keyword\"\u003epass\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eI have seen this done so many times, but I feel there is so much wrong\nwith it! So let's establish some base rules when testing:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cul\u003e\n\u003cli\u003eAlways test your system like it would be used in production.\nSQLite does not enforce the same rules or have the same features\nas Postgres or MySQL and will allow tests to pass that would\notherwise fail in production.\u003c/li\u003e\n\u003cli\u003eTests should be fast! You should be writing tests for all your\ncode. This is the main reason people do test against SQLite, but\nwe can't violate rule number one. We have to make sure tests\nagainst Postgres are fast, so we shouldn't be tearing down and\nrecreating tables for every single test.\u003c/li\u003e\n\u003cli\u003eYou should be able to execute in parallel to speed up when you\nhave thousands of tests. Dropping and creating tables per test\nwould not work in a parallel environment.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eFor an example, I have a project with 600+ tests and it would take 2 and\nhalf minutes to execute running against SQLite. But when we swapped our\ntest configuration to execute against Postgres, testing took well over\nan hour. That is unacceptable!\u003c/p\u003e\n\u003cp\u003eBut running them in parallel will give us a huge speed up. Check out the\nresults of the tests running in single proc mode vs using all 4 cores:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ini\"\u003e$ \u003cspan class=\"hljs-attr\"\u003epy.test\u003c/span\u003e\n======= 616 passed in 143.67 \u003cspan class=\"hljs-attr\"\u003eseconds\u003c/span\u003e =======\n\n$ py.test \u003cspan class=\"hljs-attr\"\u003e-n4\u003c/span\u003e\n======= 616 passed in 68.12 \u003cspan class=\"hljs-attr\"\u003eseconds\u003c/span\u003e =======\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1\u003eThe right way\u003c/h1\u003e\n\u003cp\u003eSo what is the proper way to setup your tests? You should initialize the\ndatabase when you start your test runner and then use transactions to\nrollback any data changes your tests made. This allows you to keep a\nclean database for each test in a very efficient way.\u003c/p\u003e\n\u003cp\u003eIn py.test, you just have to create a file called conftest.py that looks\nsimilar to:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e os\n\nROOT_PATH = os.path.dirname(__file__)\n\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title hljs-function\"\u003epytest_sessionstart\u003c/span\u003e():\n    \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e py.test \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e config\n\n    \u003cspan class=\"hljs-comment\"\u003e# Only run database setup on master (in case of xdist/multiproc mode)\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enot\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ehasattr\u003c/span\u003e(config, \u003cspan class=\"hljs-string\"\u003e'slaveinput'\u003c/span\u003e):\n        \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e models \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e initialize_sql\n        \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pyramid.config \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e Configurator\n        \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e paste.deploy.loadwsgi \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e appconfig\n        \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e sqlalchemy \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e engine_from_config\n        \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e os\n\n        ROOT_PATH = os.path.dirname(__file__)\n        settings = appconfig(\u003cspan class=\"hljs-string\"\u003e'config:'\u003c/span\u003e + os.path.join(ROOT_PATH, \u003cspan class=\"hljs-string\"\u003e'test.ini'\u003c/span\u003e))\n        engine = engine_from_config(settings, prefix=\u003cspan class=\"hljs-string\"\u003e'sqlalchemy.'\u003c/span\u003e)\n\n        \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'Creating the tables on the test database %s'\u003c/span\u003e % engine\n\n        config = Configurator(settings=settings)\n        initialize_sql(settings, config)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWith py.test, when you are running in parallel mode, the\npytest_sessionstart hook gets fired for each node, so we check that we\nare on the master node. Then we just grab our test.ini configuration\nfile and execute the initialize_sql function.\u003c/p\u003e\n\u003cp\u003eNow that you have your initial test configuration finished, you have to\ndefine a base test class that does the transaction management in setUp\nand teardown.\u003c/p\u003e\n\u003cp\u003eFirst, lets setup the Base testing class what will manage our\ntransactions:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e unittest\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pyramid \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e testing\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e paste.deploy.loadwsgi \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e appconfig\n\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e webtest \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e TestApp\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e mock \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e Mock\n\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e sqlalchemy \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e engine_from_config\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e sqlalchemy.orm \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e sessionmaker\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e app.db \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e Session\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e app.db \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e Entity  \u003cspan class=\"hljs-comment\"\u003e# base declarative object\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e app \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e main\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e os\nhere = os.path.dirname(__file__)\nsettings = appconfig(\u003cspan class=\"hljs-string\"\u003e'config:'\u003c/span\u003e + os.path.join(here, \u003cspan class=\"hljs-string\"\u003e'../../'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'test.ini'\u003c/span\u003e))\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title hljs-class\"\u003eBaseTestCase\u003c/span\u003e(unittest.TestCase):\n\u003cspan class=\"hljs-meta\"\u003e    @classmethod\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title hljs-function\"\u003esetUpClass\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ecls\u003c/span\u003e):\n        cls.engine = engine_from_config(settings, prefix=\u003cspan class=\"hljs-string\"\u003e'sqlalchemy.'\u003c/span\u003e)\n        cls.Session = sessionmaker()\n\n    \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title hljs-function\"\u003esetUp\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself\u003c/span\u003e):\n        connection = self.engine.connect()\n\n        \u003cspan class=\"hljs-comment\"\u003e# begin a non-ORM transaction\u003c/span\u003e\n        self.trans = connection.begin()\n\n        \u003cspan class=\"hljs-comment\"\u003e# bind an individual Session to the connection\u003c/span\u003e\n        Session.configure(bind=connection)\n        self.session = self.Session(bind=connection)\n        Entity.session = self.session\n\n    \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title hljs-function\"\u003etearDown\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself\u003c/span\u003e):\n        \u003cspan class=\"hljs-comment\"\u003e# rollback - everything that happened with the\u003c/span\u003e\n        \u003cspan class=\"hljs-comment\"\u003e# Session above (including calls to commit())\u003c/span\u003e\n        \u003cspan class=\"hljs-comment\"\u003e# is rolled back.\u003c/span\u003e\n        testing.tearDown()\n        self.trans.rollback()\n        self.session.close()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis base test case will wrap all your sessions in an external\ntransaction so that you still have the ability to call flush/commit/etc\nand it will still be able to rollback any data changes you make.\u003c/p\u003e\n\u003ch1\u003eUnit Tests\u003c/h1\u003e\n\u003cp\u003eNow there are a few different types of tests you will want to run.\nFirst, you will want to do unit tests, which are small tests that only\ntest 1 thing at a time. This means you will skip the routes, templates,\netc. So let's setup our Unit Test Base class:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title hljs-class\"\u003eUnitTestBase\u003c/span\u003e(\u003cspan class=\"hljs-title hljs-class hljs-inherited\"\u003eBaseTestCase\u003c/span\u003e):\n    \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title hljs-function\"\u003esetUp\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself\u003c/span\u003e):\n        self.config = testing.setUp(request=testing.DummyRequest())\n        \u003cspan class=\"hljs-built_in\"\u003esuper\u003c/span\u003e(UnitTestBase, self).setUp()\n\n    \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title hljs-function\"\u003eget_csrf_request\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself, post=\u003cspan class=\"hljs-literal\"\u003eNone\u003c/span\u003e\u003c/span\u003e):\n        csrf = \u003cspan class=\"hljs-string\"\u003e'abc'\u003c/span\u003e\n\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enot\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eu'csrf_token'\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e post.keys():\n            post.update({\n                \u003cspan class=\"hljs-string\"\u003e'csrf_token'\u003c/span\u003e: csrf\n            })\n\n        request = testing.DummyRequest(post)\n\n        request.session = Mock()\n        csrf_token = Mock()\n        csrf_token.return_value = csrf\n\n        request.session.get_csrf_token = csrf_token\n\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e request\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe built in a utility function to help us test requests that require a\ncsrf token as well. Here is how we would use this class:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title hljs-class\"\u003eTestViews\u003c/span\u003e(\u003cspan class=\"hljs-title hljs-class hljs-inherited\"\u003eUnitTestBase\u003c/span\u003e):\n    \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title hljs-function\"\u003etest_login_fails_empty\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself\u003c/span\u003e):\n        \u003cspan class=\"hljs-string\"\u003e\"\"\" Make sure we can't login with empty credentials\"\"\"\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e app.accounts.views \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e LoginView\n        self.config.add_route(\u003cspan class=\"hljs-string\"\u003e'index'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'/'\u003c/span\u003e)\n        self.config.add_route(\u003cspan class=\"hljs-string\"\u003e'dashboard'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'/'\u003c/span\u003e)\n\n        request = testing.DummyRequest(post={\n            \u003cspan class=\"hljs-string\"\u003e'submit'\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003eTrue\u003c/span\u003e,\n        })\n\n        view = LoginView(request)\n        response = view.post()\n        errors = response[\u003cspan class=\"hljs-string\"\u003e'errors'\u003c/span\u003e]\n\n        \u003cspan class=\"hljs-keyword\"\u003eassert\u003c/span\u003e errors[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e].node.name == \u003cspan class=\"hljs-string\"\u003eu'csrf_token'\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003eassert\u003c/span\u003e errors[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e].msg == \u003cspan class=\"hljs-string\"\u003eu'Required'\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003eassert\u003c/span\u003e errors[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e].node.name == \u003cspan class=\"hljs-string\"\u003eu'Username'\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003eassert\u003c/span\u003e errors[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e].msg == \u003cspan class=\"hljs-string\"\u003eu'Required'\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003eassert\u003c/span\u003e errors[\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e].node.name == \u003cspan class=\"hljs-string\"\u003eu'Password'\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003eassert\u003c/span\u003e errors[\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e].msg == \u003cspan class=\"hljs-string\"\u003eu'Required'\u003c/span\u003e\n\n\n    \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title hljs-function\"\u003etest_login_succeeds\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself\u003c/span\u003e):\n        \u003cspan class=\"hljs-string\"\u003e\"\"\" Make sure we can login \"\"\"\u003c/span\u003e\n        admin = User(username=\u003cspan class=\"hljs-string\"\u003e'sontek'\u003c/span\u003e, password=\u003cspan class=\"hljs-string\"\u003e'temp'\u003c/span\u003e, kind=\u003cspan class=\"hljs-string\"\u003eu'admin'\u003c/span\u003e)\n        admin.activated = \u003cspan class=\"hljs-literal\"\u003eTrue\u003c/span\u003e\n        self.session.add(admin)\n        self.session.flush()\n\n        \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e app.accounts.views \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e LoginView\n        self.config.add_route(\u003cspan class=\"hljs-string\"\u003e'index'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'/'\u003c/span\u003e)\n        self.config.add_route(\u003cspan class=\"hljs-string\"\u003e'dashboard'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'/dashboard'\u003c/span\u003e)\n\n        request = self.get_csrf_request(post={\n                \u003cspan class=\"hljs-string\"\u003e'submit'\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003eTrue\u003c/span\u003e,\n                \u003cspan class=\"hljs-string\"\u003e'Username'\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'sontek'\u003c/span\u003e,\n                \u003cspan class=\"hljs-string\"\u003e'Password'\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'temp'\u003c/span\u003e,\n            })\n\n        view = LoginView(request)\n        response = view.post()\n\n        \u003cspan class=\"hljs-keyword\"\u003eassert\u003c/span\u003e response.status_int == \u003cspan class=\"hljs-number\"\u003e302\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1\u003eIntegration Tests\u003c/h1\u003e\n\u003cp\u003eThe second type of test you will want to write is an integration test.\nThis will integrate with the whole web framework and actually hit the\ndefine routes, render the templates, and actually test the full stack of\nyour application.\u003c/p\u003e\n\u003cp\u003eLuckily this is pretty easy to do with Pyramid using WebTest:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title hljs-class\"\u003eIntegrationTestBase\u003c/span\u003e(\u003cspan class=\"hljs-title hljs-class hljs-inherited\"\u003eBaseTestCase\u003c/span\u003e):\n\u003cspan class=\"hljs-meta\"\u003e    @classmethod\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title hljs-function\"\u003esetUpClass\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ecls\u003c/span\u003e):\n        cls.app = main({}, **settings)\n        \u003cspan class=\"hljs-built_in\"\u003esuper\u003c/span\u003e(IntegrationTestBase, cls).setUpClass()\n\n    \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title hljs-function\"\u003esetUp\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself\u003c/span\u003e):\n        self.app = TestApp(self.app)\n        self.config = testing.setUp()\n        \u003cspan class=\"hljs-built_in\"\u003esuper\u003c/span\u003e(IntegrationTestBase, self).setUp()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIn setUpClass, we run the main function of the applications\n__init__.py that sets up the WSGI application and then we wrap it in\na TestApp that gives us the ability to call get/post on it.\u003c/p\u003e\n\u003cp\u003eHere is an example of it in use:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title hljs-class\"\u003eTestViews\u003c/span\u003e(\u003cspan class=\"hljs-title hljs-class hljs-inherited\"\u003eIntegrationTestBase\u003c/span\u003e):\n    \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title hljs-function\"\u003etest_get_login\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself\u003c/span\u003e):\n        \u003cspan class=\"hljs-string\"\u003e\"\"\" Call the login view, make sure routes are working \"\"\"\u003c/span\u003e\n        res = self.app.get(\u003cspan class=\"hljs-string\"\u003e'/login'\u003c/span\u003e)\n        self.assertEqual(res.status_int, \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e)\n\n    \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title hljs-function\"\u003etest_empty_login\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself\u003c/span\u003e):\n        \u003cspan class=\"hljs-string\"\u003e\"\"\" Empty login fails \"\"\"\u003c/span\u003e\n        res = self.app.post(\u003cspan class=\"hljs-string\"\u003e'/login'\u003c/span\u003e, {\u003cspan class=\"hljs-string\"\u003e'submit'\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003eTrue\u003c/span\u003e})\n\n        \u003cspan class=\"hljs-keyword\"\u003eassert\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"There was a problem with your submission\"\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e res.body\n        \u003cspan class=\"hljs-keyword\"\u003eassert\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"Required\"\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e res.body\n        \u003cspan class=\"hljs-keyword\"\u003eassert\u003c/span\u003e res.status_int == \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e\n\n    \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title hljs-function\"\u003etest_valid_login\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself\u003c/span\u003e):\n        \u003cspan class=\"hljs-string\"\u003e\"\"\" Call the login view, make sure routes are working \"\"\"\u003c/span\u003e\n        admin = User(username=\u003cspan class=\"hljs-string\"\u003e'sontek'\u003c/span\u003e, password=\u003cspan class=\"hljs-string\"\u003e'temp'\u003c/span\u003e, kind=\u003cspan class=\"hljs-string\"\u003eu'admin'\u003c/span\u003e)\n        admin.activated = \u003cspan class=\"hljs-literal\"\u003eTrue\u003c/span\u003e\n        self.session.add(admin)\n        self.session.flush()\n\n        res = self.app.get(\u003cspan class=\"hljs-string\"\u003e'/login'\u003c/span\u003e)\n\n        csrf = res.form.fields[\u003cspan class=\"hljs-string\"\u003e'csrf_token'\u003c/span\u003e][\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e].value\n\n        res = self.app.post(\u003cspan class=\"hljs-string\"\u003e'/login'\u003c/span\u003e,\n            {\n                \u003cspan class=\"hljs-string\"\u003e'submit'\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003eTrue\u003c/span\u003e,\n                \u003cspan class=\"hljs-string\"\u003e'Username'\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'sontek'\u003c/span\u003e,\n                \u003cspan class=\"hljs-string\"\u003e'Password'\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'temp'\u003c/span\u003e,\n                \u003cspan class=\"hljs-string\"\u003e'csrf_token'\u003c/span\u003e: csrf\n            }\n        )\n\n        \u003cspan class=\"hljs-keyword\"\u003eassert\u003c/span\u003e res.status_int == \u003cspan class=\"hljs-number\"\u003e302\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1\u003eProblems with this approach\u003c/h1\u003e\n\u003cp\u003eIf a test causes an error that will prevent the transaction from rolling\nback, such as closing the engine, then this approach will leave your\ndatabase in a state that might cause other tests to fail.\u003c/p\u003e\n\u003cp\u003eIf this happens tracing the root cause could be difficult but you should\nbe able to just look at the first failed test unless you are running the\ntests in parallel.\u003c/p\u003e\n\u003cp\u003eIf you are good about writing and running your tests regularly you\nshould be able to catch individual tests causing issues like this fairly\nquickly.\u003c/p\u003e\n\u003ch1\u003eResources\u003c/h1\u003e\n\u003cp\u003e\u003ca href=\"http://docs.pylonsproject.org/projects/pyramid/en/latest/narr/testing.html\"\u003ehttp://docs.pylonsproject.org/projects/pyramid/en/latest/narr/testing.html\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://www.sqlalchemy.org/docs/orm/session.html#joining-a-session-into-an-external-transaction\"\u003ehttp://www.sqlalchemy.org/docs/orm/session.html#joining-a-session-into-an-external-transaction\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eJohn Anderson \u0026#x3C;\u003ca href=\"mailto:sontek@gmail.com\"\u003esontek@gmail.com\u003c/a\u003e\u003e 2011\u003c/p\u003e","category":"python\n","date":"2011-11-30T20:00:00-04:00","tags":"python, pyramid, sqlalchemy\n","title":"Writing tests for Pyramid and SQLAlchemy"},{"id":["old","turning_vim_into_a_modern_python_ide"],"path":"old/turning_vim_into_a_modern_python_ide","contentHtml":"\u003cp\u003e::: {.contents}\n:::\u003c/p\u003e\n\u003cp\u003eTL;DR:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-shell\"\u003e\u003cspan class=\"hljs-meta\"\u003e$ \u003c/span\u003e\u003cspan class=\"bash\"\u003egit \u003cspan class=\"hljs-built_in\"\u003eclone\u003c/span\u003e https://github.com/sontek/dotfiles.git\u003c/span\u003e\n\u003cspan class=\"hljs-meta\"\u003e$ \u003c/span\u003e\u003cspan class=\"bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003ecd\u003c/span\u003e dotfiles\u003c/span\u003e\n\u003cspan class=\"hljs-meta\"\u003e$ \u003c/span\u003e\u003cspan class=\"bash\"\u003e./install.sh vim\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1\u003eIntro\u003c/h1\u003e\n\u003cp\u003eBack in 2008, I wrote the article \u003ca href=\"http://sontek.net/python-with-a-modular-ide-vim\"\u003ePython with a modular IDE\n(Vim)\u003c/a\u003e. Years later, I\nhave people e-mailing me and commenting daily asking for more\ninformation, even though most of the information in it is outdated. Here\nis the modern way to work with Python and Vim to achieve the perfect\nenvironment.\u003c/p\u003e\n\u003cp\u003eBecause one of the most important parts about a development environment\nis the ability to easily reproduce across machines, we are going to\nstore our vim configuration in git:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-shell\"\u003e\u003cspan class=\"hljs-meta\"\u003e$ \u003c/span\u003e\u003cspan class=\"bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003emkdir\u003c/span\u003e ~/.vim/\u003c/span\u003e\n\u003cspan class=\"hljs-meta\"\u003e$ \u003c/span\u003e\u003cspan class=\"bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003emkdir\u003c/span\u003e ~/.vim/{\u003cspan class=\"hljs-built_in\"\u003eautoload\u003c/span\u003e,bundle}\u003c/span\u003e\n\u003cspan class=\"hljs-meta\"\u003e$ \u003c/span\u003e\u003cspan class=\"bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003ecd\u003c/span\u003e ~/.vim/\u003c/span\u003e\n\u003cspan class=\"hljs-meta\"\u003e$ \u003c/span\u003e\u003cspan class=\"bash\"\u003egit init\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe purpose of the autoload directory is to automatically load the vim\nplugin \u003ca href=\"https://github.com/tpope/vim-pathogen\"\u003ePathogen\u003c/a\u003e, which we'll\nthen use to load all other plugins that are located in the bundle\ndirectory. So download pathogen and put it in your autoload folder.\u003c/p\u003e\n\u003cp\u003eYou'll need to add the following to your ~/.vimrc so that pathogen\nwill be loaded properly. Filetype detection must be off when you run the\ncommands so its best to execute them first:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-r\"\u003efiletype off\n\u003cspan class=\"hljs-built_in\"\u003ecall\u003c/span\u003e pathogen\u003cspan class=\"hljs-comment\"\u003e#runtime_append_all_bundles()\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003ecall\u003c/span\u003e pathogen\u003cspan class=\"hljs-comment\"\u003e#helptags()\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNow lets add all of the vim plugins we plan on using as submodules to\nour git repository:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003egit submodule add http://github.com/tpope/vim-fugitive.git bundle/fugitive\ngit submodule add https://github.com/msanders/snipmate.vim.git bundle/snipmate\ngit submodule add https://github.com/tpope/vim-surround.git bundle/surround\ngit submodule add https://github.com/tpope/vim-git.git bundle/git\ngit submodule add https://github.com/ervandew/supertab.git bundle/supertab\ngit submodule add https://github.com/sontek/minibufexpl.vim.git bundle/minibufexpl\ngit submodule add https://github.com/wincent/Command-T.git bundle/command-t\ngit submodule add https://github.com/mitechie/pyflakes-pathogen.git\ngit submodule add https://github.com/mileszs/ack.vim.git bundle/ack\ngit submodule add https://github.com/sjl/gundo.vim.git bundle/gundo\ngit submodule add https://github.com/fs111/pydoc.vim.git bundle/pydoc\ngit submodule add https://github.com/vim-scripts/pep8.git bundle/pep8\ngit submodule add https://github.com/alfredodeza/pytest.vim.git bundle/py.test\ngit submodule add https://github.com/reinh/vim-makegreen bundle/makegreen\ngit submodule add https://github.com/vim-scripts/TaskList.vim.git bundle/tasklist\ngit submodule add https://github.com/vim-scripts/The-NERD-tree.git bundle/nerdtree\ngit submodule add https://github.com/sontek/rope-vim.git bundle/ropevim\ngit submodule init\ngit submodule update\ngit submodule foreach git submodule init\ngit submodule foreach git submodule update\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThats it! Now that we've got our vim configuration in git!\u003c/p\u003e\n\u003cp\u003eNow lets look at how to use each of these plugins to improve the power\nof vim:\u003c/p\u003e\n\u003ch1\u003eBasic Editing and Debugging\u003c/h1\u003e\n\u003ch2\u003eCode Folding\u003c/h2\u003e\n\u003cp\u003eLets first enable code folding. This makes it a lot easier to organize\nyour code and hide portions that you aren't interested in working on.\nThis is quite easy for Python, since whitespace is required.\u003c/p\u003e\n\u003cp\u003eIn your ~/.vimrc just add:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ini\"\u003eset \u003cspan class=\"hljs-attr\"\u003efoldmethod\u003c/span\u003e=indent\nset \u003cspan class=\"hljs-attr\"\u003efoldlevel\u003c/span\u003e=\u003cspan class=\"hljs-number\"\u003e99\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThen you will be able to be inside a method and type 'za' to open and\nclose a fold.\u003c/p\u003e\n\u003ch2\u003eWindow Splits\u003c/h2\u003e\n\u003cp\u003eSometimes code folding isn't enough; you may need to start opening up\nmultiple windows and working on multiple files at once or different\nlocations within the same file. To do this in vim, you can use these\nshortcuts:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yaml\"\u003e\u003cspan class=\"hljs-attr\"\u003eVertical Split :\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eCtrl+w\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e+\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ev\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003eHorizontal Split:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eCtrl+w\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e+\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003es\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003eClose current windows:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eCtrl+w\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e+\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eq\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eI also like to bind Ctrl+\u0026#x3C;movement\u003e keys to move around the windows,\ninstead of using Ctrl+w + \u0026#x3C;movement\u003e:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-arduino\"\u003emap \u0026#x3C;c-j\u003e \u0026#x3C;c-w\u003ej\nmap \u0026#x3C;c-k\u003e \u0026#x3C;c-w\u003ek\nmap \u0026#x3C;c-l\u003e \u0026#x3C;c-w\u003el\nmap \u0026#x3C;c-h\u003e \u0026#x3C;c-w\u003eh\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"http://i.imgur.com/krj0l.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch2\u003eSnippets\u003c/h2\u003e\n\u003cp\u003eThe next tweak that really speeds up development is using snipmate.\nWe've already included it in our bundle/ folder so its already enabled.\nTry opening up a python file and typing 'def\u0026#x3C;tab\u003e'. It should stub\nout a method definition for you and allow you to tab through and fill\nout the arguments, doc string, etc.\u003c/p\u003e\n\u003cp\u003eI also like to create my own snippets folder to put in some custom\nsnippets:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-shell\"\u003e\u003cspan class=\"hljs-meta\"\u003e$ \u003c/span\u003e\u003cspan class=\"bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003emkdir\u003c/span\u003e ~/.vim/snippets\u003c/span\u003e\n\u003cspan class=\"hljs-meta\"\u003e$ \u003c/span\u003e\u003cspan class=\"bash\"\u003evim ~/.vim/snippets/python.snippets\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ePut this in the file:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-arduino\"\u003esnippet pdb\n    \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e pdb; pdb.\u003cspan class=\"hljs-built_in\"\u003eset_trace\u003c/span\u003e()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNow you can type pdb\u0026#x3C;tab\u003e and it'll insert your breakpoint!\u003c/p\u003e\n\u003ch2\u003eTask lists\u003c/h2\u003e\n\u003cp\u003eAnother really useful thing is to mark some of your code as TODO or\nFIXME! I know we all like to think we write perfect code, but sometimes\nyou just have to settle and leave a note for yourself to come back\nlater. One of the plugins we included was the tasklist plugin that will\nallow us to search all open buffers for things to fix. Just add a\nmapping to open it in ~/.vimrc:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-arduino\"\u003emap \u0026#x3C;leader\u003etd \u0026#x3C;Plug\u003eTaskList\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNow you can hit \u0026#x3C;leader\u003etd to open your task list and hit 'q' to\nclose it. You can also hit enter on the task to jump to the buffer and\nline that it is placed on.\u003c/p\u003e\n\u003ch2\u003eRevision History\u003c/h2\u003e\n\u003cp\u003eThe final basic editing tweak I suggest everyone start utilizing is the\nGundo plugin. It'll allow you to view diff's of every save on a file\nyou've made and allow you to quickly revert back and forth:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://i.imgur.com/2NrPS.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003eJust bind a key in your .vimrc to toggle the Gundo window:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ruby\"\u003emap \u0026#x3C;leader\u003eg \u003cspan class=\"hljs-symbol\"\u003e:GundoToggle\u0026#x3C;CR\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1\u003eSyntax Highlighting and Validation\u003c/h1\u003e\n\u003cp\u003eSimply enable syntax highlighting in your ~/.vimrc:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-vbnet\"\u003esyntax \u003cspan class=\"hljs-keyword\"\u003eon\u003c/span\u003e                           \u003cspan class=\"hljs-string\"\u003e\" syntax highlighing\nfiletype on                          \"\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eto\u003c/span\u003e detect filetypes\nfiletype plugin indent \u003cspan class=\"hljs-keyword\"\u003eon\u003c/span\u003e    \u003cspan class=\"hljs-string\"\u003e\" enable loading indent file for filetype\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eBecause we enabled pyflakes when we added it as a submodule in\n~/.vim/bundle, it will notify you about unused imports and invalid\nsyntax. It will save you a lot of time saving and running just to find\nout you missed a colon. I like to tell it not use the quickfix window:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ini\"\u003elet g:\u003cspan class=\"hljs-attr\"\u003epyflakes_use_quickfix\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"http://i.imgur.com/ZfjFe.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch2\u003ePep8\u003c/h2\u003e\n\u003cp\u003eThe final plugin that really helps validate your code is the pep8\nplugin, it'll make sure your code is consistent across all projects.\nAdd a key mapping to your ~/.vimrc and then you'll be able to jump to\neach of the pep8 violations in the quickfix window:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ini\"\u003elet g:\u003cspan class=\"hljs-attr\"\u003epep8_map\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e'\u0026#x3C;leader\u003e8'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"http://i.imgur.com/VU9AB.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch1\u003eTab Completion and Documentation\u003c/h1\u003e\n\u003cp\u003eVim has many different code completion options. We are going to use the\nSuperTab plugin to check the context of the code you are working on and\nchoose the best for the situation. We've already enabled the SuperTab\nplugin in the bundle/ folder, so we just have to configure it to be\ncontext sensitive and to enable omni code completion in your ~/.vimrc:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ini\"\u003eau FileType python set \u003cspan class=\"hljs-attr\"\u003eomnifunc\u003c/span\u003e=pythoncomplete\u003cspan class=\"hljs-comment\"\u003e#Complete\u003c/span\u003e\nlet g:\u003cspan class=\"hljs-attr\"\u003eSuperTabDefaultCompletionType\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\"context\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNow we just enable the menu and pydoc preview to get the most useful\ninformation out of the code completion:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ini\"\u003eset \u003cspan class=\"hljs-attr\"\u003ecompleteopt\u003c/span\u003e=menuone,longest,preview\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"http://i.imgur.com/g4lxP.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003eWe also enabled the pydoc plugin at the beginning with all the\nsubmodules; that gives us the ability to hit \u0026#x3C;leader\u003epw when our\ncursor is on a module and have a new window open with the whole\ndocumentation page for it.\u003c/p\u003e\n\u003ch1\u003eCode Navigation\u003c/h1\u003e\n\u003ch2\u003eBuffers\u003c/h2\u003e\n\u003cp\u003eThe most important part about navigating code within vim, is to\ncompletely understand how to use buffers. There is no reason to use\ntabs. Open files with :e \u0026#x3C;filename\u003e to place in a buffer. We already\ninstalled the minibufexpl plugin, so you will already visually see every\nbuffer opened. You can also get a list of them doing :buffers.\u003c/p\u003e\n\u003cp\u003eYou can switch between the buffers using b\u0026#x3C;number\u003e, such as :b1 for\nthe first buffer. You can also use its name to match, so you can type :b\nmod\u0026#x3C;tab\u003e to autocomplete opening the models.py buffer. You need to\nmake sure you are using the minibufexpl from my github since it has\npatches that make it much better to work with.\u003c/p\u003e\n\u003cp\u003eTo close a buffer you use :bd or :bw.\u003c/p\u003e\n\u003ch2\u003eFuzzy Text File Search\u003c/h2\u003e\n\u003cp\u003eTo make finding and opening files within your project even easier, we\nare going to use the command-t plugin. It does have some parts that need\nto be compiled, so its not already installed by adding it as a\nsubmodule. Go to your ~/.vim/bundle/command-t folder and run 'rake\nmake'. Yes you need ruby installed. By default, command-t is bound to\n\u0026#x3C;leader\u003et. This will use fuzzy text matching to find any file in your\nproject.\u003c/p\u003e\n\u003cp\u003eIt also supports searching only through opened buffers, instead of files\nusing \u0026#x3C;leader\u003eb.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://i.imgur.com/hUcSl.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch2\u003eFile Browser\u003c/h2\u003e\n\u003cp\u003eNERD Tree is a project file browser. I must admit I used this heavily\nback when I was migrating from Visual Studio and used to the Solution\nExplorer, but I rarely use it anymore. Command-T is usually all you'll\nneed. It is useful when you are getting to know a new codebase for the\nfirst time though. Lets bind a shortcut key for opening it:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ruby\"\u003emap \u0026#x3C;leader\u003en \u003cspan class=\"hljs-symbol\"\u003e:NERDTreeToggle\u0026#x3C;CR\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"http://i.imgur.com/R4ZzQ.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch2\u003eRefactoring and Go to definition\u003c/h2\u003e\n\u003cp\u003eRopevim is also a great tool that will allow you to navigate around your\ncode. It supports automatically inserting import statements, goto\ndefinition, refactoring, and code completion. You'll really want to\nread up on everything it does, but the two big things I use it for is to\njump to function or class definitions quickly and to rename things\n(including all their references).\u003c/p\u003e\n\u003cp\u003eFor instance, if you are using django and you place your cursor over the\nclass models.Model you reference and then called :RopeGotoDefintion, it\nwould jump you straight to the django library to that class definition.\nWe already have it installed in our bundles, so we bind it to a key to\nuse it:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ruby\"\u003emap \u0026#x3C;leader\u003ej \u003cspan class=\"hljs-symbol\"\u003e:RopeGotoDefinition\u0026#x3C;CR\u003e\u003c/span\u003e\nmap \u0026#x3C;leader\u003er \u003cspan class=\"hljs-symbol\"\u003e:RopeRename\u0026#x3C;CR\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eSearching\u003c/h2\u003e\n\u003cp\u003eThe final tool that really speeds up navigating your code is the Ack\nplugin. Ack is similar to grep, but much better in my opinion. You can\nfuzzy text search for anything in your code (variable name, class,\nmethod, etc) and it'll give you a list of files and line numbers where\nthey are defined so you can quickly cycle through them. Just bind the\nsearching to a key:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-php-template\"\u003e\u003cspan class=\"xml\"\u003enmap \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003eleader\u003c/span\u003e\u003e\u003c/span\u003ea \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003eEsc\u003c/span\u003e\u003e\u003c/span\u003e:Ack!\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe use ! at the end of it so it doesn't open the first result\nautomatically.\u003c/p\u003e\n\u003ch1\u003eIntegration with Git\u003c/h1\u003e\n\u003cp\u003eWe installed 2 plugins, git.vim and fugitive, that give us all the\nintegration we need. Git.vim will provide us syntax highlighting for git\nconfiguration files; fugitive provides a great interface for interacting\nwith git including getting diffs, status updates, committing, and moving\nfiles.\u003c/p\u003e\n\u003cp\u003eFugitive also allows you to view what branch you are working in directly\nfrom vim. Add this to your statusline in ~/.vimrc:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-shell\"\u003e\u003cspan class=\"hljs-meta\"\u003e%\u003c/span\u003e\u003cspan class=\"bash\"\u003e{fugitive\u003cspan class=\"hljs-comment\"\u003e#statusline()}\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe big commands you need to know:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eGblame\u003c/strong\u003e: This allows you to view a line by line comparison of who\nthe last person to touch that line of code is.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eGwrite\u003c/strong\u003e: This will stage your file for commit, basically doing\ngit add \u0026#x3C;filename\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eGread\u003c/strong\u003e: This will basically run a git checkout \u0026#x3C;filename\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eGcommit\u003c/strong\u003e: This will just run git commit. Since its in a vim\nbuffer, you can use keyword completion (Ctrl-N), like\ntest_all\u0026#x3C;Ctrl-N\u003e to find the method name in your buffer and\ncomplete it for the commit message. You can also use + and - on the\nfilenames in the message to stage/unstage them for the commit.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"http://i.imgur.com/NuRRj.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch1\u003eTest Integration\u003c/h1\u003e\n\u003ch2\u003edjango nose\u003c/h2\u003e\n\u003cp\u003eTest runner integration really depends on the testing library you are\nusing and what type of tests you are running but we included a great\ngeneric plugin called MakeGreen that executes off of vim's makeprg\nvariable. So for instance, if you are using django with django-nose you\ncould define a shortcut key in your ~/.vimrc like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-arduino\"\u003emap \u0026#x3C;leader\u003edt :set makeprg=python\\ manage.py\\ test\\|:call \u003cspan class=\"hljs-built_in\"\u003eMakeGreen\u003c/span\u003e()\u0026#x3C;CR\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis will just give you a green bar at the bottom of vim if your test\npassed or a red bar with the message of the failed test if it doesn't.\nVery simple.\u003c/p\u003e\n\u003ch2\u003epy.test\u003c/h2\u003e\n\u003cp\u003eI also included the py.test vim plugin for those who prefer it. This\nplugin has a lot more functionality including executing individual tests\nby class, file, or method. You can also cycle through the individual\nassertion errors. I have the following bindings:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-php-template\"\u003e\u003cspan class=\"xml\"\u003e\" Execute the tests\nnmap \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003esilent\u003c/span\u003e\u003e\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003eLeader\u003c/span\u003e\u003e\u003c/span\u003etf \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003eEsc\u003c/span\u003e\u003e\u003c/span\u003e:Pytest file\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003eCR\u003c/span\u003e\u003e\u003c/span\u003e\nnmap \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003esilent\u003c/span\u003e\u003e\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003eLeader\u003c/span\u003e\u003e\u003c/span\u003etc \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003eEsc\u003c/span\u003e\u003e\u003c/span\u003e:Pytest class\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003eCR\u003c/span\u003e\u003e\u003c/span\u003e\nnmap \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003esilent\u003c/span\u003e\u003e\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003eLeader\u003c/span\u003e\u003e\u003c/span\u003etm \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003eEsc\u003c/span\u003e\u003e\u003c/span\u003e:Pytest method\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003eCR\u003c/span\u003e\u003e\u003c/span\u003e\n\" cycle through test errors\nnmap \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003esilent\u003c/span\u003e\u003e\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003eLeader\u003c/span\u003e\u003e\u003c/span\u003etn \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003eEsc\u003c/span\u003e\u003e\u003c/span\u003e:Pytest next\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003eCR\u003c/span\u003e\u003e\u003c/span\u003e\nnmap \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003esilent\u003c/span\u003e\u003e\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003eLeader\u003c/span\u003e\u003e\u003c/span\u003etp \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003eEsc\u003c/span\u003e\u003e\u003c/span\u003e:Pytest previous\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003eCR\u003c/span\u003e\u003e\u003c/span\u003e\nnmap \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003esilent\u003c/span\u003e\u003e\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003eLeader\u003c/span\u003e\u003e\u003c/span\u003ete \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003eEsc\u003c/span\u003e\u003e\u003c/span\u003e:Pytest error\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003eCR\u003c/span\u003e\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"http://i.imgur.com/RAE7v.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch1\u003eVirtualenv\u003c/h1\u003e\n\u003cp\u003eVim doesn't realize that you are in a virtualenv so it wont give you\ncode completion for libraries only installed there. Add the following\nscript to your ~/.vimrc to fix it:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ini\"\u003e\" Add the virtualenv's site-packages to vim path\npy \u0026#x3C;\u0026#x3C; EOF\nimport os.path\nimport sys\nimport vim\nif 'VIRTUAL_ENV' in os.environ:\n    \u003cspan class=\"hljs-attr\"\u003eproject_base_dir\u003c/span\u003e = os.environ[\u003cspan class=\"hljs-string\"\u003e'VIRTUAL_ENV'\u003c/span\u003e]\n    sys.path.insert(0, project_base_dir)\n    \u003cspan class=\"hljs-attr\"\u003eactivate_this\u003c/span\u003e = os.path.join(project_base_dir, \u003cspan class=\"hljs-string\"\u003e'bin/activate_this.py'\u003c/span\u003e)\n    execfile(activate_this, dict(\u003cspan class=\"hljs-attr\"\u003e__file__\u003c/span\u003e=activate_this))\nEOF\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1\u003eDjango\u003c/h1\u003e\n\u003cp\u003eThe only true django tweak I make is before I open vim I'll export the\nDJANGO_SETTINGS_MODULE environment so that I get code completion for\ndjango modules as well:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ini\"\u003eexport \u003cspan class=\"hljs-attr\"\u003eDJANGO_SETTINGS_MODULE\u003c/span\u003e=project.settings\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1\u003eRandom Tips\u003c/h1\u003e\n\u003cp\u003eIf you want to find a new color scheme just go to\n\u003ca href=\"http://code.google.com/p/vimcolorschemetest/\"\u003ehttp://code.google.com/p/vimcolorschemetest/\u003c/a\u003e to preview a large\nselection.\u003c/p\u003e\n\u003cp\u003eJohn Anderson \u0026#x3C;\u003ca href=\"mailto:sontek@gmail.com\"\u003esontek@gmail.com\u003c/a\u003e\u003e 2011\u003c/p\u003e","category":"python\n","date":"2011-05-06T20:00:00-04:00","tags":"vim, python\n","title":"Turning Vim into a modern Python IDE"},{"id":["old","tips_and_tricks_for_the_python_interpreter"],"path":"old/tips_and_tricks_for_the_python_interpreter","contentHtml":"\u003cp\u003eI have seen a lot of people switch over to using ipython, bpython, etc\nto get auto-complete support without realizing that the standard\ninterpreter does have this functionality.\u003c/p\u003e\n\u003cp\u003eTo enable auto-complete support in the python interpreter you need to\ncreate a python startup file that enables readline support. A python\nstartup file is just a bunch of python code that gets executed at\nstartup of the interpreter. To do this you just setup PYTHONSTARTUP in\nyour ~/.bashrc and then create a ~/.pythonrc.py file:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-comment\"\u003e#.bashrc\u003c/span\u003e\nPYTHONSTARTUP=~/.pythonrc.py\nexport PYTHONSTARTUP\n\n\u003cspan class=\"hljs-comment\"\u003e#.pythonrc.py\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e:\n    \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e readline\n\u003cspan class=\"hljs-keyword\"\u003eexcept\u003c/span\u003e ImportError:\n    \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"Module readline not available.\"\u003c/span\u003e)\n\u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e:\n    \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e rlcompleter\n    readline.parse_and_bind(\u003cspan class=\"hljs-string\"\u003e\"tab: complete\"\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNow when you are in python you have tab completion on importing, calling\nmethods on a module, etc.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-meta\"\u003e\u003e\u003e\u003e \u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e o\n\u003cspan class=\"hljs-built_in\"\u003eobject\u003c/span\u003e(  \u003cspan class=\"hljs-built_in\"\u003eoct\u003c/span\u003e(     \u003cspan class=\"hljs-built_in\"\u003eopen\u003c/span\u003e(    \u003cspan class=\"hljs-keyword\"\u003eor\u003c/span\u003e       \u003cspan class=\"hljs-built_in\"\u003eord\u003c/span\u003e(     os\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eI always end up using the pretty print module for viewing long lists and\nstrings in the interpreter so I prefer to just use it by default:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-comment\"\u003e# Enable Pretty Printing for stdout\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e pprint\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title hljs-function\"\u003emy_displayhook\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003evalue\u003c/span\u003e):\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e value \u003cspan class=\"hljs-keyword\"\u003eis\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enot\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003eNone\u003c/span\u003e:\n        \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e:\n            \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e __builtin__\n            __builtin__._ = value\n        \u003cspan class=\"hljs-keyword\"\u003eexcept\u003c/span\u003e ImportError:\n            __builtins__._ = value\n\n        pprint.pprint(value)\n\nsys.displayhook = my_displayhook\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIt is also very useful to be able to load up your favorite editor to\nedit lines of code from the interpreter, you can do this by adding the\nfollowing into your ~/.pythonrc.py:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e os\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e sys\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e code \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e InteractiveConsole\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e tempfile \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e mkstemp\n\nEDITOR = os.environ.get(\u003cspan class=\"hljs-string\"\u003e'EDITOR'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'vi'\u003c/span\u003e)\nEDIT_CMD = \u003cspan class=\"hljs-string\"\u003e'\\e'\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title hljs-class\"\u003eEditableBufferInteractiveConsole\u003c/span\u003e(\u003cspan class=\"hljs-title hljs-class hljs-inherited\"\u003eInteractiveConsole\u003c/span\u003e):\n    \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title hljs-function\"\u003e__init__\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself, *args, **kwargs\u003c/span\u003e):\n        self.last_buffer = [] \u003cspan class=\"hljs-comment\"\u003e# This holds the last executed statement\u003c/span\u003e\n        InteractiveConsole.__init__(self, *args, **kwargs)\n\n    \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title hljs-function\"\u003erunsource\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself, source, *args\u003c/span\u003e):\n        self.last_buffer = [ source.encode(\u003cspan class=\"hljs-string\"\u003e'latin-1'\u003c/span\u003e) ]\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e InteractiveConsole.runsource(self, source, *args)\n\n    \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title hljs-function\"\u003eraw_input\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself, *args\u003c/span\u003e):\n        line = InteractiveConsole.raw_input(self, *args)\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e line == EDIT_CMD:\n            fd, tmpfl = mkstemp(\u003cspan class=\"hljs-string\"\u003e'.py'\u003c/span\u003e)\n            os.write(fd, \u003cspan class=\"hljs-string\"\u003eb'\\n'\u003c/span\u003e.join(self.last_buffer))\n            os.close(fd)\n            os.system(\u003cspan class=\"hljs-string\"\u003e'%s %s'\u003c/span\u003e % (EDITOR, tmpfl))\n            line = \u003cspan class=\"hljs-built_in\"\u003eopen\u003c/span\u003e(tmpfl).read()\n            os.unlink(tmpfl)\n            tmpfl = \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e\n            lines = line.split( \u003cspan class=\"hljs-string\"\u003e'\\n'\u003c/span\u003e )\n            \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e i \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003erange\u003c/span\u003e(\u003cspan class=\"hljs-built_in\"\u003elen\u003c/span\u003e(lines) - \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e): self.push( lines[i] )\n            line = lines[-\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e line\n\nc = EditableBufferInteractiveConsole(\u003cspan class=\"hljs-built_in\"\u003elocals\u003c/span\u003e=\u003cspan class=\"hljs-built_in\"\u003elocals\u003c/span\u003e())\nc.interact(banner=\u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e)\n\n\u003cspan class=\"hljs-comment\"\u003e# Exit the Python shell on exiting the InteractiveConsole\u003c/span\u003e\nsys.exit()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eFor Django developers when you load up the ./manage.py shell it is nice\nto have access to all your models and settings for testing:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-comment\"\u003e# If we're working with a Django project, set up the environment\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'DJANGO_SETTINGS_MODULE'\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e os.environ:\n    \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e django.db.models.loading \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e get_models\n    \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e django.test.client \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e Client\n    \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e django.test.utils \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e setup_test_environment, teardown_test_environment\n    \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e django.conf \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e settings \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e S\n\n    \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title hljs-class\"\u003eDjangoModels\u003c/span\u003e(\u003cspan class=\"hljs-title hljs-class hljs-inherited\"\u003eobject\u003c/span\u003e):\n        \u003cspan class=\"hljs-string\"\u003e\"\"\"Loop through all the models in INSTALLED_APPS and import them.\"\"\"\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title hljs-function\"\u003e__init__\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself\u003c/span\u003e):\n            \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e m \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e get_models():\n                \u003cspan class=\"hljs-built_in\"\u003esetattr\u003c/span\u003e(self, m.__name__, m)\n\n    A = DjangoModels()\n    C = Client()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAfter these tweaks the python interpreter is a lot more powerful and you\nreally lose the need for the more interactive shells like ipython and\nbpython. All of these settings work in both python2 and python3.\u003c/p\u003e\n\u003cp\u003eIf you want to see my complete ~/.pythonrc.py you can get it on\n\u003ca href=\"https://github.com/sontek/dotfiles/blob/master/_pythonrc.py\"\u003egithub\u003c/a\u003e\u003c/p\u003e","category":"python\n","date":"2010-12-27T20:00:00-04:00","tags":"python\n","title":"Tips and Tricks for the Python Interpreter"},{"id":["old","caesar_cipher_in_python"],"path":"old/caesar_cipher_in_python","contentHtml":"\u003cp\u003eI'm currently teaching my wife to code and one of the problems that we\nworked on to teach her some fundamental programming concepts was\nre-implementing the caesar cipher in python. It was fun not only to code\nbut to also start sending each other \"secret\" messages!\u003c/p\u003e\n\u003cp\u003eThe caesar cipher is a rather simple encoding, you just shift the\nalphabet a certain amount of characters. For example, if you are using a\nshift of 2:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ini\"\u003e\u003cspan class=\"hljs-attr\"\u003ea\u003c/span\u003e =\u003e c\n\u003cspan class=\"hljs-attr\"\u003eb\u003c/span\u003e =\u003e d\n\u003cspan class=\"hljs-attr\"\u003ey\u003c/span\u003e =\u003e a\n\u003cspan class=\"hljs-attr\"\u003ez\u003c/span\u003e =\u003e b\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eUsing this as an interview type question would provide a few interesting\nproblems and give you a good perspective on how good a developers\nproblem solving skills are and how knowledgeable they are in the\nlanguage of their choice.\u003c/p\u003e\n\u003cp\u003eThe first issue is to handle the beginning and end of the alphabet, if\nyou are encoding 'z' then you will have to start your shift on a. The\nsecond problem is to only encode letters since there was no ascii table\nto define in what order characters are shifted back in those times.\u003c/p\u003e\n\u003cp\u003eWithout using too much of the built in python niceties you could do\nsomething similar to this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-comment\"\u003e#!/usr/bin/python\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title hljs-function\"\u003edecode_shift_letter\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ecurrent_ord, start, end, shift\u003c/span\u003e):\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e current_ord - shift \u0026#x3C; start:\n        new_ord = (current_ord + \u003cspan class=\"hljs-number\"\u003e26\u003c/span\u003e) - shift\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003echr\u003c/span\u003e(new_ord)\n    \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e:\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003echr\u003c/span\u003e(current_ord-shift)\n\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title hljs-function\"\u003eencode_shift_letter\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ecurrent_ord, start, end, shift\u003c/span\u003e):\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e current_ord + shift \u003e end:\n        new_ord = (current_ord - \u003cspan class=\"hljs-number\"\u003e26\u003c/span\u003e) + shift\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003echr\u003c/span\u003e(new_ord)\n    \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e:\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003echr\u003c/span\u003e(current_ord+shift)\n\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title hljs-function\"\u003edecode\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-built_in\"\u003einput\u003c/span\u003e, shift\u003c/span\u003e):\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e modify_input(\u003cspan class=\"hljs-built_in\"\u003einput\u003c/span\u003e, shift, decode_shift_letter)\n\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title hljs-function\"\u003eencode\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-built_in\"\u003einput\u003c/span\u003e, shift\u003c/span\u003e):\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e modify_input(\u003cspan class=\"hljs-built_in\"\u003einput\u003c/span\u003e, shift, encode_shift_letter)\n\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title hljs-function\"\u003emodify_input\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-built_in\"\u003einput\u003c/span\u003e, shift, shift_letter\u003c/span\u003e):\n    new_sentence = \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e\n\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e letter \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003einput\u003c/span\u003e:\n        \u003cspan class=\"hljs-comment\"\u003e# we only encode letters, random characters like +!%$ are not encoded.\u003c/span\u003e\n        \u003cspan class=\"hljs-comment\"\u003e# Lower and Capital letters are not stored near each other on the\u003c/span\u003e\n        \u003cspan class=\"hljs-comment\"\u003e# ascii table\u003c/span\u003e\n        lower_start = \u003cspan class=\"hljs-built_in\"\u003eord\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'a'\u003c/span\u003e)\n        lower_end = \u003cspan class=\"hljs-built_in\"\u003eord\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'z'\u003c/span\u003e)\n        upper_start = \u003cspan class=\"hljs-built_in\"\u003eord\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'A'\u003c/span\u003e)\n        upper_end = \u003cspan class=\"hljs-built_in\"\u003eord\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'Z'\u003c/span\u003e)\n        current_ord = \u003cspan class=\"hljs-built_in\"\u003eord\u003c/span\u003e(letter)\n\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e current_ord \u003e= lower_start \u003cspan class=\"hljs-keyword\"\u003eand\u003c/span\u003e current_ord \u0026#x3C;= lower_end:\n            new_sentence += shift_letter(current_ord, lower_start, lower_end, shift)\n        \u003cspan class=\"hljs-keyword\"\u003eelif\u003c/span\u003e current_ord \u003e= upper_start \u003cspan class=\"hljs-keyword\"\u003eand\u003c/span\u003e current_ord \u0026#x3C;= upper_end:\n            new_sentence += shift_letter(current_ord, upper_start, upper_end, shift)\n        \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e:\n            new_sentence += letter\n\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e new_sentence\n\n\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title hljs-function\"\u003eget_shift\u003c/span\u003e():\n    \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e:\n        shift = \u003cspan class=\"hljs-built_in\"\u003eint\u003c/span\u003e(raw_input(\u003cspan class=\"hljs-string\"\u003e'What shift would you like to use?\\n'\u003c/span\u003e))\n    \u003cspan class=\"hljs-keyword\"\u003eexcept\u003c/span\u003e ValueError:\n        \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'Shift must be a number'\u003c/span\u003e\n        shift = get_shift()\n\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enot\u003c/span\u003e (shift \u003e \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eand\u003c/span\u003e shift \u0026#x3C;= \u003cspan class=\"hljs-number\"\u003e25\u003c/span\u003e):\n        \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'Shift must be between 1 and 25'\u003c/span\u003e\n        shift = get_shift()\n\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e shift\n\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title hljs-function\"\u003emain\u003c/span\u003e():\n    \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e:\n        task = \u003cspan class=\"hljs-built_in\"\u003eint\u003c/span\u003e(raw_input(\u003cspan class=\"hljs-string\"\u003e'1) Encode \\n'\u003c/span\u003e+ \\\n                             \u003cspan class=\"hljs-string\"\u003e'2) Decode \\n'\u003c/span\u003e))\n    \u003cspan class=\"hljs-keyword\"\u003eexcept\u003c/span\u003e ValueError:\n        \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'Invalid task, try again!'\u003c/span\u003e\n        main()\n\n    shift = get_shift()\n    \u003cspan class=\"hljs-built_in\"\u003einput\u003c/span\u003e = raw_input(\u003cspan class=\"hljs-string\"\u003e'What message would you like to %s\\n'\u003c/span\u003e % (\u003cspan class=\"hljs-string\"\u003e'Encode'\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e task == \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'Decode'\u003c/span\u003e))\n\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e task == \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e:\n        \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e encode(\u003cspan class=\"hljs-built_in\"\u003einput\u003c/span\u003e, shift)\n    \u003cspan class=\"hljs-keyword\"\u003eelif\u003c/span\u003e task == \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e:\n        \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e decode(\u003cspan class=\"hljs-built_in\"\u003einput\u003c/span\u003e, shift)\n\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e __name__ == \u003cspan class=\"hljs-string\"\u003e'__main__'\u003c/span\u003e:\n    main()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis would prove that you are a decent problem solver and have enough of\nthe language to get things done but if you want to prove you have\nmastered the python language you might take advantage of some slicing\nand some methods out of the string module and change your code to look\nsomething like:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e string \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e letters, maketrans\n\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title hljs-function\"\u003edecode\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-built_in\"\u003einput\u003c/span\u003e, shift\u003c/span\u003e):\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e modify_input(\u003cspan class=\"hljs-built_in\"\u003einput\u003c/span\u003e, -shift)\n\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title hljs-function\"\u003eencode\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-built_in\"\u003einput\u003c/span\u003e, shift\u003c/span\u003e):\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e modify_input(\u003cspan class=\"hljs-built_in\"\u003einput\u003c/span\u003e, shift)\n\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title hljs-function\"\u003emodify_input\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-built_in\"\u003einput\u003c/span\u003e, shift\u003c/span\u003e):\n    trans = maketrans(letters, letters[shift:] + letters[:shift])\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003einput\u003c/span\u003e.translate(trans)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eDo get more information on string.letters and string.maketrans you can\nvisit their documentation\n[here](\u003ca href=\"http://docs.python.org/library/string.html\"\u003ehttp://docs.python.org/library/string.html\u003c/a\u003e)\u003c/p\u003e","category":"none\n","date":"2010-11-14T20:00:00-04:00","tags":"python, interviews\n","title":"Caesar Cipher in Python"},{"id":["old","convert_a_string_to_an_integer_in_python"],"path":"old/convert_a_string_to_an_integer_in_python","contentHtml":"\u003cp\u003eA fun interview question some developers like to ask is to have you\nconvert ascii characters to an integer without using built in methods\nlike string.atoi or int().\u003c/p\u003e\n\u003cp\u003eSo using python the obvious ways to convert a string to an integer are\nthese:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-meta\"\u003e\u003e\u003e\u003e \u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003eint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'1234'\u003c/span\u003e)\n\u003cspan class=\"hljs-number\"\u003e1234\u003c/span\u003e\n\u003cspan class=\"hljs-meta\"\u003e\u003e\u003e\u003e \u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e string\n\u003cspan class=\"hljs-meta\"\u003e\u003e\u003e\u003e \u003c/span\u003estring.atoi(\u003cspan class=\"hljs-string\"\u003e'1234'\u003c/span\u003e)\n\u003cspan class=\"hljs-number\"\u003e1234\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe interesting thing here is finding out where on the ascii character\ntable the number is. Luckily python has this already built in with the\nord method:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-meta\"\u003e\u003e\u003e\u003e \u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003ehelp\u003c/span\u003e(\u003cspan class=\"hljs-built_in\"\u003eord\u003c/span\u003e)\n\n\u003cspan class=\"hljs-built_in\"\u003eord\u003c/span\u003e(...)\n    \u003cspan class=\"hljs-built_in\"\u003eord\u003c/span\u003e(c) -\u003e integer\n\n    Return the integer ordinal of a one-character string.\n\n\u003cspan class=\"hljs-meta\"\u003e\u003e\u003e\u003e \u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003eord\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'1'\u003c/span\u003e)\n\u003cspan class=\"hljs-number\"\u003e49\u003c/span\u003e\n\u003cspan class=\"hljs-meta\"\u003e\u003e\u003e\u003e \u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003eord\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'2'\u003c/span\u003e)\n\u003cspan class=\"hljs-number\"\u003e50\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eYou can see that the numbers are grouped together on the ascii table, so\nyou just have to grab '0' as the base and subtract the rest:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-meta\"\u003e\u003e\u003e\u003e \u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003eord\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'1'\u003c/span\u003e)-\u003cspan class=\"hljs-built_in\"\u003eord\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'0'\u003c/span\u003e)\n\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eSo if we have the string '1234', we can get each of the individual\nnumbers by looping over it:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-meta\"\u003e\u003e\u003e\u003e \u003c/span\u003enum_string = \u003cspan class=\"hljs-string\"\u003e'1234'\u003c/span\u003e\n\u003cspan class=\"hljs-meta\"\u003e\u003e\u003e\u003e \u003c/span\u003enum_list = []\n\u003cspan class=\"hljs-meta\"\u003e\u003e\u003e\u003e \u003c/span\u003ebase = \u003cspan class=\"hljs-built_in\"\u003eord\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'0'\u003c/span\u003e)\n\u003cspan class=\"hljs-meta\"\u003e\u003e\u003e\u003e \u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e num \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e num_string:\n\u003cspan class=\"hljs-meta\"\u003e... \u003c/span\u003e  num_list.append(\u003cspan class=\"hljs-built_in\"\u003eord\u003c/span\u003e(num) - base)\n...\n\u003cspan class=\"hljs-meta\"\u003e\u003e\u003e\u003e \u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e num_list\n[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e]\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ebut now how to we combine all these together to get 1234? You can't\njust add them up because you'll just get 1+2+3+4 = 10.\u003c/p\u003e\n\u003cp\u003eSo, we have to get 1000 + 200 + 30 + 4, which is a simple problem to\nsolve. Its just number times 10 to the nth power, so the final solution\nis:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003enum = \u003cspan class=\"hljs-string\"\u003e'1234'\u003c/span\u003e\nnew_num = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\nbase = \u003cspan class=\"hljs-built_in\"\u003eord\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'0'\u003c/span\u003e)\n\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e i,n \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eenumerate\u003c/span\u003e(\u003cspan class=\"hljs-built_in\"\u003ereversed\u003c/span\u003e(num)):\n      new_num += (\u003cspan class=\"hljs-built_in\"\u003eord\u003c/span\u003e(n) - base) * (\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e**i)\n\n\u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e new_num\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis code is a little verbose though, lets make it a dirty nasty one\nliner!\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-meta\"\u003e\u003e\u003e\u003e \u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003esum\u003c/span\u003e([(\u003cspan class=\"hljs-built_in\"\u003eord\u003c/span\u003e(n)-\u003cspan class=\"hljs-built_in\"\u003eord\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'0'\u003c/span\u003e)) * (\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e ** i) \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e i,n \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eenumerate\u003c/span\u003e(\u003cspan class=\"hljs-built_in\"\u003ereversed\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'1234'\u003c/span\u003e))])\n\u003cspan class=\"hljs-number\"\u003e1234\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e","category":"python\n","date":"2010-10-27T20:00:00-04:00","tags":"python, interviews\n","title":"Convert a string to an integer in Python"}]},"__N_SSG":true},"page":"/blog","query":{},"buildId":"kSpxIp8h4g7-IyAuHX8Pd","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>